# API接口设计文档目录

## 📋 ドキュメント情報

| 項目 | 内容 |
|------|------|
| **プロジェクト名** | 大賀輸送新システム |
| **ドキュメントバージョン** | v1.0 |
| **作成日** | 2026-02-XX|
| **ステータス** | ✅ 完了 |

---

## 1. 文档目录结构

```
API接口设计/
│
├── 01_API接口设计总览.md           # API設計总览ドキュメント
│
├── 02_パートナー管理API.md         # パートナー管理API詳細
│   ├── パートナー検索
│   ├── パートナー詳細
│   ├── 利用者管理
│   └── エラーコード
│
├── 03_発注管理API.md             # 発注管理API詳細
│   ├── 発注検索・詳細
│   ├── 運行指示書管理
│   ├── パートナー操作（承諾/拒否）
│   ├── メッセージ機能
│   └── アクション履歴
│
├── 04_実績・請求管理API.md       # 実績・請求管理API詳細
│   ├── 実績検索・詳細
│   ├── 日別傭車費管理
│   ├── 請求検索・発行
│   └── パートナー機能
│
├── 05_ファイルアップロード・監査ログAPI.md  # ファイル上传・監査API
│   ├── ファイルアップロード
│   ├── アップロード履歴
│   ├── アクション履歴
│   └── 外部連携
│
├── 06_ベースアカウント・マスタ管理API.md  # ベースアカウント・マスタAPI
│   ├── ベースアカウント管理
│   ├── マスタ管理
│   └── 認証
│
└── 07_OpenAPI_3.0_インターフェース定義.md  # OpenAPI 3.0定義
    ├── OpenAPI仕様概要
    ├── スキーマ定義
    ├── セキュリティ定義
    └── ツール対応
```

---

## 2. API一覧サマリー

### 2.1 ベース側API（/api/v1/）

| モジュール | エンドポイント数 | 主要API |
|-----------|----------------|---------|
| 認証 | 3 | ログイン、トークン再発行、ログアウト |
| パートナー管理 | 5 | 検索、詳細、詳細情報取得、情報更新、利用者管理 |
| 発注管理 | 6 | 検索、詳細、指示書取得、指示書更新、送付、アクション履歴 |
| 実績管理 | 4 | 検索、詳細、費用更新、送付、差戻し |
| 請求管理 | 4 | 検索、詳細、発行、取消 |
| ベースアカウント | 4 | 検索、詳細、新規作成、更新 |
| マスタ管理 | 4 | ベース一覧、ベース管理 |
| ファイルアップロード | 4 | アップロード、履歴、詳細、テンプレートDL |
| アクション履歴 | 3 | 検索、タイプ一覧、エクスポート |
| 外部連携 | 2 | AzureAD検索、AzureADユーザー情報 |

### 2.2 パートナー側API（/api/v1/partner/）

| モジュール | エンドポイント数 | 主要API |
|-----------|----------------|---------|
| パートナーTOP | 1 | ダッシュボード |
| 発注管理 | 2 | 発注検索、発注詳細（承諾/拒否） |
| 実績管理 | 1 | 実績詳細 |
| 請求管理 | 3 | 請求検索、詳細、ダウンロード |
| ファイルアップロード | 2 | アップロード、履歴 |

---

## 3. HTTPメソッド一覧

| メソッド | 用途 | べき等 |
|---------|------|-------|
| GET | リソースの取得 | ○ |
| POST | アクションの実行、リソースの作成 | × |
| PUT | リソースの完全な更新 | ○ |
| PATCH | リソースの部分的な更新 | × |
| DELETE | リソースの削除 | ○ |

---

## 4. 認証・認可

### 4.1 認証フロー

```
1. ログインAPIでメール/パスワードを送信
2. サーバーからJWTトークン（Access Token + Refresh Token）を受信
3. 以降のリクエストにAuthorizationヘッダーを追加
   Authorization: Bearer {access_token}
4. Access Token期限切れ時はRefresh Tokenで再発行
```

### 4.2 権限チェック

| 権限 | アクセス可能画面 |
|------|----------------|
| 管理者 | 全画面 |
| 役割者 | b2-b9, p1-p6 |
| 配車担当者 | b2-b5, p2-p4 |
| 計上担当者 | b4-b7, p4-p5 |

---

## 5. ページネーション

### 5.1 パラメータ

| パラメータ | タイプ | デフォルト値 | 最大値 |
|-----------|--------|-------------|-------|
| page | number | 1 | 1000 |
| pageSize | number | 20 | 100 |

### 5.2 レスポンス

```json
{
  "pagination": {
    "currentPage": 1,
    "pageSize": 20,
    "totalItems": 100,
    "totalPages": 5,
    "hasNext": true,
    "hasPrevious": false
  }
}
```

---

## 6. エラーハンドリング

### 6.1 HTTPステータスコード

| コード | 意味 | 使用場面 |
|--------|------|---------|
| 200 | OK | 成功 |
| 201 | Created | 作成成功 |
| 400 | Bad Request | 不正なリクエスト |
| 401 | Unauthorized | 認証エラー |
| 403 | Forbidden | 権限エラー |
| 404 | Not Found | リソース不存在 |
| 409 | Conflict | 競合 |
| 422 | Unprocessable Entity | バリデーションエラー |
| 429 | Too Many Requests | レート制限 |
| 500 | Internal Server Error | サーバーエラー |

### 6.2 エラーレスポンス形式

```json
{
  "success": false,
  "code": "VALIDATION_ERROR",
  "message": "バリデーションエラーが発生しました",
  "errors": [
    {
      "field": "email",
      "message": "有効なメールアドレスを入力してください"
    }
  ],
  "timestamp": "2026-02-xxT10:30:00Z"
}
```

---

## 7. セキュリティ

### 7.1 レート制限

| APIタイプ | 制限 |
|----------|------|
| 検索API | 60リクエスト/分 |
| 参照API | 120リクエスト/分 |
| 更新API | 30リクエスト/分 |
| アップロードAPI | 10リクエスト/分 |

### 7.2 データマスキング

| フィールド | マスク形式 | 例 |
|----------|----------|-----|
| email | `ab***@domain.com` | 個人情報を保護 |
| phone | `090****1234` | 電話番号を保護 |

---

## 8. 関連するドキュメント

| ドキュメント | パス |
|-------------|------|
| データベース設計 | ../データベース設計/01_データベース設計総览.md |
| DDLスクリプト | ../データベース設計/02_DDLスクリプト.sql |
| 設計根拠書 | ../データベース設計/03_データベース設計根拠書.md |
| 技術アーキテクチャ | ../別紙_画面一覧_v151/_公共技术架构规范.md |
| 画面設計書 | ../別紙_画面一覧_v151/*/05_設計規範.md |

---

## 9. API開発ガイドライン

### 9.1 命名規則

| 項目 | ルール | 例 |
|------|--------|-----|
| エンドポイント | スネークケース | `/order-details` |
| フィールド名 | キャメルケース | `orderId`, `createdAt` |
| 列挙値 | スネークケース（小文字） | `pending`, `accepted` |

### 9.2 バージョン管理

- **メジャーバージョン**: URLパスに含む（例: `/api/v1/`）
- **マイナー変更**: ドキュメントのみ更新
- **破壊的変更**: 新しいメジャーバージョンを作成

### 9.3 テスト要件

| テストタイプ | カバレッジ目標 |
|------------|-------------|
| ユニットテスト | 80%以上 |
| 統合テスト | 全API |
| E2Eテスト | 主要ユーザーフロー |

---

## 10. 変更ログ

| 日付 | バージョン | 変更内容 | 作成者 |
|------|------|---------|------|
| 2026-02-XX| v1.0 | 初期API設計ドキュメント | - |

---

**ドキュメント作成**: -  
**作成日時**: 2026-02-XX 
**適用範囲**: 大賀輸送新システム APIインターフェース設計ドキュメント索引
