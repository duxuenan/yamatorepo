# b7-被請求詳細 - 设计规范

## 1. 功能概述

### 1.1 文档信息
| 项目 | 内容 |
|------|------|
| **工作表名称** | b7-被請求詳細 |
| **界面编号** | b7 |
| **文档版本** | v1.0 |
| **最后更新** | 2026-02-XX|
| **文档状态** | ✅ 已发布 |

### 1.2 功能描述
b7-被請求詳細 是账单详情页面，提供账单详细信息展示、预览和确认功能。

### 1.3 技术架构
本文档基于 **前后端分离架构**，详细技术规范请参考：

👉 **[\_公共技术架构规范.md](../_公共技术架构规范.md)**

| 层级 | 技术 |
|------|------|
| 前端 | React 18.x + TypeScript + Ant Design |
| 后端 | Spring Boot 3.x + Java 17 |

### 1.4 核心功能
- 基本信息显示
- 請求書プレビュー
- 金額確認
- 確認OK/NG操作
- 代理アップロード
- メッセージ交流

### 1.5 适用范围
- 前端开发人员（详情页面组件实现）
- 后端开发人员（账单API开发）
- 测试工程师（详情功能测试）

---

## 2. 页面元素

### 2.1 元素清单

| 序号 | 元素名称 | 元素类型 | 功能说明 | 交互触发 |
|------|----------|----------|----------|----------|
| ⑴ | 被請求年月 | 表示項目 | 対象年月表示 | - |
| ⑵ | 会社コード | 表示項目 | 会社コード表示 | - |
| ⑶ | 輸送パートナー名 | 表示項目 | パートナー名表示 | - |
| ⑷ | ステータス | タグ | 状況表示 | - |
| ⑸ | プレビュー | プレビュー | 画像表示 | 点击→弹窗 |
| ⑹ | 実績確認 | リンク | 跳转 | 点击→b5 |
| ⑺ | 請求書合計金額 | 表示項目 | OCR金額 | - |
| ⑻ | 実績合計金額 | 表示項目 | 実績金額 | - |
| ⑼ | 金額差異 | タグ | あり/なし | - |
| ⑽ | 更新日時 | 表示項目 | 更新日時 | - |
| ⑾ | 更新者 | 表示項目 | 更新者名 | - |
| ⑿ | ファイル名 | 表示項目 | ファイル名 | - |
| ⒀ | 請求書アップロード | ボタン | 代理上传 | 点击→选择文件 |
| ⒁ | 確認OK | ボタン | 确认 | 点击→更新状态 |
| ⒂ | 確認NG | ボタン | 拒绝 | 点击→更新状态 |
| ⒃ | メッセージ | パネル | 消息交流 | 点击→展开 |

### 2.2 ステータス详细说明
| 状态 | 条件 | 说明 | 颜色编码 |
|------|------|------|----------|
| 未提出 | 輸送パートナーが請求書をアップロードしていない | 輸送パートナーが本システムを利用しない場合、ベース側が代理アップロードしていない場合も含む | 灰色 |
| 要確認 | 金額不匹配 | 輸送パートナーがアップロードした請求書の合計金額と本システムが保持する実績の合計金額を突合し、金額が一致しない | 橙色 |
| チェック未 | 未确认 | アップロードされた請求書をチェックしていない | 黄色 |
| チェック済 | 已确认 | 請求詳細画面で「確認OK」ボタンが押下されたとき | 蓝色 |
| ビズインテグラル登録完了 | 已上传 | ビズインテグラル（別システム）に請求書（PDF）を手動アップロードした | 绿色 |

### 2.3 プレビュー功能

#### 缩略图显示
| 属性 | 值 |
|------|-----|
| **显示方式** | 网格排列 |
| **点击动作** | 放大显示 |
| **多图处理** | 分页 |

#### 放大预览
| 属性 | 值 |
|------|-----|
| **显示方式** | 模态弹窗 |
| **导航** | 上一页/下一页 |
| **关闭** | 閉じる按钮 |

---

## 3. 交互流程

### 3.1 页面加载流程
| 步骤 | 行为 | 系统响应 |
|------|------|----------|
| 1 | 页面初始化 | 获取账单ID |
| 2 | 获取账单详情 | 查询数据库 |
| 3 | 获取账单图片 | 加载图片URL |
| 4 | 显示详情 | 渲染页面 |

### 3.2 预览流程
| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 点击图片 | 显示放大预览 |
| 2 | 翻页操作 | 切换图片 |
| 3 | 点击关闭 | 关闭预览 |

### 3.3 确认流程
| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 点击OK/NG | 验证条件 |
| 2 | 确认操作 | 更新状态 |
| 3 | 刷新页面 | 显示新状态 |

### 3.4 上传流程
| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 点击上传按钮 | 显示文件选择 |
| 2 | 选择文件 | 预览文件 |
| 3 | 确认上传 | 上传文件 |
| 4 | 刷新页面 | 显示上传结果 |

---

## 4. 界面规范

### 4.1 页面布局
| 属性 | PC端值 | SP端值 | 说明 |
|------|--------|--------|------|
| **页面类型** | PC | 不支持 | ≪PC≫标识 |
| **布局方式** | 上中下结构 | - | 信息+预览+操作 |

### 4.2 状态颜色
| 状态 | 颜色 | 说明 |
|------|------|------|
| 未提出 | 灰色 | 未上传 |
| 要確認 | 橙色 | 需确认 |
| チェック未 | 黄色 | 未检查 |
| チェック済 | 蓝色 | 已检查 |
| 差戻し | 红色 | 被退回 |

### 4.3 金额差異颜色
| 状态 | 颜色 | 说明 |
|------|------|------|
| なし | 绿色 | 金额一致 |
| あり | 红色 | 金额不一致 |

---

## 5. API接口设计

### 5.1 账单详情API
```yaml
# 获取账单详情
GET /api/v1/billing/{billingId}
Authorization: Bearer {token}
```

### 5.2 账单图片API
```yaml
# 获取账单图片列表
GET /api/v1/billing/{billingId}/images
Authorization: Bearer {token}

# 获取单张图片
GET /api/v1/billing/{billingId}/images/{imageId}
Authorization: Bearer {token}
```

### 5.3 确认操作API
```yaml
# 确认OK
POST /api/v1/billing/{billingId}/confirm-ok
Authorization: Bearer {token}

# 确认NG
POST /api/v1/billing/{billingId}/confirm-ng
Authorization: Bearer {token}
```

### 5.4 代理上传API
```yaml
# 代理上传
POST /api/v1/billing/{billingId}/upload
Authorization: Bearer {token}
Content-Type: multipart/form-data
```

---

## 6. 前端实现

### 6.1 详情页面组件
```typescript
// b7详情组件
import { Card, Button, Tag, Image, Modal } from 'antd';

export const B7DetailPage: React.FC = () => {
  const [previewVisible, setPreviewVisible] = useState(false);
  const [currentImage, setCurrentImage] = useState(0);

  const handlePreview = (index: number) => {
    setCurrentImage(index);
    setPreviewVisible(true);
  };

  return (
    <div className="b7-detail-container">
      <BasicInfoSection data={billingData} />
      <PreviewSection
        images={billingData.images}
        onPreview={handlePreview}
      />
      <AmountSection data={billingData} />
      <ActionButtons
        onConfirmOk={handleConfirmOk}
        onConfirmNg={handleConfirmNg}
        onUpload={handleUpload}
      />
      <MessageSection />
      <Modal
        visible={previewVisible}
        footer={null}
        onCancel={() => setPreviewVisible(false)}
      >
        <Image src={billingData.images[currentImage]} />
      </Modal>
    </div>
  );
};
```

---

## 7. 验收标准

### 7.1 功能验收
- [ ] 正确显示账单详情
- [ ] プレビュー功能正常
- [ ] 金額確認显示正确
- [ ] 確認OK功能正常
- [ ] 確認NG功能正常
- [ ] 代理上传功能正常
- [ ] メッセージ功能正常

### 7.2 视觉验收
- [ ] 布局与设计稿一致
- [ ] 状态颜色正确
- [ ] 预览显示正确

### 7.3 性能验收
- [ ] 页面加载 < 2秒
- [ ] 预览加载 < 1秒

---

## 8. 变更日志

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|---------|------|
| 2026-02-XX| v1.0 | 初始版本 | - |

---

## 附录

### A.1 相关文档
| 文档 | 路径 | 说明 |
|------|------|------|
| 公共技术架构规范 | [\_公共技术架构规范.md](../_公共技术架构规范.md) | 前后端技术架构详细规范 |
| b6-被請求管理 | [../b6-被請求管理/05_设计规范.md](../b6-被請求管理/05_设计规范.md) | 列表页面设计规范 |

### A.2 与p7-被請求詳細对比
| 特性 | b7-被請求詳細 | p7-被請求詳細 |
|------|---------------|---------------|
| **用户类型** | ベース | 輸送パートナー |
| **设备支持** | PCのみ | PC/SP |

---

**文档编制**: -  
**编制时间**: 2026-02-XX 
**适用范围**: 別紙_画面一覧_v151.xlsx - b7-被請求詳細  
**交叉引用**: [\_公共技术架构规范.md](../_公共技术架构规范.md)
