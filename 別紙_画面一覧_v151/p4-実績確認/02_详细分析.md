# p4-実績確認 - 详细分析

## 1. 页面概述

### 1.1 页面定位

p4-実績確認 是パートナー側（合作伙伴端）的业绩确认页面。パートナー通过此页面查看来自ベース（总部）的业绩详细信息，并确认已阅读。

### 1.2 核心功能

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 业绩详情展示 | 显示完整业绩信息 | P0-必须 |
| 确认操作 | 标记业绩为已确认 | P0-必须 |
| 关联订单查看 | 查看关联的订单信息 | P1-建议 |
| 状态追踪 | 跟踪确认状态 | P1-建议 |

### 1.3 与b4的差异

| 特性 | b4-実績検索 | p4-実績確認 |
|------|-------------|-------------|
| **用户角色** | ベース（总部） | 輸送パートナー（合作伙伴） |
| **页面类型** | 列表页面 | 详情页面 |
| **主要操作** | 搜索、导出 | 确认操作 |
| **设备支持** | PCのみ | PC/SP |

---

## 2. 页面结构层次

### 2.1 整体结构

```
輸送パートナーシステム
├── p4-実績確認（业绩确认页）
│   ├── 页面头部
│   │   ├── 返回按钮 ← p4列表页
│   │   └── 页面标题
│   ├── 业绩基本信息区域
│   │   ├── 実績ID（业绩ID）
│   │   ├── 受注ID（关联订单ID）
│   │   ├── 年月（业绩年月）
│   │   └── 依頼ベース（委托基地）
│   ├── 业绩详细信息区域
│   │   ├── 実績内容（业绩详细内容）
│   │   ├── 完了日（完成日期）
│   │   └── ステータス（状态标签）
│   ├── 确认信息区域
│   │   ├── 確認日（确认日期）
│   │   └── 確認者（确认者信息）
│   └── 操作按钮区域
│       └── 確認済にするボタン
```

### 2.2 区域详细说明

#### 区域1：页面头部

| 元素 | 类型 | 说明 |
|------|------|------|
| 返回按钮 | Button | 导航回业绩列表页 |
| 页面标题 | Text | "実績確認" |

#### 区域2：业绩基本信息

| 元素 | 类型 | 数据格式 | 说明 |
|------|------|----------|------|
| 実績ID | Text | 文字列 | 业绩唯一标识符 |
| 受注ID | Link | 文字列 | 点击跳转关联订单 |
| 年月 | Text | YYYY-MM | 业绩所属年月 |
| 依頼ベース | Text | 文字列 | 委托基地名称 |

#### 区域3：业绩详细信息

| 元素 | 类型 | 数据格式 | 说明 |
|------|------|----------|------|
| 実績内容 | TextArea | テキスト | 业绩详细描述 |
| 完了日 | Date | YYYY/MM/DD | 业绩完成日期 |
| ステータス | Tag | 枚举 | 当前状态 |

#### 区域4：确认信息

| 元素 | 类型 | 数据格式 | 说明 |
|------|------|----------|------|
| 確認日 | DateTime | YYYY/MM/DD HH:mm | 确认时间 |
| 確認者 | Text | 文字列 | 确认人信息 |

#### 区域5：操作按钮

| 元素 | 类型 | 颜色 | 说明 |
|------|------|------|------|
| 確認済にする | Primary Button | 蓝色 | 标记为已确认 |

---

## 3. 字段详细分析

### 3.1 字段清单

| 字段标识 | 字段名称 | 数据类型 | 必填 | 最大长度 | 业务规则 |
|----------|----------|----------|------|----------|----------|
| result_id | 実績ID | string | 是 | 50 | 业绩唯一标识 |
| order_id | 受注ID | string | 是 | 50 | 关联订单ID |
| result_year_month | 年月 | string | 是 | 7 | YYYY-MM格式 |
| base_name | 依頼ベース | string | 是 | 200 | 委托基地名称 |
| result_content | 実績内容 | text | 是 | 4000 | 业绩详细描述 |
| completion_date | 完了日 | date | 是 | 10 | 完成日期 |
| status | ステータス | enum | 是 | 20 | 确认状态 |
| confirmed_at | 確認日 | datetime | 否 | 16 | 确认时间 |
| confirmed_by | 確認者 | string | 否 | 100 | 确认人 |

### 3.2 状态枚举值

| 状态值 | 显示名称 | 颜色 | 说明 |
|--------|----------|------|------|
| UNCONFIRMED | 未確認 | 橙色 | 待合作伙伴确认 |
| CONFIRMED | 確認済 | 绿色 | 合作伙伴已确认 |

### 3.3 字段验证规则

| 字段 | 验证规则 | 错误提示 |
|------|----------|----------|
| 確認操作 | 状态必须为UNCONFIRMED | "すでに確認済みです" |
| 关联查询 | 订单必须属于当前合作伙伴 | "この注文へのアクセス権がありません" |

---

## 4. 交互流程详细说明

### 4.1 页面加载流程

```
┌─────────────────────────────────────────────────────────────┐
│  页面加载流程                                                │
├─────────────────────────────────────────────────────────────┤
│  1. 用户从业绩列表点击业绩                                      │
│     ↓                                                        │
│  2. 获取业绩ID参数                                            │
│     ↓                                                        │
│  3. 调用API获取业绩详情                                        │
│     GET /api/v1/partners/results/{resultId}                   │
│     ↓                                                        │
│  4. 显示加载状态（骨架屏）                                      │
│     ↓                                                        │
│  5. API返回数据                                               │
│     ↓                                                        │
│  6. 渲染业绩基本信息                                           │
│     ↓                                                        │
│  7. 渲染业绩详细信息                                           │
│     ↓                                                        │
│  8. 渲染确认信息区域（如果已确认）                               │
│     ↓                                                        │
│  9. 渲染操作按钮（根据状态判断）                                │
│     ↓                                                        │
│  10. 页面加载完成                                              │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 确认操作流程

```
┌─────────────────────────────────────────────────────────────┐
│  确认操作流程                                                │
├─────────────────────────────────────────────────────────────┤
│  1. 用户点击「確認済にする」按钮                                │
│     ↓                                                        │
│  2. 显示确认对话框                                            │
│     タイトル：「実績を確認します宜しいですか？」                 │
│     内容：「この実績を確認済みとしてマークします。」             │
│     ↓                                                        │
│  3. 用户确认                                                  │
│     ↓                                                        │
│  4. 调用确认API                                               │
│     POST /api/v1/partners/results/{resultId}/confirm           │
│     ↓                                                        │
│  5. 显示加载状态                                              │
│     ↓                                                        │
│  6. API处理成功                                               │
│     ↓                                                        │
│  7. 显示成功提示                                              │
│     Toast: "実績を確認しました"                                 │
│     ↓                                                        │
│  8. 更新本地状态                                              │
│     ↓                                                        │
│  9. 显示确认信息                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 5. 状态流转说明

### 5.1 业绩状态流转图

```
                    ┌─────────────────┐
                    │   UNCONFIRMED    │  ← 初始状态（未確認）
                    │   （未確認）     │
                    └────────┬────────┘
                             │
                             │ 合作伙伴确认
                             ↓
                    ┌─────────────────┐
                    │    CONFIRMED    │  ← 终止状态（確認済）
                    │   （確認済）     │
                    └─────────────────┘
```

### 5.2 状态流转规则

| 当前状态 | 允许操作 | 目标状态 | 触发条件 |
|----------|----------|----------|----------|
| UNCONFIRMED | 確認 | CONFIRMED | 合作伙伴点击确认按钮 |
| CONFIRMED | - | - | 终止状态 |

---

## 6. 业务规则

### 6.1 确认规则

- 仅限当前合作伙伴（业绩归属者）可确认
- 状态为UNCONFIRMED时，确认按钮可用
- 状态为CONFIRMED时，按钮禁用
- 确认后不可撤销

### 6.2 关联规则

- 每个业绩关联一个订单
- 订单必须属于当前合作伙伴
- 可从业绩跳转到关联订单详情

### 6.3 显示规则

- 未确认时显示操作按钮
- 已确认时显示确认信息和时间
- 确认者显示合作伙伴名称

---

## 7. 异常处理

### 7.1 异常场景

| 场景 | 处理方式 | 用户提示 |
|------|----------|----------|
| 业绩不存在 | 返回404，提示返回列表 | "実績が見つかりません" |
| 无操作权限 | 返回403，禁用按钮 | "この実績を操作する権限がありません" |
| 业绩已确认 | 返回400，禁用按钮 | "すでに確認済みです" |
| 网络错误 | 重试机制 | "ネットワークエラーが発生しました" |
| 服务器错误 | 提示稍后重试 | "サーバーエラーが発生しました" |

### 7.2 错误代码

| 错误码 | 说明 | 处理 |
|--------|------|------|
| RESULT_NOT_FOUND | 业绩不存在 | 返回列表页 |
| RESULT_ALREADY_CONFIRMED | 业绩已确认 | 刷新页面数据 |
| PERMISSION_DENIED | 无权限 | 提示权限问题 |
| INVALID_REQUEST | 请求参数错误 | 校验输入 |

---

## 8. 性能要求

| 指标 | 要求 | 说明 |
|------|------|------|
| 页面加载时间 | < 2秒 | 首屏渲染完成 |
| API响应时间 | < 500ms | 详情数据获取 |
| 按钮点击响应 | < 200ms | 操作反馈 |

---

## 9. 兼容性要求

### 9.1 响应式设计

| 断点 | 布局 | 说明 |
|------|------|------|
| PC (≥1024px) | 双栏布局 | 左侧详情，右侧操作 |
| 平板 (768-1023px) | 单栏布局 | 垂直滚动 |
| 手机 (<768px) | 单栏紧凑 | 优化触摸操作 |

### 9.2 浏览器支持

| 浏览器 | 最低版本 | 说明 |
|--------|----------|------|
| Chrome | 90 | 推荐 |
| Firefox | 88 | 支持 |
| Safari | 14 | 支持 |
| Edge | 90 | 支持 |

---

**文档编制**: -  
**编制时间**: 2026-02-XX 
**适用范围**: p4-実績確認 合作伙伴业绩确认页面
