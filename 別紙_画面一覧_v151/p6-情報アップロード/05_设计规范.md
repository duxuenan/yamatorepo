# p6-è«‹æ±‚æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ - è®¾è®¡è§„èŒƒ

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **å·¥ä½œè¡¨åç§°** | p6-è«‹æ±‚æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ |
| **ç•Œé¢ç¼–å·** | p6 |
| **å¯¹åº”Baseç•Œé¢** | b8-CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ |
| **æ–‡æ¡£ç‰ˆæœ¬** | v1.0.1 |
| **æœ€åæ›´æ–°** | 2026-02-10 |
| **æ–‡æ¡£çŠ¶æ€** | âœ… å·²å‘å¸ƒ |

### 1.2 åŠŸèƒ½æè¿°

p6-è«‹æ±‚æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ æ˜¯åˆä½œä¼™ä¼´ï¼ˆãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ï¼‰ä¾§çš„è¯·æ±‚ä¹¦ä¸Šè½½é¡µé¢ã€‚ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å¯ä»¥é€šè¿‡æ­¤é¡µé¢ä¸Šä¼ PDFæ ¼å¼çš„è¯·æ±‚ä¹¦æ–‡ä»¶ï¼Œå¹¶å°†å…¶å‘é€ç»™æŒ‡å®šçš„ãƒ™ãƒ¼ã‚¹ï¼ˆåŸºåœ°/æ®ç‚¹ï¼‰ã€‚

### 1.3 æŠ€æœ¯æ¶æ„

æœ¬æ–‡æ¡£åŸºäº **å‰åç«¯åˆ†ç¦»æ¶æ„**ï¼Œè¯¦ç»†æŠ€æœ¯è§„èŒƒè¯·å‚è€ƒï¼š

ğŸ‘‰ **[\_å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ.md](../_å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ.md)**

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| å‰ç«¯ | React 18.x + TypeScript + Ant Design |
| åç«¯ | Spring Boot 3.x + Java 17 |
| æ•°æ®åº“ | PostgreSQL 15.x |
| è®¤è¯ | AzureAD (OAuth 2.0 / OIDC) with JWT |

### 1.4 æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| è¯·æ±‚ä¹¦ä¸Šä¼  | PDFæ–‡ä»¶ä¸Šä¼ ï¼ˆæ”¯æŒå¤šæ–‡ä»¶ï¼‰ | P0-å¿…é¡» |
| åŸºåœ°é€‰æ‹© | é€‰æ‹©è¯·æ±‚ä¹¦å‘é€ç›®æ ‡åŸºåœ° | P0-å¿…é¡» |
| ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ | æ˜¾ç¤ºå·²ä¸Šä¼ çš„è¯·æ±‚ä¹¦åˆ—è¡¨ | P0-å¿…é¡» |
| è¯·æ±‚ä¹¦å‘é€ | å°†è¯·æ±‚ä¹¦å‘é€ç»™æŒ‡å®šåŸºåœ° | P0-å¿…é¡» |
| é¢„è§ˆåŠŸèƒ½ | é¢„è§ˆä¸Šä¼ çš„è¯·æ±‚ä¹¦PDF | P1-å»ºè®® |
| åˆ é™¤åŠŸèƒ½ | åˆ é™¤å·²ä¸Šä¼ çš„è¯·æ±‚ä¹¦ | P1-å»ºè®® |
| æ¶ˆæ¯åŠŸèƒ½ | ä¸åŸºåœ°è¿›è¡Œæ¶ˆæ¯äº¤æµ | P1-å»ºè®® |
| æ–‡ä»¶é™„ä»¶ | æ¶ˆæ¯ä¸­å¯é™„åŠ æ–‡ä»¶ | P1-å»ºè®® |

### 1.5 ä¸šåŠ¡è§„åˆ™

| è§„åˆ™ç¼–å· | è§„åˆ™æè¿° |
|----------|----------|
| BR-001 | åªæœ‰å®Ÿç¸¾ï¼ˆä¸šç»©ï¼‰å·²ç¡®è®¤çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½ä¸Šä¼ è¯·æ±‚ä¹¦ |
| BR-002 | å¦‚æœä¸šç»©æœªç¡®è®¤ï¼Œç”»é¢æ˜¾ç¤ºã€Œå¯¾è±¡ã®è«‹æ±‚ãŒã‚ã‚Šã¾ã›ã‚“ã€ï¼ˆæ— ç›¸å…³è¯·æ±‚ï¼‰ |
| BR-003 | å¯¾è±¡æœˆæ˜¾ç¤ºè¯·æ±‚å¯¹è±¡çš„å¹´æœˆ |
| BR-004 | æ”¯æŒå¤šæ–‡ä»¶åŒæ—¶ä¸Šä¼  |
| BR-005 | è¯·æ±‚ä¹¦å‘é€åï¼ŒåŸºåœ°å¯ä»¥åœ¨b8-CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æŸ¥çœ‹ |

### 1.6 é€‚ç”¨èŒƒå›´

- å‰ç«¯å¼€å‘äººå‘˜ï¼ˆè¯·æ±‚ä¹¦ä¸Šè½½é¡µé¢ç»„ä»¶å®ç°ï¼‰
- åç«¯å¼€å‘äººå‘˜ï¼ˆè¯·æ±‚ä¹¦å¤„ç†APIå¼€å‘ï¼‰
- æµ‹è¯•å·¥ç¨‹å¸ˆï¼ˆåŠŸèƒ½æµ‹è¯•ï¼‰

---

## 2. é¡µé¢å…ƒç´ 

### 2.1 å…ƒç´ æ¸…å•

| åºå· | å…ƒç´ åç§° | å…ƒç´ ç±»å‹ | åŠŸèƒ½è¯´æ˜ | äº¤äº’è§¦å‘ |
|------|----------|----------|----------|----------|
| â‘´ | å¯¾è±¡æœˆ | Text | æ˜¾ç¤ºè¯·æ±‚å¯¹è±¡çš„å¹´æœˆ | è¡¨ç¤º |
| â‘µ | è«‹æ±‚å…ˆé¸æŠ | Select | é€‰æ‹©è¯·æ±‚ä¹¦å‘é€ç›®æ ‡åŸºåœ° | ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³é¸æŠ |
| â‘¶ | ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ | DragDrop | è¯·æ±‚ä¹¦æ–‡ä»¶æ‹–æ‹½ä¸Šä¼  | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‰ãƒ©ãƒƒã‚° |
| â‘· | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆ | Table | æ˜¾ç¤ºå·²ä¸Šä¼ çš„è¯·æ±‚ä¹¦åˆ—è¡¨ | è¡Œã‚¯ãƒªãƒƒã‚¯ |
| â‘¸ | ä¼šç¤¾åã‚³ãƒ¼ãƒ‰ | Text | æ˜¾ç¤ºãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼çš„å…¬å¸ä»£ç  | è¡¨ç¤º |
| â‘¹ | ãƒ•ã‚¡ã‚¤ãƒ«å | Link | æ˜¾ç¤ºä¸Šä¼ çš„è¯·æ±‚ä¹¦æ–‡ä»¶å | ã‚¯ãƒªãƒƒã‚¯ |
| â‘º | è«‹æ±‚å…ˆ | Text | æ˜¾ç¤ºè¯·æ±‚ä¹¦å‘é€ç›®æ ‡åŸºåœ°å | è¡¨ç¤º |
| â‘» | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | Text | æ˜¾ç¤ºæ“ä½œå†å² | è¡¨ç¤º |
| â‘¼ | æ›´æ–°æ—¥æ™‚ | DateTime | æ˜¾ç¤ºæœ€åæ›´æ–°æ—¶é—´ | è¡¨ç¤º |
| â‘½ | æ›´æ–°è€… | Text | æ˜¾ç¤ºæœ€åæ“ä½œç”¨æˆ·å | è¡¨ç¤º |
| â‘¾ | ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ | Link | é¢„è§ˆè¯·æ±‚ä¹¦PDF | ã‚¯ãƒªãƒƒã‚¯ |
| â‘¿ | å‰Šé™¤ | Icon Button | åˆ é™¤å·²ä¸Šä¼ çš„æ–‡ä»¶ | ã‚¯ãƒªãƒƒã‚¯ |
|â’€ | è«‹æ±‚æ›¸ã‚’é€ä»˜ã™ã‚‹ | Primary Button | å‘é€è¯·æ±‚ä¹¦ç»™ç›®æ ‡åŸºåœ° | ã‚¯ãƒªãƒƒã‚¯ |
|â’ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | Button | æ‰“å¼€æ¶ˆæ¯é¢æ¿ | ã‚¯ãƒªãƒƒã‚¯ |
|â’‚ | ã‚³ãƒ¡ãƒ³ãƒˆãƒœãƒƒã‚¯ã‚¹ | TextArea | è¾“å…¥æ¶ˆæ¯å†…å®¹ | æ–‡å­—å…¥åŠ› |
|â’ƒ | é€ä¿¡ | Button | å‘é€æ¶ˆæ¯ | ã‚¯ãƒªãƒƒã‚¯ |
|â’„ | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | Link | åœ¨æ¶ˆæ¯ä¸­é™„åŠ æ–‡ä»¶ | ã‚¯ãƒªãƒƒã‚¯ |

### 2.2 å­—æ®µè¯¦ç»†è¯´æ˜

| å­—æ®µ | å…ƒç´ ç±»å‹ | çº¦æŸ | æ•°æ®æ ¼å¼ | é»˜è®¤ |
|------|----------|------|----------|------|
| å¯¾è±¡æœˆ | Text | åªè¯» | YYYYå¹´MMæœˆ | - |
| è«‹æ±‚å…ˆ | Select | å¿…é ˆ | ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å…³è”çš„ãƒ™ãƒ¼ã‚¹åˆ—è¡¨ | ç©º |
| ãƒ•ã‚¡ã‚¤ãƒ« | DragDrop | å¿…é ˆ,æœ€å¤§10MB | .pdf | ç©º |
| ã‚³ãƒ¡ãƒ³ãƒˆ | TextArea | æœ€å¤§500å­— | æ–‡å­—åˆ— | ç©º |

### 2.3 ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨è¯¦ç»†è¯´æ˜

| ã‚«ãƒ©ãƒ å | è¦ç´ ã‚¿ã‚¤ãƒ— | æ›¸å¼ | ã‚½ãƒ¼ãƒˆ | èª¬æ˜ |
|----------|-----------|------|--------|------|
| ä¼šç¤¾åã‚³ãƒ¼ãƒ‰ | Text | æ–‡å­—åˆ— | â—‹ | ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼çš„å…¬å¸ã‚³ãƒ¼ãƒ‰ |
| ãƒ•ã‚¡ã‚¤ãƒ«å | Link | æ–‡å­—åˆ— | â—‹ | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸè«‹æ±‚æ›¸ã®ãƒ•ã‚¡ã‚¤ãƒ«å |
| è«‹æ±‚å…ˆ | Text | æ–‡å­—åˆ— | â—‹ | è«‹æ±‚æ›¸ã‚’é€ä»˜ã™ã‚‹ãƒ™ãƒ¼ã‚¹å |
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | Text | æ–‡å­—åˆ— | â—‹ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å±¥æ­´ |
| æ›´æ–°æ—¥æ™‚ | DateTime | YYYY/MM/DD HH:mm | â—‹ | æœ€å¾Œæ›´æ–°æ—¥æ™‚ |
| æ›´æ–°è€… | Text | æ–‡å­—åˆ— | â—‹ | æœ€å¾Œæ›´æ–°ãƒ¦ãƒ¼ã‚¶ãƒ¼ |
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | Button | ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼/å‰Šé™¤ | - | ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º/å‰Šé™¤ |

### 2.4 æ¶ˆæ¯é¢æ¿å…ƒç´ 

| åºå· | å…ƒç´ åç§° | å…ƒç´ ç±»å‹ | åŠŸèƒ½è¯´æ˜ |
|------|----------|----------|----------|
| â‘´ | ãƒ™ãƒ¼ã‚¹é¸æŠ | Select | é€‰æ‹©è¿›è¡Œæ¶ˆæ¯äº¤æµçš„åŸºåœ° |
| â‘µ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ | List | æ˜¾ç¤ºæ¶ˆæ¯äº¤æµå†å² |
| â‘¶ | ã‚³ãƒ¡ãƒ³ãƒˆãƒœãƒƒã‚¯ã‚¹ | TextArea | è¾“å…¥æ¶ˆæ¯å†…å®¹ |
| â‘· | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | Link | é™„åŠ æ–‡ä»¶ |
| â‘¸ | é€ä¿¡ | Button | å‘é€æ¶ˆæ¯ |
| â‘¹ | ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ | Link | ä¸‹è½½é™„åŠ æ–‡ä»¶ |

---

## 3. äº¤äº’æµç¨‹

### 3.1 ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼

| ã‚¹ãƒ†ãƒƒãƒ— | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | ã‚·ã‚¹ãƒ†ãƒ å¿œç­” |
|----------|-----------|--------------|
| 1 | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒp6ãƒšãƒ¼ã‚¸ã¸é·ç§» | ãƒšãƒ¼ã‚¸åˆæœŸåŒ– |
| 2 | æ¥­ç¸¾ç¢ºèªAPIå®Ÿè¡Œ | GET /api/v1/partners/achievements/confirmed |
| 3 | å®Ÿç¸¾ç¢ºèªæ¸ˆã¿åˆ¤å®š | ç¢ºèªæ¸ˆã¿â†’è«‹æ±‚æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è¡¨ç¤º / æœªç¢ºèªâ†’ã€Œå¯¾è±¡ã®è«‹æ±‚ãŒã‚ã‚Šã¾ã›ã‚“ã€è¡¨ç¤º |
| 4 | è«‹æ±‚å…ˆãƒªã‚¹ãƒˆAPIå®Ÿè¡Œ | GET /api/v1/partners/bases |
| 5 | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«APIå®Ÿè¡Œ | GET /api/v1/partners/invoices |
| 6 | APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡ | ãƒ‡ãƒ¼ã‚¿è¨­å®š |
| 7 | ãƒšãƒ¼ã‚¸è¡¨ç¤ºå®Œäº† | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¾…æ©Ÿ |

### 3.2 è«‹æ±‚æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼

| ã‚¹ãƒ†ãƒƒãƒ— | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ | ã‚·ã‚¹ãƒ†ãƒ å¿œç­” |
|----------|-------------|--------------|
| 1 | è«‹æ±‚å…ˆã‚’é¸æŠ | é¸æŠã•ã‚ŒãŸè«‹æ±‚å…ˆã‚’è¡¨ç¤º |
| 2 | ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã¾ãŸã¯é¸æŠ | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º |
| 3 | ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ | ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼å®Ÿè¡Œï¼ˆPDFå½¢å¼ã€10MBä»¥ä¸‹ï¼‰ |
| 4 | æ¤œè¨¼æˆåŠŸ | ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±è¡¨ç¤º |
| 5 | æ¤œè¨¼å¤±æ•— | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º |
| 6 | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ– | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æº–å‚™å®Œäº† |

### 3.3 è«‹æ±‚æ›¸ã‚’é€ä»˜ã™ã‚‹ãƒ•ãƒ­ãƒ¼

| ã‚¹ãƒ†ãƒƒãƒ— | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ | ã‚·ã‚¹ãƒ†ãƒ å¿œç­” |
|----------|-------------|--------------|
| 1 | ã€Œè«‹æ±‚æ›¸ã‚’é€ä»˜ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ | ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º |
| 2 | ç¢ºèª | é€ä»˜å‡¦ç†é–‹å§‹ |
| 3 | é€ä»˜å‡¦ç†å®Œäº† | å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º |
| 4 | åŸºåœ°ã«é€šçŸ¥å‘é€ | b8-CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§è«‹æ±‚æ›¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ |

### 3.4 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ•ãƒ­ãƒ¼

| ã‚¹ãƒ†ãƒƒãƒ— | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ | ã‚·ã‚¹ãƒ†ãƒ å¿œç­” |
|----------|-------------|--------------|
| 1 | ã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ | ç”»é¢å³å´ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ãƒãƒ«è¡¨ç¤º |
| 2 | ãƒ™ãƒ¼ã‚¹ã‚’é¸æŠ | å½“è©²ãƒ™ãƒ¼ã‚¹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´è¡¨ç¤º |
| 3 | ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ› | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ› |
| 4 | ã€Œé€ä¿¡ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å‡¦ç† |
| 5 | å®Œäº† | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ã«æ–°è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º |

---

## 4. ç•Œé¢è§„èŒƒ

### 4.1 ãƒšãƒ¼ã‚¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

| å±æ€§ | PCç«¯å€¼ | SPç«¯å€¼ | è¯´æ˜ |
|------|--------|--------|------|
| **ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—** | PCå¯¾å¿œ | SPå¯¾å¿œ | PC/SPä¸¡å¯¾å¿œï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ï¼‰ |
| **ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢** | å·¦å´ãƒ¡ã‚¤ãƒ³ / å³å´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | ç¸¦ä¸¦ã³ | ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ |
| **ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢** | ä¸­å¤®é…ç½® | å¹…100% | ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—å¯¾å¿œ |
| **ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«** | å¹…100% | æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« | ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ |
| **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ãƒãƒ«** | å³å´å›ºå®š | Bottom Sheet | ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³/ã‚¢ã‚¦ãƒˆ |

### 4.2 ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ä»•æ§˜

| å±æ€§ | å€¤ | èª¬æ˜ |
|------|----|------|
| **ã‚¨ãƒªã‚¢ã‚µã‚¤ã‚º** | 400x200px | å›ºå®šã‚µã‚¤ã‚º |
| **å¯¾å¿œãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼** | PDF | PDFã®ã¿ |
| **æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º** | 10MB | 10MBä»¥ä¸‹ |
| **ãƒ‰ãƒ©ãƒƒã‚°ãƒ©ãƒ³ãƒ‰è‰²** | #e6f7ff | ãƒã‚¤ãƒ©ã‚¤ãƒˆæ™‚ |
| **ãƒœãƒ¼ãƒ€ãƒ¼** | 2px dashed #1890ff | ç‚¹ç·šãƒœãƒ¼ãƒ€ãƒ¼ |

### 4.3 ãƒ†ãƒ¼ãƒ–ãƒ«ä»•æ§˜

| å±æ€§ | å€¤ | èª¬æ˜ |
|------|----|------|
| **è¡Œé«˜** | 48px | å›ºå®šè¡Œé«˜ |
| **ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º** | 14px | æ¨™æº–ãƒ†ã‚­ã‚¹ãƒˆ |
| **ç¸æ¨¡æ§˜** | æœ‰ã‚Š | å¶æ•°è¡ŒèƒŒæ™¯#fafafa |
| **ãƒ›ãƒãƒ¼åŠ¹æœ** | æœ‰ã‚Š | è¡Œãƒ›ãƒãƒ¼èƒŒæ™¯#f5f5f5 |

---

## 5. ç”»é¢-API-æ•°æ®åº“å…³ç³»æ˜ å°„

### 5.1 å…³ç³»æ€»è§ˆè¡¨

| åºå· | ç”»é¢å…ƒç´  | API Endpoint | Method | åŠŸèƒ½è¯´æ˜ | æ•°æ®åº“è¡¨ | å­—æ®µæ˜ å°„ | å¤‡æ³¨ |
|------|----------|--------------|--------|----------|----------|----------|------|
| 1 | å¯¾è±¡æœˆè¡¨ç¤º | /api/v1/partners/achievements/confirmed | GET | è·å–å·²ç¡®è®¤ä¸šç»© | m_achievement | achievement.month â†’ month | YYYYå¹´MMæœˆå½¢å¼ |
| 2 | è«‹æ±‚å…ˆé¸æŠ | /api/v1/partners/bases | GET | è·å–å…³è”åŸºåœ°åˆ—è¡¨ | m_base, m_partner_base | base.base_id, base.base_name | LEFT JOIN m_partner_base |
| 3 | ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ | /api/v1/partners/invoices/upload | POST | ä¸Šä¼ è¯·æ±‚ä¹¦PDF | t_invoice_file | invoice_id, file_path, file_name | multipart/form-data |
| 4 | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆ | /api/v1/partners/invoices | GET | è·å–å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ | t_invoice_file | invoice_id, file_name, base_id | æ”¯æŒåˆ†é¡µ |
| 5 | ä¼šç¤¾åã‚³ãƒ¼ãƒ‰ | /api/v1/partners/invoices | GET | è·å–å…¬å¸ä»£ç  | m_partner | partner.company_code | JOIN partnerè¡¨ |
| 6 | ãƒ•ã‚¡ã‚¤ãƒ«å | /api/v1/partners/invoices/{id}/preview | GET | è·å–é¢„è§ˆURL | t_invoice_file | file_path â†’ preview_url | è¿”å›ä¸´æ—¶é¢„è§ˆé“¾æ¥ |
| 7 | è«‹æ±‚å…ˆ | /api/v1/partners/bases | GET | è·å–åŸºåœ°åç§° | m_base | base.base_name | æ˜¾ç¤ºç”¨ |
| 8 | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | /api/v1/partners/invoices | GET | è·å–æ“ä½œå†å² | t_invoice_send_log | action_type | å…³è”å‘é€æ—¥å¿— |
| 9 | æ›´æ–°æ—¥æ™‚ | /api/v1/partners/invoices | GET | è·å–æ›´æ–°æ—¶é—´ | t_invoice_file | updated_at | YYYY/MM/DD HH:mm |
| 10 | æ›´æ–°è€… | /api/v1/partners/invoices | GET | è·å–æ›´æ–°è€…ä¿¡æ¯ | t_invoice_file, m_user | updated_by â†’ user_name | JOIN m_userè¡¨ |
| 11 | ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ | /api/v1/partners/invoices/{id}/preview | GET | PDFé¢„è§ˆ | t_invoice_file | file_path | æ–°çª—å£æ‰“å¼€ |
| 12 | å‰Šé™¤ | /api/v1/partners/invoices/{id} | DELETE | åˆ é™¤ä¸Šä¼ æ–‡ä»¶ | t_invoice_file | status â†’ DELETED | è½¯åˆ é™¤ |
| 13 | è«‹æ±‚æ›¸ã‚’é€ä»˜ã™ã‚‹ | /api/v1/partners/invoices/{id}/send | POST | å‘é€è¯·æ±‚ä¹¦ | t_invoice_file, t_invoice_send_log | status â†’ SENT | çŠ¶æ€æ›´æ–°+æ—¥å¿— |
| 14 | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | /api/v1/partners/messages | GET | è·å–æ¶ˆæ¯å†å² | t_message | message_id, content | å³ä¾§é¢æ¿ |
| 15 | ã‚³ãƒ¡ãƒ³ãƒˆãƒœãƒƒã‚¯ã‚¹ | /api/v1/partners/messages | POST | å‘é€æ¶ˆæ¯ | t_message | content, created_at | æ¶ˆæ¯è¾“å…¥ |
| 16 | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | /api/v1/partners/messages/{id}/attachments | POST | ä¸Šä¼ é™„ä»¶ | t_message_attachment | file_path | æ¶ˆæ¯é™„åŠ  |

### 5.2 API-æ•°æ®åº“å®Œæ•´æ˜ å°„è¡¨

#### 5.2.1 æ¥­ç¸¾ç¢ºèªé–¢é€£

| API Method | API Endpoint | Request Parameters | Response Fields | Database Tables | Table Fields |
|------------|--------------|-------------------|-----------------|-----------------|--------------|
| GET | /api/v1/partners/achievements/confirmed | partnerId (from token) | hasConfirmedAchievements, targetMonth, achievements[].achievementId, [].month, [].status, [].amount, [].orderCount | m_achievement | achievement.id, achievement.partner_id, achievement.month, achievement.status, achievement.total_amount, achievement.order_count |

#### 5.2.2 åŸºåœ°åˆ—è¡¨é–¢é€£

| API Method | API Endpoint | Request Parameters | Response Fields | Database Tables | Table Fields |
|------------|--------------|-------------------|-----------------|-----------------|--------------|
| GET | /api/v1/partners/bases | partnerId (from token) | bases[].baseId, [].baseName, [].address, [].contactPerson, [].contactEmail | m_base, m_partner_base | base.base_id, base.base_name, base.address, base.contact_person, base.contact_email, partner_base.partner_id |

#### 5.2.3 è«‹æ±‚æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰é–¢é€£

| API Method | API Endpoint | Request Parameters | Response Fields | Database Tables | Table Fields |
|------------|--------------|-------------------|-----------------|-----------------|--------------|
| POST | /api/v1/partners/invoices/upload | file, baseId, targetMonth, partnerId (from token) | invoiceId, fileName, status, uploadedAt | t_invoice_file | invoice_id, partner_id, base_id, file_name, file_path, file_size, target_month, status, uploaded_by, uploaded_at |
| GET | /api/v1/partners/invoices | partnerId (from token), page, pageSize | invoices[].invoiceId, [].companyCode, [].fileName, [].baseId, [].baseName, [].action, [].updatedAt, [].updatedBy, [].updatedByName, [].status, pagination.* | t_invoice_file, m_partner, m_base, m_user | invoice.invoice_id, partner.company_code, invoice.file_name, base.base_name, invoice.updated_at, user.user_name, invoice.status |
| GET | /api/v1/partners/invoices/{invoiceId}/preview | invoiceId, partnerId (from token) | previewUrl, expiresAt | t_invoice_file | invoice.file_path |
| DELETE | /api/v1/partners/invoices/{invoiceId} | invoiceId, partnerId (from token) | success, message | t_invoice_file | invoice.status â†’ DELETED, invoice.deleted_at |
| POST | /api/v1/partners/invoices/{invoiceId}/send | invoiceId, partnerId (from token) | invoiceId, status, sentAt, message | t_invoice_file, t_invoice_send_log | invoice.status â†’ SENT, send_log.log_id, send_log.sent_at, send_log.status |
| GET | /api/v1/partners/invoices/{invoiceId}/download | invoiceId, partnerId (from token) | (file download) | t_invoice_file | invoice.file_path |

#### 5.2.4 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é–¢é€£

| API Method | API Endpoint | Request Parameters | Response Fields | Database Tables | Table Fields |
|------------|--------------|-------------------|-----------------|-----------------|--------------|
| GET | /api/v1/partners/messages | baseId, partnerId (from token), page, pageSize | messages[].messageId, [].baseId, [].content, [].attachments, [].createdAt, [].createdBy, [].createdByName, [].direction, pagination.* | t_message, t_message_attachment | message.message_id, message.base_id, message.content, message.created_at, message.created_by, message.created_by_name, message.direction, attachment.* |
| POST | /api/v1/partners/messages | baseId, content, attachments[], partnerId (from token) | messageId, createdAt | t_message, t_message_attachment | message.message_id, message.content, message.created_at, attachment.attachment_id, attachment.file_path |
| GET | /api/v1/partners/messages/attachments/{attachmentId}/download | attachmentId, partnerId (from token) | (file download) | t_message_attachment | attachment.file_path |

### 5.3 ç”»é¢-API-æ•°æ®åº“å­—æ®µå®Œæ•´æ˜ å°„

| ç”»é¢é¡¹ç›® | APIè¯·æ±‚å­—æ®µ | APIå“åº”å­—æ®µ | æ•°æ®åº“è¡¨ | æ•°æ®åº“å­—æ®µ | æ•°æ®ç±»å‹ | è¯´æ˜ |
|----------|-------------|-------------|----------|-----------|----------|------|
| å¯¾è±¡æœˆ | - | hasConfirmedAchievements.targetMonth | m_achievement | month | VARCHAR(7) | YYYY-MMæ ¼å¼ |
| è«‹æ±‚å…ˆé¸æŠ(ä¸‹æ‹‰é€‰é¡¹) | - | bases[].baseId, [].baseName | m_base | base_id, base_name | VARCHAR | é€‰æ‹©é¡¹ |
| è«‹æ±‚å…ˆ(æ˜¾ç¤º) | - | invoices[].baseName | m_base | base_name | VARCHAR | åˆ—è¡¨æ˜¾ç¤º |
| ä¼šç¤¾åã‚³ãƒ¼ãƒ‰ | - | invoices[].companyCode | m_partner | company_code | VARCHAR(20) | åªè¯»æ˜¾ç¤º |
| ãƒ•ã‚¡ã‚¤ãƒ«å | file | invoices[].fileName | t_invoice_file | file_name | VARCHAR(255) | æ–‡ä»¶å |
| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | - | invoices[].action | t_invoice_send_log | action_type | VARCHAR(100) | æ“ä½œç±»å‹ |
| æ›´æ–°æ—¥æ™‚ | - | invoices[].updatedAt | t_invoice_file | updated_at | TIMESTAMP | YYYY/MM/DD HH:mm |
| æ›´æ–°è€… | - | invoices[].updatedByName | m_user | user_name | VARCHAR(100) | ç”¨æˆ·å§“å |
| ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼URL | - | previewUrl | t_invoice_file | file_path | VARCHAR(500) | ä¸´æ—¶é“¾æ¥ |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | - | invoices[].status | t_invoice_file | status | VARCHAR(20) | UPLOADED/SENT/DELETED |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ | content | messages[].content | t_message | content | TEXT | æ¶ˆæ¯æ­£æ–‡ |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ—¥æ™‚ | - | messages[].createdAt | t_message | created_at | TIMESTAMP | å‘é€æ—¶é—´ |
| æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«å | - | messages[].attachments[].fileName | t_message_attachment | file_name | VARCHAR(255) | é™„ä»¶å |

### 5.4 æ•°æ®åº“ERå…³ç³»å›¾

#### 5.2.1 ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒ‡ãƒ¼ã‚¿å–å¾—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ERå›³                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   m_partner         â”‚        â”‚   m_base            â”‚                  â”‚
â”‚  â”‚   (ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼)       â”‚        â”‚   (åŸºåœ°)             â”‚                  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚  â”‚ partner_id (PK)     â”‚â—„â”€â”€â”    â”‚ base_id (PK)        â”‚                  â”‚
â”‚  â”‚ partner_name        â”‚   â”‚    â”‚ base_name           â”‚                  â”‚
â”‚  â”‚ company_code         â”‚   â”‚    â”‚ address             â”‚                  â”‚
â”‚  â”‚ ...                 â”‚   â”‚    â”‚ contact_person      â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚ ...                 â”‚                  â”‚
â”‚         â”‚                   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚ 1:N               â”‚              â”‚ 1:N                             â”‚
â”‚         â–¼                   â”‚              â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ m_partner_base      â”‚    â”‚    â”‚ t_invoice_file      â”‚                  â”‚
â”‚  â”‚ (ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼-åŸºåœ°å…³è”) â”‚    â”‚    â”‚ (è¯·æ±‚ä¹¦æ–‡ä»¶)          â”‚                  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚  â”‚ id (PK)             â”‚    â”‚    â”‚ invoice_id (PK)     â”‚                  â”‚
â”‚  â”‚ partner_id (FK)     â”‚â—„â”€â”€â”€â”¼â”€â”€â”€â”€â”‚ partner_id (FK)     â”‚                  â”‚
â”‚  â”‚ base_id (FK)        â”‚â—„â”€â”€â”€â”˜    â”‚ base_id (FK)        â”‚                  â”‚
â”‚  â”‚ is_active           â”‚         â”‚ company_code        â”‚                  â”‚
â”‚  â”‚ created_at          â”‚         â”‚ file_name           â”‚                  â”‚
â”‚  â”‚ ...                 â”‚         â”‚ file_path           â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ file_size           â”‚                  â”‚
â”‚                                   â”‚ target_month        â”‚                  â”‚
â”‚                                   â”‚ status              â”‚                  â”‚
â”‚                                   â”‚ uploaded_by         â”‚                  â”‚
â”‚                                   â”‚ uploaded_at         â”‚                  â”‚
â”‚                                   â”‚ updated_by          â”‚                  â”‚
â”‚                                   â”‚ updated_at          â”‚                  â”‚
â”‚                                   â”‚ ...                 â”‚                  â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                            â”‚                                â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚                        â”‚                   â”‚                   â”‚            â”‚
â”‚                        â–¼                   â–¼                   â–¼            â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                 â”‚t_invoice_    â”‚     â”‚ t_message   â”‚     â”‚t_message_   â”‚    â”‚
â”‚                 â”‚send_log      â”‚     â”‚ (ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)â”‚     â”‚attachment   â”‚    â”‚
â”‚                 â”‚(å‘é€æ—¥å¿—)     â”‚     â”‚             â”‚     â”‚(é™„ä»¶)        â”‚    â”‚
â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚                 â”‚log_id (PK)  â”‚     â”‚message_id   â”‚     â”‚attachment_idâ”‚    â”‚
â”‚                 â”‚invoice_id   â”‚     â”‚ (PK)        â”‚     â”‚ (PK)        â”‚    â”‚
â”‚                 â”‚base_id      â”‚     â”‚partner_id   â”‚     â”‚message_id   â”‚    â”‚
â”‚                 â”‚sent_at      â”‚     â”‚base_id      â”‚     â”‚ (FK)        â”‚    â”‚
â”‚                 â”‚sent_by      â”‚     â”‚content      â”‚     â”‚file_name    â”‚    â”‚
â”‚                 â”‚status       â”‚     â”‚direction    â”‚     â”‚file_path    â”‚    â”‚
â”‚                 â”‚...          â”‚     â”‚created_by   â”‚     â”‚file_size    â”‚    â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚created_at   â”‚     â”‚...          â”‚    â”‚
â”‚                                      â”‚...          â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.5 æ ¸å¿ƒæ•°æ®åº“è¡¨ç»“æ„

#### 5.5.1 t_invoice_fileï¼ˆè«‹æ±‚æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|----------|------|------|
| id | BIGSERIAL | PK | è‡ªå¢ID |
| invoice_id | VARCHAR(50) | UNIQUE, NOT NULL | è«‹æ±‚æ›¸ID |
| partner_id | VARCHAR(50) | FK, NOT NULL | ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ID |
| base_id | VARCHAR(50) | FK, NOT NULL | åŸºåœ°ID |
| company_code | VARCHAR(20) | NOT NULL | ä¼šç¤¾åã‚³ãƒ¼ãƒ‰ |
| file_name | VARCHAR(255) | NOT NULL | ãƒ•ã‚¡ã‚¤ãƒ«å |
| file_path | VARCHAR(500) | NOT NULL | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ |
| file_size | BIGINT | NOT NULL | ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º(bytes) |
| target_month | VARCHAR(7) | NOT NULL | å¯¾è±¡æœˆ(YYYY-MM) |
| status | VARCHAR(20) | NOT NULL | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
| last_action | VARCHAR(100) | - | æœ€å¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ |
| uploaded_by | VARCHAR(50) | NOT NULL | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è€… |
| uploaded_at | TIMESTAMP | NOT NULL | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥æ™‚ |
| updated_by | VARCHAR(50) | - | æ›´æ–°è€… |
| updated_at | TIMESTAMP | - | æ›´æ–°æ—¥æ™‚ |
| deleted_at | TIMESTAMP | - | å‰Šé™¤æ—¥æ™‚ |

#### 5.5.2 t_invoice_send_logï¼ˆè«‹æ±‚æ›¸é€ä¿¡ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|----------|------|------|
| id | BIGSERIAL | PK | è‡ªå¢ID |
| log_id | VARCHAR(50) | UNIQUE, NOT NULL | ãƒ­ã‚°ID |
| invoice_id | VARCHAR(50) | FK, NOT NULL | è«‹æ±‚æ›¸ID |
| base_id | VARCHAR(50) | FK, NOT NULL | åŸºåœ°ID |
| partner_id | VARCHAR(50) | FK, NOT NULL | ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ID |
| sent_at | TIMESTAMP | NOT NULL | é€ä¿¡æ—¥æ™‚ |
| sent_by | VARCHAR(50) | NOT NULL | é€ä¿¡è€… |
| status | VARCHAR(20) | NOT NULL | é€ä¿¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
| notification_sent | BOOLEAN | DEFAULT FALSE | é€šçŸ¥é€ä¿¡æ¸ˆã¿ |
| remarks | TEXT | - | å‚™è€ƒ |
| created_at | TIMESTAMP | NOT NULL | ä½œæˆæ—¥æ™‚ |

#### 5.5.3 t_messageï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|----------|------|------|
| id | BIGSERIAL | PK | è‡ªå¢ID |
| message_id | VARCHAR(50) | UNIQUE, NOT NULL | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID |
| partner_id | VARCHAR(50) | FK, NOT NULL | ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ID |
| base_id | VARCHAR(50) | FK, NOT NULL | åŸºåœ°ID |
| content | TEXT | NOT NULL | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ |
| direction | VARCHAR(20) | NOT NULL | æ–¹å‘(INBOUND/OUTBOUND) |
| created_by | VARCHAR(50) | NOT NULL | ä½œæˆè€… |
| created_by_name | VARCHAR(100) | NOT NULL | ä½œæˆè€…è¡¨ç¤ºå |
| is_read | BOOLEAN | DEFAULT FALSE | æ—¢èª­ãƒ•ãƒ©ã‚° |
| created_at | TIMESTAMP | NOT NULL | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | - | æ›´æ–°æ—¥æ™‚ |

#### 5.5.4 t_message_attachmentï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|----------|------|------|
| id | BIGSERIAL | PK | è‡ªå¢ID |
| attachment_id | VARCHAR(50) | UNIQUE, NOT NULL | æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ID |
| message_id | VARCHAR(50) | FK, NOT NULL | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID |
| file_name | VARCHAR(255) | NOT NULL | ãƒ•ã‚¡ã‚¤ãƒ«å |
| file_path | VARCHAR(500) | NOT NULL | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ |
| file_size | BIGINT | NOT NULL | ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º |
| file_type | VARCHAR(50) | - | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ— |
| created_at | TIMESTAMP | NOT NULL | ä½œæˆæ—¥æ™‚ |

### 5.6 é—œéµæ¥­å‹™æµç¨‹èˆ‡æ•¸æ“šæµå‘

#### 5.6.1 è«‹æ±‚æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æµç¨‹

```
[ç”»é¢: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ]
        â”‚
        â–¼ POST /api/v1/partners/invoices/upload
[API: PartnerInvoiceController.uploadInvoice]
        â”‚
        â–¼
[Service: PartnerInvoiceService.uploadInvoice]
        â”‚
        â”œâ”€â–º [DB: t_invoice_file] INSERT
        â”‚        â”‚
        â”‚        â””â”€â”€â–º invoice_id, partner_id, base_id, file_name,
        â”‚              file_path, file_size, target_month, status='UPLOADED'
        â”‚
        â””â”€â–º [FileStorage] storeInvoiceFile
        â”‚
        â–¼
[Response: invoiceId, fileName, status='UPLOADED']
        â”‚
        â–¼
[ç”»é¢: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆæ›´æ–°]
```

#### 5.6.2 è«‹æ±‚æ›¸ã‚’é€ä»˜ã™ã‚‹æµç¨‹

```
[ç”»é¢: è«‹æ±‚æ›¸ã‚’é€ä»˜ã™ã‚‹ãƒœã‚¿ãƒ³]
        â”‚
        â–¼ POST /api/v1/partners/invoices/{invoiceId}/send
[API: PartnerInvoiceController.sendInvoice]
        â”‚
        â–¼
[Service: PartnerInvoiceService.sendInvoice]
        â”‚
        â”œâ”€â–º [DB: t_invoice_file] UPDATE
        â”‚        â”‚
        â”‚        â””â”€â”€â–º status='SENT', updated_at=NOW()
        â”‚
        â”œâ”€â–º [DB: t_invoice_send_log] INSERT
        â”‚        â”‚
        â”‚        â””â”€â”€â–º log_id, invoice_id, base_id, sent_at, status='SENT'
        â”‚
        â””â”€â–º [MessageQueue] sendInvoiceNotification
        â”‚
        â–¼
[Response: invoiceId, status='SENT', sentAt]
        â”‚
        â–¼
[ç”»é¢: å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º]
        â”‚
        â–¼
[Baseå´: b8-CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰] è«‹æ±‚æ›¸ä¸€è¦§è¡¨ç¤º
```

#### 5.6.3 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æµç¨‹

```
[ç”»é¢: ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ› + é€ä¿¡ãƒœã‚¿ãƒ³]
        â”‚
        â–¼ POST /api/v1/partners/messages
[API: PartnerMessageController.sendMessage]
        â”‚
        â–¼
[Service: PartnerMessageService.sendMessage]
        â”‚
        â”œâ”€â–º [DB: t_message] INSERT
        â”‚        â”‚
        â”‚        â””â”€â”€â–º message_id, base_id, content,
        â”‚              direction='OUTBOUND', created_by
        â”‚
        â”œâ”€â–º [FileStorage] storeAttachment (If attachments exist)
        â”‚
        â””â”€â–º [DB: t_message_attachment] INSERT (If attachments exist)
        â”‚
        â–¼
[Response: messageId, createdAt]
        â”‚
        â–¼
[ç”»é¢: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆæ›´æ–°]
```

---

### 5.7 APIé”™è¯¯ç ä¸æ•°æ®åº“çŠ¶æ€å¯¹åº”è¡¨

| APIé”™è¯¯ç  | HTTP Status | DBçŠ¶æ€ | è¯´æ˜ |
|-----------|-------------|--------|------|
| INVALID_PARAMETER | 400 | - | å‚æ•°é”™è¯¯ |
| FILE_TOO_LARGE | 400 | - | æ–‡ä»¶è¶…è¿‡10MB |
| INVALID_FILE_TYPE | 400 | - | éPDFæ–‡ä»¶ |
| INVOICE_NOT_FOUND | 404 | - | è«‹æ±‚æ›¸ä¸å­˜åœ¨ |
| BASE_NOT_FOUND | 404 | - | åŸºåœ°ä¸å­˜åœ¨ |
| ACHIEVEMENT_NOT_CONFIRMED | 403 | - | ä¸šç»©æœªç¡®è®¤ |
| PERMISSION_DENIED | 403 | - | æ— æ“ä½œæƒé™ |
| MESSAGE_NOT_FOUND | 404 | - | æ¶ˆæ¯ä¸å­˜åœ¨ |
| ATTACHMENT_NOT_FOUND | 404 | - | é™„ä»¶ä¸å­˜åœ¨ |
| INTERNAL_ERROR | 500 | - | æœåŠ¡å™¨é”™è¯¯ |

---

### 5.8 çŠ¶æ€æµè½¬è¡¨

#### 5.8.1 è«‹æ±‚æ›¸çŠ¶æ€æµè½¬

| å½“å‰çŠ¶æ€ | è§¦å‘åŠ¨ä½œ | ä¸‹ä¸€çŠ¶æ€ | è¯´æ˜ |
|----------|----------|----------|------|
| - | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ | UPLOADED | æ–‡ä»¶ä¸Šä¼ å®Œæˆ |
| UPLOADED | é€ä»˜å®Ÿè¡Œ | SENT | å‘é€è¯·æ±‚ä¹¦ |
| UPLOADED | å‰Šé™¤å®Ÿè¡Œ | DELETED | åˆ é™¤æ–‡ä»¶(è½¯åˆ é™¤) |
| SENT | - | çµ‚äº† | æµç¨‹å®Œæˆ |
| DELETED | - | çµ‚äº† | æµç¨‹ç»“æŸ |

#### 5.8.2 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ–¹å‘

| direction | å‘é€æ–¹ | æ¥æ”¶æ–¹ | è¯´æ˜ |
|-----------|--------|--------|------|
| OUTBOUND | ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ | åŸºåœ° | ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å‘é€çš„æ¶ˆæ¯ |
| INBOUND | åŸºåœ° | ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ | åŸºåœ°å›å¤çš„æ¶ˆæ¯ |

### 5.9 æƒé™ä¸æ•°æ®è®¿é—®æ§åˆ¶

| ç”»é¢åŠŸèƒ½ | API Endpoint | æ•°æ®æƒé™ | è¯´æ˜ |
|----------|--------------|----------|------|
| æ¥­ç¸¾ç¢ºèª | /achievements/confirmed | partner_id = å½“å‰ç”¨æˆ· | åªè®¿é—®è‡ªå·±çš„ä¸šç»© |
| åŸºåœ°åˆ—è¡¨ | /bases | partner_id = å½“å‰ç”¨æˆ· | åªæ˜¾ç¤ºå…³è”åŸºåœ° |
| è«‹æ±‚æ›¸ä¸€è¦§ | /invoices | partner_id = å½“å‰ç”¨æˆ· | åªæ˜¾ç¤ºè‡ªå·±çš„æ–‡ä»¶ |
| è«‹æ±‚æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | /invoices/upload | partner_id = å½“å‰ç”¨æˆ· | ä¸Šä¼ åˆ°è‡ªå·±è´¦æˆ· |
| è«‹æ±‚æ›¸é€ä»˜ | /invoices/{id}/send | partner_id = å½“å‰ç”¨æˆ·ä¸”status=UPLOADED | åªèƒ½å‘é€è‡ªå·±çš„æ–‡ä»¶ |
| è«‹æ±‚æ›¸å‰Šé™¤ | /invoices/{id} | partner_id = å½“å‰ç”¨æˆ·ä¸”status=UPLOADED | åªèƒ½åˆ é™¤è‡ªå·±çš„æ–‡ä»¶ |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ | /messages | partner_id = å½“å‰ç”¨æˆ·ä¸”base_id = æŒ‡å®šåŸºåœ° | åªæ˜¾ç¤ºç›¸å…³æ¶ˆæ¯ |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ | /messages | partner_id = å½“å‰ç”¨æˆ· | å‘é€æ¶ˆæ¯ |

---

### 5.10 ç´¢å¼•ä¼˜åŒ–å»ºè®®

| è¡¨å | ç´¢å¼•åç§° | ç´¢å¼•å­—æ®µ | ç”¨é€” |
|------|----------|----------|------|
| t_invoice_file | idx_invoice_partner_status | partner_id, status | æŒ‰ä¼™ä¼´å’ŒçŠ¶æ€æŸ¥è¯¢ |
| t_invoice_file | idx_invoice_base_month | base_id, target_month | æŒ‰åŸºåœ°å’Œæœˆä»½æŸ¥è¯¢ |
| t_invoice_file | idx_invoice_uploaded_at | uploaded_at | æŒ‰ä¸Šä¼ æ—¶é—´æ’åº |
| t_invoice_send_log | idx_send_log_invoice | invoice_id | æŸ¥æ‰¾å‘é€æ—¥å¿— |
| t_invoice_send_log | idx_send_log_sent_at | sent_at | æŒ‰å‘é€æ—¶é—´æŸ¥è¯¢ |
| t_message | idx_message_partner_base | partner_id, base_id | æŒ‰ä¼™ä¼´å’ŒåŸºåœ°æŸ¥è¯¢ |
| t_message | idx_message_created_at | created_at | æŒ‰æ—¶é—´æ’åº |
| t_message_attachment | idx_attachment_message | message_id | æŸ¥æ‰¾é™„ä»¶ |

| ç”»é¢é …ç›® | APIResponseãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | DBãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‚™è€ƒ |
|----------|----------------------|--------------|------|
| å¯¾è±¡æœˆ | month | m_achievement.month | YYYYå¹´MMæœˆå½¢å¼ |
| è«‹æ±‚å…ˆãƒªã‚¹ãƒˆ | bases[].base_id, bases[].base_name | m_base.base_id, m_base.base_name | ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³é¸æŠè‚¢ |
| ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ« | invoices[].invoice_id, [].file_name, [].base_name | t_invoice_file.invoice_id, file_name, base_id | LEFT JOIN m_base |
| æ›´æ–°æ—¥æ™‚ | invoices[].updated_at | t_invoice_file.updated_at | YYYY/MM/DD HH:mmå½¢å¼ |
| æ›´æ–°è€… | invoices[].updated_by_name | t_invoice_file.updated_by | ãƒ¦ãƒ¼ã‚¶ãƒ¼åè¡¨ç¤º |

### 5.3 APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

#### 5.3.1 æ¥­ç¸¾ç¢ºèªAPI

```typescript
// GET /api/v1/partners/achievements/confirmed
interface GetConfirmedAchievementsResponse {
  success: boolean;
  data: {
    hasConfirmedAchievements: boolean;
    targetMonth?: string;
    achievements?: ConfirmedAchievement[];
  };
}

interface ConfirmedAchievement {
  achievementId: string;
  month: string;
  status: 'CONFIRMED';
  amount: number;
  orderCount: number;
}
```

#### 5.3.2 åŸºåœ°åˆ—è¡¨API

```typescript
// GET /api/v1/partners/bases
interface GetPartnerBasesResponse {
  success: boolean;
  data: {
    bases: BaseInfo[];
  };
}

interface BaseInfo {
  baseId: string;
  baseName: string;
  address: string;
  contactPerson?: string;
  contactEmail?: string;
}
```

#### 5.3.3 è¯·æ±‚ä¹¦ä¸Šä¼ API

```typescript
// POST /api/v1/partners/invoices/upload
interface UploadInvoiceRequest {
  file: File;
  baseId: string;
  targetMonth: string;
}

interface UploadInvoiceResponse {
  success: boolean;
  data: {
    invoiceId: string;
    fileName: string;
    status: 'UPLOADED';
    uploadedAt: string;
  };
}
```

#### 5.3.4 å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨API

```typescript
// GET /api/v1/partners/invoices
interface GetInvoicesResponse {
  success: boolean;
  data: {
    invoices: InvoiceInfo[];
    pagination: {
      currentPage: number;
      pageSize: number;
      totalItems: number;
    };
  };
}

interface InvoiceInfo {
  invoiceId: string;
  companyCode: string;
  fileName: string;
  baseId: string;
  baseName: string;
  action: string;
  updatedAt: string;
  updatedBy: string;
  updatedByName: string;
  status: 'UPLOADED' | 'SENT' | 'DELETED';
}
```

#### 5.3.5 è¯·æ±‚ä¹¦å‘é€API

```typescript
// POST /api/v1/partners/invoices/{invoiceId}/send
interface SendInvoiceResponse {
  success: boolean;
  data: {
    invoiceId: string;
    status: 'SENT';
    sentAt: string;
    message: string;
  };
}
```

#### 5.3.6 æ¶ˆæ¯API

```typescript
// GET /api/v1/partners/messages
interface GetMessagesRequest {
  baseId: string;
  page?: number;
  pageSize?: number;
}

interface GetMessagesResponse {
  success: boolean;
  data: {
    messages: MessageInfo[];
    pagination: PaginationInfo;
  };
}

interface MessageInfo {
  messageId: string;
  baseId: string;
  content: string;
  attachments?: AttachmentInfo[];
  createdAt: string;
  createdBy: string;
  createdByName: string;
  direction: 'OUTBOUND' | 'INBOUND';
}

// POST /api/v1/partners/messages
interface SendMessageRequest {
  baseId: string;
  content: string;
  attachments?: File[];
}

interface SendMessageResponse {
  success: boolean;
  data: {
    messageId: string;
    createdAt: string;
  };
}
```

### 5.4 APIã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰

| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | HTTP Status | èª¬æ˜ |
|--------------|-------------|------|
| INVALID_PARAMETER | 400 | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼ |
| FILE_TOO_LARGE | 400 | ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºè¶…é |
| INVALID_FILE_TYPE | 400 | PDFä»¥å¤–ã®ãƒ•ã‚¡ã‚¤ãƒ« |
| INVOICE_NOT_FOUND | 404 | è«‹æ±‚æ›¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„ |
| BASE_NOT_FOUND | 404 | åŸºåœ°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ |
| ACHIEVEMENT_NOT_CONFIRMED | 403 | å®Ÿç¸¾ãŒæœªç¢ºèª |
| PERMISSION_DENIED | 403 | æ¨©é™ãªã— |
| INTERNAL_ERROR | 500 | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ |

---

## 6. å‰ç«¯å®ç°

### 6.1 ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
// InvoiceUploadPage.tsx
import React, { useState, useEffect, useCallback } from 'react';
import {
  Card,
  Upload,
  Button,
  Select,
  Table,
  Tag,
  DatePicker,
  Space,
  message,
  Modal,
  Drawer,
  List,
  Input,
  Avatar,
  Typography,
  Spin,
} from 'antd';
import {
  InboxOutlined,
  PaperClipOutlined,
  SendOutlined,
  DeleteOutlined,
  EyeOutlined,
  MessageOutlined,
  CloudUploadOutlined,
} from '@ant-design/icons';
import { useNavigate } from 'react-router-dom';
import { invoiceApi, messageApi } from '../../services/api';
import { useAuthStore } from '../../stores/authStore';
import type { Invoice, Message, Base } from '../../types';
import styles from './InvoiceUploadPage.module.css';

const { Dragger } = Upload;
const { TextArea } = Input;
const { Text } = Typography;

export const InvoiceUploadPage: React.FC = () => {
  const navigate = useNavigate();
  const { user } = useAuthStore();
  
  const [loading, setLoading] = useState(false);
  const [hasConfirmedAchievements, setHasConfirmedAchievements] = useState(false);
  const [targetMonth, setTargetMonth] = useState<string>('');
  const [bases, setBases] = useState<Base[]>([]);
  const [selectedBaseId, setSelectedBaseId] = useState<string>('');
  const [invoices, setInvoices] = useState<Invoice[]>([]);
  const [fileList, setFileList] = useState<File[]>([]);
  const [uploading, setUploading] = useState(false);
  const [messageDrawerOpen, setMessageDrawerOpen] = useState(false);
  const [messages, setMessages] = useState<Message[]>([]);
  const [newMessage, setNewMessage] = useState('');
  const [selectedMessageBaseId, setSelectedMessageBaseId] = useState<string>('');

  useEffect(() => {
    fetchInitialData();
  }, []);

  const fetchInitialData = async () => {
    setLoading(true);
    try {
      const [achievementRes, basesRes, invoicesRes] = await Promise.all([
        invoiceApi.getConfirmedAchievements(),
        invoiceApi.getPartnerBases(),
        invoiceApi.getInvoices(),
      ]);

      if (achievementRes.success) {
        setHasConfirmedAchievements(achievementRes.data.hasConfirmedAchievements);
        setTargetMonth(achievementRes.data.targetMonth || '');
      }

      if (basesRes.success) {
        setBases(basesRes.data.bases);
      }

      if (invoicesRes.success) {
        setInvoices(invoicesRes.data.invoices);
      }
    } catch (error) {
      message.error('ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
    } finally {
      setLoading(false);
    }
  };

  const handleUpload = async () => {
    if (!selectedBaseId) {
      message.warning('è«‹æ±‚å…ˆã‚’é¸æŠã—ã¦ãã ã•ã„');
      return;
    }

    if (fileList.length === 0) {
      message.warning('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
      return;
    }

    setUploading(true);
    try {
      for (const file of fileList) {
        const response = await invoiceApi.uploadInvoice(file, selectedBaseId, targetMonth);
        if (response.success) {
          message.success(`${file.name}ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ`);
        } else {
          message.error(`${file.name}ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ`);
        }
      }
      setFileList([]);
      fetchInitialData();
    } catch (error) {
      message.error('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    } finally {
      setUploading(false);
    }
  };

  const handleSendInvoice = async (invoiceId: string) => {
    Modal.confirm({
      title: 'è«‹æ±‚æ›¸ã‚’é€ä»˜',
      content: 'é¸æŠã—ãŸè«‹æ±‚æ›¸ã‚’è«‹æ±‚å…ˆã«é€ä»˜ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ',
      okText: 'é€ä»˜',
      cancelText: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
      onOk: async () => {
        try {
          const response = await invoiceApi.sendInvoice(invoiceId);
          if (response.success) {
            message.success('è«‹æ±‚æ›¸ã‚’é€ä»˜ã—ã¾ã—ãŸ');
            fetchInitialData();
          } else {
            message.error('é€ä»˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
          }
        } catch (error) {
          message.error('é€ä»˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        }
      },
    });
  };

  const handleDelete = async (invoiceId: string) => {
    Modal.confirm({
      title: 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤',
      content: 'ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ',
      okText: 'å‰Šé™¤',
      okButtonProps: { danger: true },
      cancelText: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
      onOk: async () => {
        try {
          const response = await invoiceApi.deleteInvoice(invoiceId);
          if (response.success) {
            message.success('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            fetchInitialData();
          } else {
            message.error('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
          }
        } catch (error) {
          message.error('å‰Šé™¤ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        }
      },
    });
  };

  const handlePreview = (invoice: Invoice) => {
    window.open(invoice.previewUrl, '_blank');
  };

  const openMessageDrawer = () => {
    setMessageDrawerOpen(true);
    if (bases.length > 0 && !selectedMessageBaseId) {
      setSelectedMessageBaseId(bases[0].baseId);
    }
  };

  const fetchMessages = async (baseId: string) => {
    try {
      const response = await messageApi.getMessages(baseId);
      if (response.success) {
        setMessages(response.data.messages);
      }
    } catch (error) {
      message.error('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  };

  const handleSendMessage = async () => {
    if (!newMessage.trim()) return;

    try {
      const response = await messageApi.sendMessage(selectedMessageBaseId, newMessage);
      if (response.success) {
        message.success('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã—ãŸ');
        setNewMessage('');
        fetchMessages(selectedMessageBaseId);
      } else {
        message.error('é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    } catch (error) {
      message.error('é€ä¿¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
  };

  const columns = [
    {
      title: 'ä¼šç¤¾åã‚³ãƒ¼ãƒ‰',
      dataIndex: 'companyCode',
      key: 'companyCode',
      width: 120,
    },
    {
      title: 'ãƒ•ã‚¡ã‚¤ãƒ«å',
      dataIndex: 'fileName',
      key: 'fileName',
      width: 200,
      render: (text: string, record: Invoice) => (
        <Button type="link" onClick={() => handlePreview(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: 'è«‹æ±‚å…ˆ',
      dataIndex: 'baseName',
      key: 'baseName',
      width: 150,
    },
    {
      title: 'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³',
      dataIndex: 'action',
      key: 'action',
      width: 120,
    },
    {
      title: 'æ›´æ–°æ—¥æ™‚',
      dataIndex: 'updatedAt',
      key: 'updatedAt',
      width: 150,
      render: (date: string) => dayjs(date).format('YYYY/MM/DD HH:mm'),
    },
    {
      title: 'æ›´æ–°è€…',
      dataIndex: 'updatedByName',
      key: 'updatedByName',
      width: 120,
    },
    {
      title: 'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³',
      key: 'actions',
      width: 150,
      render: (_: unknown, record: Invoice) => (
        <Space>
          <Button
            type="text"
            icon={<EyeOutlined />}
            onClick={() => handlePreview(record)}
          >
            ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
          </Button>
          <Button
            type="text"
            danger
            icon={<DeleteOutlined />}
            onClick={() => handleDelete(record.invoiceId)}
          >
            å‰Šé™¤
          </Button>
        </Space>
      ),
    },
  ];

  if (!hasConfirmedAchievements) {
    return (
      <div className={styles.container}>
        <Card>
          <div className={styles.noDataMessage}>
            <Text>å¯¾è±¡ã®è«‹æ±‚ãŒã‚ã‚Šã¾ã›ã‚“</Text>
            <Text type="secondary">
              æ¥­ç¸¾ãŒç¢ºå®šæ¬¡ç¬¬ã€è«‹æ±‚æ›¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚
            </Text>
          </div>
        </Card>
      </div>
    );
  }

  return (
    <div className={styles.container}>
      <Card title="è«‹æ±‚æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰" className={styles.uploadCard}>
        <div className={styles.headerSection}>
          <div className={styles.infoRow}>
            <Text strong>å¯¾è±¡æœˆï¼š</Text>
            <Text>{targetMonth}</Text>
          </div>
          <div className={styles.infoRow}>
            <Text strong>è«‹æ±‚å…ˆï¼š</Text>
            <Select
              value={selectedBaseId}
              onChange={setSelectedBaseId}
              placeholder="è«‹æ±‚å…ˆã‚’é¸æŠ"
              style={{ width: 250 }}
              options={bases.map((base) => ({
                value: base.baseId,
                label: base.baseName,
              }))}
            />
          </div>
        </div>

        <Dragger
          fileList={fileList}
          beforeUpload={(file) => {
            const isPDF = file.type === 'application/pdf';
            const isLt10M = file.size / 1024 / 1024 < 10;

            if (!isPDF) {
              message.error('PDFãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™');
              return Upload.LIST_IGNORE;
            }

            if (!isLt10M) {
              message.error('ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯10MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„');
              return Upload.LIST_IGNORE;
            }

            setFileList((prev) => [...prev, file]);
            return false;
          }}
          onRemove={(file) => {
            setFileList((prev) => prev.filter((f) => f.uid !== file.uid));
          }}
          multiple
          accept=".pdf"
        >
          <p className="ant-upload-drag-icon">
            <InboxOutlined />
          </p>
          <p className="ant-upload-text">
            ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
          </p>
          <p className="ant-upload-hint">
            PDFãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ10MBä»¥ä¸‹ï¼‰ã®ã¿ã‚µãƒãƒ¼ãƒˆ
          </p>
        </Dragger>

        {fileList.length > 0 && (
          <div className={styles.uploadActions}>
            <Button
              type="primary"
              icon={<CloudUploadOutlined />}
              onClick={handleUpload}
              loading={uploading}
            >
              ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ ({fileList.length}ä»¶)
            </Button>
            <Button onClick={() => setFileList([])} disabled={uploading}>
              ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </Button>
          </div>
        )}
      </Card>

      <Card
        title="ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿è«‹æ±‚æ›¸"
        className={styles.listCard}
        extra={
          <Button icon={<MessageOutlined />} onClick={openMessageDrawer}>
            ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
          </Button>
        }
      >
        <Table
          columns={columns}
          dataSource={invoices}
          rowKey="invoiceId"
          loading={loading}
          pagination={false}
          scroll={{ x: 1100 }}
        />

        {invoices.length > 0 && (
          <div className={styles.sendSection}>
            <Button
              type="primary"
              size="large"
              icon={<SendOutlined />}
              onClick={() => {
                const uploadedInvoices = invoices.filter(
                  (inv) => inv.status === 'UPLOADED'
                );
                if (uploadedInvoices.length === 0) {
                  message.warning('é€ä»˜å¯èƒ½ãªè«‹æ±‚æ›¸ãŒã‚ã‚Šã¾ã›ã‚“');
                  return;
                }
                Modal.confirm({
                  title: 'è«‹æ±‚æ›¸ã‚’é€ä»˜',
                  content: `${uploadedInvoices.length}ä»¶ã®è«‹æ±‚æ›¸ã‚’é€ä»˜ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`,
                  okText: 'é€ä»˜',
                  cancelText: 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
                  onOk: async () => {
                    for (const inv of uploadedInvoices) {
                      await handleSendInvoice(inv.invoiceId);
                    }
                  },
                });
              }}
            >
              è«‹æ±‚æ›¸ã‚’é€ä»˜ã™ã‚‹
            </Button>
          </div>
        )}
      </Card>

      <Drawer
        title="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
        placement="right"
        width={400}
        open={messageDrawerOpen}
        onClose={() => setMessageDrawerOpen(false)}
        extra={
          <Select
            value={selectedMessageBaseId}
            onChange={(value) => {
              setSelectedMessageBaseId(value);
              fetchMessages(value);
            }}
            style={{ width: 180 }}
            options={bases.map((base) => ({
              value: base.baseId,
              label: base.baseName,
            }))}
          />
        }
      >
        <div className={styles.messageList}>
          {messages.map((msg) => (
            <div
              key={msg.messageId}
              className={
                msg.direction === 'OUTBOUND'
                  ? styles.messageItemOutbound
                  : styles.messageItemInbound
              }
            >
              <Avatar>{msg.createdByName.charAt(0)}</Avatar>
              <div className={styles.messageContent}>
                <Text strong>{msg.createdByName}</Text>
                <Text type="secondary" className={styles.messageTime}>
                  {dayjs(msg.createdAt).format('HH:mm')}
                </Text>
                <div className={styles.messageBubble}>{msg.content}</div>
                {msg.attachments && msg.attachments.length > 0 && (
                  <div className={styles.attachments}>
                    {msg.attachments.map((att) => (
                      <Button
                        key={att.attachmentId}
                        type="link"
                        icon={<PaperClipOutlined />}
                        size="small"
                      >
                        {att.fileName}
                      </Button>
                    ))}
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>

        <div className={styles.messageInput}>
          <TextArea
            value={newMessage}
            onChange={(e) => setNewMessage(e.target.value)}
            placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›"
            autoSize={{ minRows: 2, maxRows: 4 }}
          />
          <div className={styles.messageActions}>
            <Upload accept="*">
              <Button icon={<PaperClipOutlined />} />
            </Upload>
            <Button
              type="primary"
              icon={<SendOutlined />}
              onClick={handleSendMessage}
              disabled={!newMessage.trim()}
            >
              é€ä¿¡
            </Button>
          </div>
        </div>
      </Drawer>
    </div>
  );
};
```

### 6.2 APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

```typescript
// invoiceApi.ts
import axios from 'axios';
import type {
  UploadInvoiceRequest,
  UploadInvoiceResponse,
  GetInvoicesResponse,
  SendInvoiceResponse,
  GetConfirmedAchievementsResponse,
  GetPartnerBasesResponse,
} from '../types/invoice';

const API_BASE_URL = '/api/v1';

const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 60000,
});

apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('auth_token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

export const invoiceApi = {
  getConfirmedAchievements: async (): Promise<GetConfirmedAchievementsResponse> => {
    return apiClient.get('/partners/achievements/confirmed');
  },

  getPartnerBases: async (): Promise<GetPartnerBasesResponse> => {
    return apiClient.get('/partners/bases');
  },

  uploadInvoice: async (
    file: File,
    baseId: string,
    targetMonth: string
  ): Promise<UploadInvoiceResponse> => {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('baseId', baseId);
    formData.append('targetMonth', targetMonth);
    return apiClient.post('/partners/invoices/upload', formData);
  },

  getInvoices: async (): Promise<GetInvoicesResponse> => {
    return apiClient.get('/partners/invoices');
  },

  getInvoiceDetail: async (invoiceId: string) => {
    return apiClient.get(`/partners/invoices/${invoiceId}`);
  },

  getInvoicePreview: async (invoiceId: string): Promise<{ data: { previewUrl: string } }> => {
    return apiClient.get(`/partners/invoices/${invoiceId}/preview`);
  },

  deleteInvoice: async (invoiceId: string) => {
    return apiClient.delete(`/partners/invoices/${invoiceId}`);
  },

  sendInvoice: async (invoiceId: string): Promise<SendInvoiceResponse> => {
    return apiClient.post(`/partners/invoices/${invoiceId}/send`);
  },

  downloadInvoice: async (invoiceId: string): Promise<Blob> => {
    return apiClient.get(`/partners/invoices/${invoiceId}/download`, {
      responseType: 'blob',
    });
  },
};

export const messageApi = {
  getMessages: async (
    baseId: string,
    page = 1,
    pageSize = 50
  ): Promise<GetMessagesResponse> => {
    return apiClient.get('/partners/messages', {
      params: { baseId, page, pageSize },
    });
  },

  sendMessage: async (
    baseId: string,
    content: string,
    attachments?: File[]
  ): Promise<SendMessageResponse> => {
    const formData = new FormData();
    formData.append('baseId', baseId);
    formData.append('content', content);
    if (attachments) {
      attachments.forEach((file) => {
        formData.append('attachments', file);
      });
    }
    return apiClient.post('/partners/messages', formData);
  },

  downloadAttachment: async (attachmentId: string): Promise<Blob> => {
    return apiClient.get(`/partners/messages/attachments/${attachmentId}`, {
      responseType: 'blob',
    });
  },
};
```

---

## 7. åç«¯æœåŠ¡è®¾è®¡

### 7.1 Controller

```java
@RestController
@RequestMapping("/api/v1/partners")
@RequiredArgsConstructor
@Validated
public class PartnerInvoiceController {

    private final PartnerInvoiceService invoiceService;
    private final PartnerMessageService messageService;

    @GetMapping("/achievements/confirmed")
    @ResponseStatus(HttpStatus.OK)
    public ResponseEntity<GetConfirmedAchievementsResponse> getConfirmedAchievements(
            @AuthenticationPrincipal User user) {
        GetConfirmedAchievementsResponse response = invoiceService.getConfirmedAchievements(user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @GetMapping("/bases")
    @ResponseStatus(HttpStatus.OK)
    public ResponseEntity<GetPartnerBasesResponse> getPartnerBases(
            @AuthenticationPrincipal User user) {
        GetPartnerBasesResponse response = invoiceService.getPartnerBases(user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @PostMapping(value = "/invoices/upload", consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
    @ResponseStatus(HttpStatus.OK)
    public ResponseEntity<UploadInvoiceResponse> uploadInvoice(
            @RequestParam("file") MultipartFile file,
            @RequestParam("baseId") String baseId,
            @RequestParam("targetMonth") String targetMonth,
            @AuthenticationPrincipal User user) {
        UploadInvoiceRequest request = UploadInvoiceRequest.builder()
                .file(file)
                .baseId(baseId)
                .targetMonth(targetMonth)
                .build();
        UploadInvoiceResponse response = invoiceService.uploadInvoice(request, user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @GetMapping("/invoices")
    @ResponseStatus(HttpStatus.OK)
    public ResponseEntity<GetInvoicesResponse> getInvoices(
            @Valid @ModelAttribute GetInvoicesRequest request,
            @AuthenticationPrincipal User user) {
        GetInvoicesResponse response = invoiceService.getInvoices(request, user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @GetMapping("/invoices/{invoiceId}/preview")
    @ResponseStatus(HttpStatus.OK)
    public ResponseEntity<GetInvoicePreviewResponse> getInvoicePreview(
            @PathVariable String invoiceId,
            @AuthenticationPrincipal User user) {
        GetInvoicePreviewResponse response = invoiceService.getInvoicePreview(invoiceId, user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @DeleteMapping("/invoices/{invoiceId}")
    @ResponseStatus(HttpStatus.OK)
    public ResponseEntity<DeleteInvoiceResponse> deleteInvoice(
            @PathVariable String invoiceId,
            @AuthenticationPrincipal User user) {
        DeleteInvoiceResponse response = invoiceService.deleteInvoice(invoiceId, user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @PostMapping("/invoices/{invoiceId}/send")
    @ResponseStatus(HttpStatus.OK)
    public ResponseEntity<SendInvoiceResponse> sendInvoice(
            @PathVariable String invoiceId,
            @AuthenticationPrincipal User user) {
        SendInvoiceResponse response = invoiceService.sendInvoice(invoiceId, user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @GetMapping("/invoices/{invoiceId}/download")
    public ResponseEntity<Resource> downloadInvoice(
            @PathVariable String invoiceId,
            @AuthenticationPrincipal User user) {
        Resource resource = invoiceService.downloadInvoice(invoiceId, user.getPartnerId());
        return ResponseEntity.ok()
                .contentType(MediaType.APPLICATION_PDF)
                .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=\"invoice.pdf\"")
                .body(resource);
    }
}

@RestController
@RequestMapping("/api/v1/partners/messages")
@RequiredArgsConstructor
@Validated
public class PartnerMessageController {

    private final PartnerMessageService messageService;

    @GetMapping
    @ResponseStatus(HttpStatus.OK)
    public ResponseEntity<GetMessagesResponse> getMessages(
            @Valid @ModelAttribute GetMessagesRequest request,
            @AuthenticationPrincipal User user) {
        GetMessagesResponse response = messageService.getMessages(request, user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @PostMapping(consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
    @ResponseStatus(HttpStatus.OK)
    public ResponseEntity<SendMessageResponse> sendMessage(
            @RequestParam("baseId") String baseId,
            @RequestParam("content") String content,
            @RequestParam(value = "attachments", required = false) List<MultipartFile> attachments,
            @AuthenticationPrincipal User user) {
        SendMessageRequest request = SendMessageRequest.builder()
                .baseId(baseId)
                .content(content)
                .attachments(attachments)
                .build();
        SendMessageResponse response = messageService.sendMessage(request, user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @GetMapping("/attachments/{attachmentId}/download")
    public ResponseEntity<Resource> downloadAttachment(
            @PathVariable String attachmentId,
            @AuthenticationPrincipal User user) {
        Resource resource = messageService.downloadAttachment(attachmentId, user.getPartnerId());
        return ResponseEntity.ok()
                .header(HttpHeaders.CONTENT_DISPOSITION, "attachment")
                .body(resource);
    }
}
```

### 7.2 Service

```java
@Service
@RequiredArgsConstructor
@Slf4j
public class PartnerInvoiceService {

    private final InvoiceRepository invoiceRepository;
    private final PartnerBaseRepository partnerBaseRepository;
    private final AchievementRepository achievementRepository;
    private final FileStorageService fileStorageService;
    private final MessageQueueService messageQueueService;

    @Transactional(readOnly = true)
    public GetConfirmedAchievementsResponse getConfirmedAchievements(String partnerId) {
        List<Achievement> confirmedAchievements = achievementRepository
                .findByPartnerIdAndStatus(partnerId, AchievementStatus.CONFIRMED);

        if (confirmedAchievements.isEmpty()) {
            return GetConfirmedAchievementsResponse.builder()
                    .success(true)
                    .data(GetConfirmedAchievementsData.builder()
                            .hasConfirmedAchievements(false)
                            .build())
                    .build();
        }

        Achievement latestAchievement = confirmedAchievements.get(0);
        return GetConfirmedAchievementsResponse.builder()
                .success(true)
                .data(GetConfirmedAchievementsData.builder()
                        .hasConfirmedAchievements(true)
                        .targetMonth(formatMonth(latestAchievement.getMonth()))
                        .achievements(confirmedAchievements.stream()
                                .map(a -> ConfirmedAchievementDTO.builder()
                                        .achievementId(a.getId())
                                        .month(formatMonth(a.getMonth()))
                                        .status(a.getStatus().name())
                                        .amount(a.getTotalAmount())
                                        .orderCount(a.getOrderCount())
                                        .build())
                                .collect(Collectors.toList()))
                        .build())
                .build();
    }

    @Transactional(readOnly = true)
    public GetPartnerBasesResponse getPartnerBases(String partnerId) {
        List<PartnerBase> partnerBases = partnerBaseRepository.findByPartnerId(partnerId);

        List<BaseInfo> bases = partnerBases.stream()
                .map(pb -> BaseInfo.builder()
                        .baseId(pb.getBase().getBaseId())
                        .baseName(pb.getBase().getBaseName())
                        .address(pb.getBase().getAddress())
                        .contactPerson(pb.getBase().getContactPerson())
                        .contactEmail(pb.getBase().getContactEmail())
                        .build())
                .collect(Collectors.toList());

        return GetPartnerBasesResponse.builder()
                .success(true)
                .data(GetPartnerBasesData.builder()
                        .bases(bases)
                        .build())
                .build();
    }

    @Async
    @Transactional
    public UploadInvoiceResponse uploadInvoice(UploadInvoiceRequest request, String partnerId) {
        String invoiceId = generateInvoiceId();
        
        String filePath = fileStorageService.storeInvoiceFile(
                request.getFile(), partnerId, invoiceId);
        
        Invoice invoice = Invoice.builder()
                .invoiceId(invoiceId)
                .partnerId(partnerId)
                .baseId(request.getBaseId())
                .fileName(request.getFile().getOriginalFilename())
                .filePath(filePath)
                .fileSize(request.getFile().getSize())
                .targetMonth(request.getTargetMonth())
                .status(InvoiceStatus.UPLOADED)
                .uploadedBy(partnerId)
                .uploadedAt(LocalDateTime.now())
                .updatedBy(partnerId)
                .updatedAt(LocalDateTime.now())
                .build();
        
        invoiceRepository.save(invoice);
        
        return UploadInvoiceResponse.builder()
                .success(true)
                .data(UploadInvoiceResponseData.builder()
                        .invoiceId(invoiceId)
                        .fileName(request.getFile().getOriginalFilename())
                        .status(InvoiceStatus.UPLOADED.name())
                        .uploadedAt(invoice.getUploadedAt().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME))
                        .build())
                .build();
    }

    @Transactional(readOnly = true)
    public GetInvoicesResponse getInvoices(GetInvoicesRequest request, String partnerId) {
        Specification<Invoice> spec = Specification.where(null)
                .and((root, query, cb) -> cb.equal(root.get("partnerId"), partnerId));

        Pageable pageable = PageRequest.of(
                request.getPage() != null ? request.getPage() - 1 : 0,
                request.getPageSize() != null ? request.getPageSize() : 20);

        Page<Invoice> page = invoiceRepository.findAll(spec, pageable);

        return GetInvoicesResponse.builder()
                .success(true)
                .data(GetInvoicesResponseData.builder()
                        .invoices(page.getContent().stream()
                                .map(inv -> InvoiceDTO.builder()
                                        .invoiceId(inv.getInvoiceId())
                                        .companyCode(inv.getCompanyCode())
                                        .fileName(inv.getFileName())
                                        .baseId(inv.getBaseId())
                                        .baseName(inv.getBaseName())
                                        .action(inv.getLastAction())
                                        .updatedAt(inv.getUpdatedAt().format(DateTimeFormatter.ofPattern("yyyy/MM/dd HH:mm")))
                                        .updatedBy(inv.getUpdatedBy())
                                        .updatedByName(inv.getUpdatedByName())
                                        .status(inv.getStatus().name())
                                        .build())
                                .collect(Collectors.toList()))
                        .pagination(PaginationInfo.builder()
                                .currentPage(page.getNumber() + 1)
                                .pageSize(page.getSize())
                                .totalItems(page.getTotalElements())
                                .totalPages(page.getTotalPages())
                                .build())
                        .build())
                .build();
    }

    @Transactional
    public SendInvoiceResponse sendInvoice(String invoiceId, String partnerId) {
        Invoice invoice = invoiceRepository.findByInvoiceIdAndPartnerId(invoiceId, partnerId)
                .orElseThrow(() -> new InvoiceNotFoundException(invoiceId));

        InvoiceSendLog sendLog = InvoiceSendLog.builder()
                .invoiceId(invoiceId)
                .baseId(invoice.getBaseId())
                .partnerId(partnerId)
                .sentAt(LocalDateTime.now())
                .sentBy(partnerId)
                .status(InvoiceSendStatus.SENT)
                .build();
        
        invoice.updateStatus(InvoiceStatus.SENT);
        invoiceRepository.save(invoice);
        
        messageQueueService.sendInvoiceNotification(invoice);
        
        return SendInvoiceResponse.builder()
                .success(true)
                .data(SendInvoiceResponseData.builder()
                        .invoiceId(invoiceId)
                        .status(InvoiceStatus.SENT.name())
                        .sentAt(LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME))
                        .message("è«‹æ±‚æ›¸ã‚’é€ä»˜ã—ã¾ã—ãŸ")
                        .build())
                .build();
    }

    @Transactional
    public DeleteInvoiceResponse deleteInvoice(String invoiceId, String partnerId) {
        Invoice invoice = invoiceRepository.findByInvoiceIdAndPartnerId(invoiceId, partnerId)
                .orElseThrow(() -> new InvoiceNotFoundException(invoiceId));

        if (invoice.getStatus() == InvoiceStatus.SENT) {
            throw new BusinessException("é€ä¿¡æ¸ˆã¿è«‹æ±‚æ›¸ã¯å‰Šé™¤ã§ãã¾ã›ã‚“");
        }

        fileStorageService.deleteInvoiceFile(invoice.getFilePath());
        invoiceRepository.delete(invoice);

        return DeleteInvoiceResponse.builder()
                .success(true)
                .message("ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¾ã—ãŸ")
                .build();
    }

    private String generateInvoiceId() {
        return "INV-" + System.currentTimeMillis();
    }

    private String formatMonth(String month) {
        return month.substring(0, 4) + "å¹´" + month.substring(4, 6) + "æœˆ";
    }
}
```

---

## 8. æ•°æ®åº“è¡¨è®¾è®¡

### 8.1 t_invoice_fileãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE t_invoice_file (
    id BIGSERIAL PRIMARY KEY,
    invoice_id VARCHAR(50) NOT NULL UNIQUE,
    partner_id VARCHAR(50) NOT NULL,
    base_id VARCHAR(50) NOT NULL,
    company_code VARCHAR(20) NOT NULL COMMENT 'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ä¼šç¤¾åã‚³ãƒ¼ãƒ‰',
    file_name VARCHAR(255) NOT NULL COMMENT 'è«‹æ±‚æ›¸ã®ãƒ•ã‚¡ã‚¤ãƒ«å',
    file_path VARCHAR(500) NOT NULL COMMENT 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‘ã‚¹',
    file_size BIGINT NOT NULL COMMENT 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º(bytes)',
    target_month VARCHAR(7) NOT NULL COMMENT 'å¯¾è±¡æœˆ YYYY-MM',
    status VARCHAR(20) NOT NULL DEFAULT 'UPLOADED' COMMENT 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: UPLOADED/SENT/DELETED',
    last_action VARCHAR(100) COMMENT 'æœ€å¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³',
    uploaded_by VARCHAR(50) NOT NULL,
    uploaded_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_by VARCHAR(50),
    updated_at TIMESTAMP,
    deleted_at TIMESTAMP,
    
    INDEX idx_invoice_partner_id (partner_id),
    INDEX idx_invoice_base_id (base_id),
    INDEX idx_invoice_status (status),
    INDEX idx_invoice_target_month (target_month),
    INDEX idx_invoice_uploaded_at (uploaded_at),
    
    FOREIGN KEY (partner_id) REFERENCES m_partner(partner_id),
    FOREIGN KEY (base_id) REFERENCES m_base(base_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è«‹æ±‚æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«';
```

### 8.2 t_invoice_send_logãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE t_invoice_send_log (
    id BIGSERIAL PRIMARY KEY,
    log_id VARCHAR(50) NOT NULL UNIQUE,
    invoice_id VARCHAR(50) NOT NULL,
    base_id VARCHAR(50) NOT NULL,
    partner_id VARCHAR(50) NOT NULL,
    sent_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    sent_by VARCHAR(50) NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'SENT' COMMENT 'é€ä¿¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹',
    notification_sent BOOLEAN DEFAULT FALSE COMMENT 'é€šçŸ¥é€ä¿¡æ¸ˆã¿ãƒ•ãƒ©ã‚°',
    remarks TEXT COMMENT 'å‚™è€ƒ',
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_send_log_invoice_id (invoice_id),
    INDEX idx_send_log_base_id (base_id),
    INDEX idx_send_log_sent_at (sent_at),
    
    FOREIGN KEY (invoice_id) REFERENCES t_invoice_file(invoice_id),
    FOREIGN KEY (base_id) REFERENCES m_base(base_id),
    FOREIGN KEY (partner_id) REFERENCES m_partner(partner_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è«‹æ±‚æ›¸é€ä¿¡ãƒ­ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«';
```

### 8.3 t_messageãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE t_message (
    id BIGSERIAL PRIMARY KEY,
    message_id VARCHAR(50) NOT NULL UNIQUE,
    partner_id VARCHAR(50) NOT NULL,
    base_id VARCHAR(50) NOT NULL,
    content TEXT NOT NULL COMMENT 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹',
    direction VARCHAR(20) NOT NULL COMMENT 'OUTBOUND/INBOUND',
    created_by VARCHAR(50) NOT NULL,
    created_by_name VARCHAR(100) NOT NULL COMMENT 'ä½œæˆè€…è¡¨ç¤ºå',
    is_read BOOLEAN DEFAULT FALSE COMMENT 'æ—¢èª­ãƒ•ãƒ©ã‚°',
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP,
    
    INDEX idx_message_partner_id (partner_id),
    INDEX idx_message_base_id (base_id),
    INDEX idx_message_direction (direction),
    INDEX idx_message_created_at (created_at),
    
    FOREIGN KEY (partner_id) REFERENCES m_partner(partner_id),
    FOREIGN KEY (base_id) REFERENCES m_base(base_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«';
```

### 8.4 t_message_attachmentãƒ†ãƒ¼ãƒ–ãƒ«

```sql
CREATE TABLE t_message_attachment (
    id BIGSERIAL PRIMARY KEY,
    attachment_id VARCHAR(50) NOT NULL UNIQUE,
    message_id VARCHAR(50) NOT NULL,
    file_name VARCHAR(255) NOT NULL COMMENT 'æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«å',
    file_path VARCHAR(500) NOT NULL COMMENT 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‘ã‚¹',
    file_size BIGINT NOT NULL COMMENT 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º',
    file_type VARCHAR(50) COMMENT 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—',
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_attachment_message_id (message_id),
    
    FOREIGN KEY (message_id) REFERENCES t_message(message_id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ«';
```

---

## 9. éªŒæ”¶æ ‡å‡†

### 9.1 åŠŸèƒ½éªŒæ”¶

| æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|----------|----------|--------|
| é¡µé¢åˆå§‹åŠ è½½ï¼ˆä¸šç»©å·²ç¡®è®¤ï¼‰ | æ˜¾ç¤ºè¯·æ±‚ä¹¦ä¸Šä¼ ç•Œé¢ | P0 |
| é¡µé¢åˆå§‹åŠ è½½ï¼ˆä¸šç»©æœªç¡®è®¤ï¼‰ | æ˜¾ç¤ºã€Œå¯¾è±¡ã®è«‹æ±‚ãŒã‚ã‚Šã¾ã›ã‚“ã€ | P0 |
| åŸºåœ°é€‰æ‹©ä¸‹æ‹‰æ¡† | æ˜¾ç¤ºå…³è”çš„åŸºåœ°åˆ—è¡¨ | P0 |
| PDFæ–‡ä»¶ä¸Šä¼  | æ–‡ä»¶ä¸Šä¼ æˆåŠŸå¹¶æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­ | P0 |
| å¤šæ–‡ä»¶ä¸Šä¼  | æ”¯æŒåŒæ—¶ä¸Šä¼ å¤šä¸ªPDFæ–‡ä»¶ | P0 |
| é¢„è§ˆåŠŸèƒ½ | ç‚¹å‡»æ–‡ä»¶åå¯é¢„è§ˆPDF | P1 |
| åˆ é™¤åŠŸèƒ½ | å¯åˆ é™¤æœªå‘é€çš„è¯·æ±‚ä¹¦ | P1 |
| å‘é€è¯·æ±‚ä¹¦ | è¯·æ±‚ä¹¦å‘é€ç»™æŒ‡å®šåŸºåœ° | P0 |
| æ¶ˆæ¯é¢æ¿æ‰“å¼€ | æ˜¾ç¤ºæ¶ˆæ¯äº¤æµé¢æ¿ | P1 |
| æ¶ˆæ¯å‘é€ | æ¶ˆæ¯å‘é€æˆåŠŸå¹¶æ˜¾ç¤º | P1 |
| æ¶ˆæ¯é™„ä»¶ä¸Šä¼  | å¯åœ¨æ¶ˆæ¯ä¸­é™„åŠ æ–‡ä»¶ | P1 |

### 9.2 æ€§èƒ½éªŒæ”¶

| æŒ‡æ ‡ | è¦æ±‚ | æµ‹è¯•æ–¹æ³• |
|------|------|----------|
| é¡µé¢åŠ è½½ | <2ç§’ | Lighthouse |
| æ–‡ä»¶ä¸Šä¼  | <30ç§’(10MB) | ç”¨æˆ·ä½“éªŒæµ‹è¯• |
| è¡¨æ ¼æ¸²æŸ“ | <500ms | æµè§ˆå™¨DevTools |
| é¢„è§ˆåŠ è½½ | <3ç§’ | æ€§èƒ½æµ‹è¯• |

### 9.3 å®‰å…¨éªŒæ”¶

| æ£€æŸ¥é¡¹ | è¦æ±‚ |
|--------|------|
| è®¤è¯æ£€æŸ¥ | å¿…é¡»ç™»å½•æ‰èƒ½è®¿é—® |
| æƒé™æ§åˆ¶ | åªèƒ½æŸ¥çœ‹/æ“ä½œè‡ªå·±çš„è¯·æ±‚ä¹¦ |
| æ–‡ä»¶ç±»å‹ | PDFç™½åå•éªŒè¯ |
| æ–‡ä»¶å¤§å° | é™åˆ¶10MB |
| æ–‡ä»¶åæ¶ˆæ¯’ | é˜²æ­¢è·¯å¾„éå†æ”»å‡» |
| SQLæ³¨å…¥ | ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ |
| XSSé˜²æŠ¤ | è¾“å…¥å†…å®¹è½¬ä¹‰ |

---

## 10. å˜æ›´æ—¥å¿—

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|---------|------|
| 2026-02-XX | v1.0 | åˆå§‹ç‰ˆæœ¬ | - |
| 2026-02-10 | v1.0.1 | æ ¹æ®Excelæºæ•°æ®æ›´æ–°æ–‡æ¡£ï¼Œä»ã€Œæƒ…å ±ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€æ”¹ä¸ºã€Œè«‹æ±‚æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ | - |

---

## é™„å½•

### A.1 ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ | [\_å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ.md](../_å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ.md) | å‰åç«¯æŠ€æœ¯æ¶æ„è¯¦ç»†è§„èŒƒ |
| b8-CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | [../b8-CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰/05_è®¾è®¡è§„èŒƒ.md](../b8-CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰/05_è®¾è®¡è§„èŒƒ.md) | Baseä¾§CSVä¸Šä¼ è®¾è®¡è§„èŒƒ |
| p5-è«‹æ±‚æ¤œç´¢ | [../p5-è«‹æ±‚æ¤œç´¢/05_è®¾è®¡è§„èŒƒ.md](../p5-è«‹æ±‚æ¤œç´¢/05_è®¾è®¡è§„èŒƒ.md) | åˆä½œä¼™ä¼´è´¦å•æœç´¢è®¾è®¡è§„èŒƒ |

### A.2 APIè°ƒç”¨ç¤ºä¾‹

```bash
# è«‹æ±‚æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
curl -X POST "https://api.example.com/api/v1/partners/invoices/upload" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -F "file=@seikyu_202506.pdf" \
  -F "baseId=BASE001" \
  -F "targetMonth=2025-06"
```

```bash
# è«‹æ±‚æ›¸ã‚’é€ä»˜ã™ã‚‹
curl -X POST "https://api.example.com/api/v1/partners/invoices/INV-1234567890/send" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

```bash
# ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
curl -X POST "https://api.example.com/api/v1/partners/messages" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -F "baseId=BASE001" \
  -F "content=è«‹æ±‚æ›¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ"
```

---

**æ–‡æ¡£ç¼–åˆ¶**: -  
**ç¼–åˆ¶æ—¶é—´**: 2026-02-10  
**é€‚ç”¨èŒƒå›´**: p6-è«‹æ±‚æ›¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ åˆä½œä¼™ä¼´è¯·æ±‚ä¹¦ä¸Šè½½é¡µé¢  
**äº¤å‰å¼•ç”¨**: [\_å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ.md](../_å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ.md)
