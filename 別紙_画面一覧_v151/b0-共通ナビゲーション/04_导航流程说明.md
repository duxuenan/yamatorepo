# b0-共通ナビゲーション - 导航流程说明

## 1. 页面导航概述

### 1.1 页面定位
b0-共通ナビゲーション 是系统的**通用导航菜单组件**，为所有功能界面提供统一的导航入口。

### 1.2 导航类型
| 导航类型 | 说明 |
|----------|------|
| **常驻组件** | 固定显示在页面左侧 |
| **全局导航** | 所有功能页面共享 |
| **权限导航** | 根据用户权限动态显示 |

## 2. 入口分析

### 2.1 组件加载入口
| 入口方式 | 触发条件 | 目标组件 |
|----------|----------|----------|
| 页面加载 | 访问任意功能页面 | b0-共通ナビゲーション |
| 路由切换 | 页面URL变更 | 保持常驻 |
| 会话恢复 | 页面刷新 | 重新初始化 |

### 2.2 初始显示条件
| 条件 | 结果 |
|------|------|
| 用户已登录 | 显示导航菜单 |
| 用户未登录 | 不显示 |
| 权限验证通过 | 显示权限内菜单项 |

## 3. 出口分析

### 3.1 菜单项跳转出口
| 菜单项 | 目标页面 | 触发条件 | 出口类型 |
|--------|----------|----------|----------|
| 発注管理 | b2-発注検索 | 点击菜单项 | 内部跳转 |
| 実績管理 | b4-実績検索 | 点击菜单项 | 内部跳转 |
| 被請求管理 | b6-被請求管理 | 点击菜单项 | 内部跳转 |
| CSVアップロード | b8-CSVアップロード | 点击菜单项 | 内部跳转 |
| アクション履歴 | b9-アクション履歴 | 点击菜单项 | 内部跳转 |
| マスタ管理 | b10-マスタ管理 | 点击菜单项 | 内部跳转 |
| ログアウト | b1-スタート | 点击菜单项 | 内部跳转 |

### 3.2 出口决策流程
```
[用户点击菜单项]
        │
        ▼
[检查菜单权限]
    ┌───┴───┐
    │       │
  有权限   无权限
    │       │
    ▼       ▼
[执行跳转] [隐藏菜单项]
```

## 4. 导航流程图

### 4.1 主导航流程
```
┌─────────────────────────────────────┐
│         用户访问功能页面              │
└─────────────────┬───────────────────┘
                  ▼
┌─────────────────────────────────────┐
│         b0-共通ナビゲーション         │
│       （左侧常驻导航菜单）            │
└─────────────────┬───────────────────┘
                  │
         ┌────────┼────────┬────────┬────────┬────────┬────────┐
         │        │        │        │        │        │        │
         ▼        ▼        ▼        ▼        ▼        ▼        ▼
┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐
│b2-  │ │b4-  │ │b6-  │ │b8-  │ │b9-  │ │b10- │ │b1-  │
│発注 │ │実績 │ │被請 │ │CSV  │ │アク │ │マス │ │スター│
│検索 │ │検索 │ │求管理│ │アップ│ │ショ │ │タ管理│ │ト   │
└─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘
```

### 4.2 登出流程
```
[点击「ログアウト」菜单项]
        │
        ▼
[显示确认对话框（可选）]
        │
        ▼
[用户确认]
        │
        ▼
[清除会话信息]
        │
        ▼
[跳转至 b1-スタート 页面]
        │
        ▼
[显示登录入口]
```

### 4.3 权限过滤流程
```
[菜单数据加载]
        │
        ▼
[获取用户权限信息]
        │
        ▼
[遍历菜单项进行权限判断]
    ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┐
    │     │     │     │     │     │     │     │
    ▼     ▼     ▼     ▼     ▼     ▼     ▼     ▼
[⑴]  [⑵]  [⑶]  [⑷]  [⑸]  [⑹]  [⑺]
    │     │     │     │     │     │     │
    ▼     ▼     ▼     ▼     ▼     ▼     ▼
[権限] [権限] [権限] [権限] [権限] [権限] [権限]
    │     │     │     │     │     │     │
    └─────┴─────┴─────┴─────┴─────┴─────┘
                    │
                    ▼
        ┌───────────┴───────────┐
        │                       │
      显示                   隐藏/禁用
```

## 5. 导航状态管理

### 5.1 页面状态
| 状态 | 条件 | 导航行为 |
|------|------|----------|
| **当前页面** | URL与菜单项匹配 | 高亮显示 |
| **父菜单展开** | 存在子菜单 | 显示子菜单 |
| **权限变更** | 角色切换 | 重新渲染菜单 |
| **折叠状态** | 用户操作 | 收起/展开侧边栏 |

### 5.2 状态转换
```
┌─────────────────────────────────────────────────┐
│                    b0-共通ナビゲーション          │
└─────────────────────────────────────────────────┘
                          │
         ┌────────────────┼────────────────┐
         │                │                │
         ▼                ▼                ▼
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│  展开状态    │  │  收起状态    │  │  加载状态    │
│ 用户可见     │  │ 仅图标显示  │  │ 数据获取中  │
└─────────────┘  └─────────────┘  └─────────────┘
         │                │                │
         └────────────────┴────────────────┘
                          │
                          ▼
              ┌─────────────────────────┐
              │     根据URL高亮当前项    │
              └─────────────────────────┘
```

### 5.3 高亮逻辑
| 条件 | 高亮菜单项 |
|------|------------|
| URL = /order/search | 発注管理 |
| URL = /completed-orders/search | 実績管理 |
| URL = /billing/manage | 被請求管理 |
| URL = /data/upload | CSVアップロード |
| URL = /audit/history | アクション履歴 |
| URL = /system/master | マスタ管理 |

## 6. 与其他页面的关系

### 6.1 导航树
```
                            [登录成功后]
                                   │
                                   ▼
                    ┌──────────────────────────┐
                    │   b0-共通ナビゲーション    │
                    │      （常驻左侧菜单）       │
                    └────────────┬───────────────┘
                                 │
        ┌────────────────────────┼────────────────────────┐
        │                        │                        │
        ▼                        ▼                        ▼
┌───────────────┐      ┌───────────────┐      ┌───────────────┐
│ b2-発注検索   │      │ b4-実績検索   │      │ b6-被請求管理  │
└───────────────┘      └───────────────┘      └───────────────┘
        │                        │                        │
        └────────────────────────┼────────────────────────┘
                                 │
                                 ▼
                    ┌──────────────────────────┐
                    │      更多功能页面...      │
                    │ b8/b9/b10-XXX           │
                    └────────────┬───────────────┘
                                 │
                                 ▼
                    ┌──────────────────────────┐
                    │     ログアウト →        │
                    │     b1-スタート         │
                    └──────────────────────────┘
```

### 6.2 关联页面
| 页面 | 关系类型 | 说明 |
|------|----------|------|
| b1-スタート | 入口页面 | 登录后显示导航 |
| b2-発注検索 | 目标页面 | 导航入口之一 |
| b4-実績検索 | 目标页面 | 导航入口之一 |
| b6-被請求管理 | 目标页面 | 导航入口之一 |
| b8-CSVアップロード | 目标页面 | 导航入口之一 |
| b9-アクション履歴 | 目标页面 | 导航入口之一 |
| b10-マスタ管理 | 目标页面 | 导航入口之一 |

## 7. 导航参数

### 7.1 菜单配置参数
| 参数 | 类型 | 说明 |
|------|------|------|
| menu_id | string | 菜单项唯一标识 |
| menu_name | string | 菜单显示名称 |
| path | string | 跳转目标路径 |
| icon | string | 菜单图标 |
| sort_order | integer | 排序顺序 |
| permission_level | integer | 权限级别 |

### 7.2 状态参数
| 参数 | 类型 | 说明 |
|------|------|------|
| is_expanded | boolean | 菜单展开状态 |
| is_active | boolean | 当前页面高亮 |
| is_visible | boolean | 权限可见性 |

## 8. 导航性能优化

### 8.1 优化策略
| 优化项 | 优化方式 | 预期效果 |
|--------|----------|----------|
| 懒加载 | 按权限动态加载菜单 | 减少初始加载时间 |
| 缓存 | 菜单数据缓存 | 页面刷新快速渲染 |
| 预加载 | 预加载目标页面资源 | 加快跳转速度 |

### 8.2 性能指标
| 场景 | 目标时间 | 说明 |
|------|----------|------|
| 菜单渲染 | < 100ms | 初始加载 |
| 权限过滤 | < 50ms | 实时计算 |
| 点击响应 | < 100ms | 跳转准备 |
| 页面过渡 | < 300ms | 视觉平滑 |

## 9. 特殊导航场景

### 9.1 会话超时
| 场景 | 处理方式 |
|------|----------|
| 检测到会话过期 | 清除菜单状态 |
| 重定向 | 跳转至 b1-スタート |
| 恢复 | 重新登录后显示菜单 |

### 9.2 权限变更
| 场景 | 处理方式 |
|------|----------|
| 角色切换 | 重新获取菜单数据 |
| 菜单刷新 | 动态更新显示项 |

### 9.3 多标签页
| 场景 | 处理方式 |
|------|----------|
| 新开标签页 | 独立会话，独立菜单 |
| 跨标签通信 | 使用 BroadcastChannel |
