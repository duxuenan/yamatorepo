# 画面遷移図 - 设计规范

## 1. 功能概述

### 1.1 文档信息
| 项目 | 内容 |
|------|------|
| **工作表名称** | 画面遷移図 |
| **文档版本** | v1.0 |
| **最后更新** | 2026-02-XX|
| **文档状态** | ✅ 已发布 |

### 1.2 功能描述
本文档定义了系统中所有界面的导航关系和跳转流程，是用户界面交互设计的基础规范。

### 1.3 技术架构
本文档基于 **前后端分离架构**，详细技术规范请参考：

👉 **[\_公共技术架构规范.md](../_公共技术架构规范.md)**

| 层级 | 技术 |
|------|------|
| 前端 | React 18.x + TypeScript + Ant Design |
| 后端 | Spring Boot 3.x + Java 17 |
| 状态管理 | Zustand |
| 路由管理 | React Router 6.x |
| 动画库 | Framer Motion |

### 1.4 适用范围
- 前端开发人员（React导航实现）
- 后端开发人员（Spring Boot API）
- UI/UX设计师（流程设计）
- 测试工程师（流程测试）

---

## 2. 导航架构总览

### 2.1 双角色架构

```
┌─────────────────────────────────────────────────────────┐
│              大和运输业务改善系统                         │
├────────────────────────┴────────────────────────────────┤
│  ┌─────────────────────┐      ┌─────────────────────┐  │
│  │  ベース用户 (b0-b15) │      │ 輸送パートナー (p0-p6) │  │
│  │  16个界面          │      │  6个界面            │  │
│  │  PCのみ           │      │  PC/SP対応          │  │
│  └─────────────────────┘      └─────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

### 2.2 核心导航原则

| 原则 | 说明 | 实现要求 |
|------|------|----------|
| **一致性** | 同类操作采用相同导航模式 | 统一使用链接跳转 |
| **可预测性** | 用户可预知导航结果 | 明确的链接文本 |
| **可回退性** | 提供返回上级界面功能 | 面包屑或返回按钮 |
| **层级清晰** | 导航层级不超过3层 | 扁平化菜单设计 |

---

## 3. 基础用户导航流程

### 3.1 主导航流程

```
b1-スタート（登录入口）
    │
    ├──► b0-共通ナビゲーション（导航菜单）
    │       │
    │       ├──► b2-発注検索
    │       │       └──► b3-発注詳細
    │       │
    │       ├──► b4-実績検索
    │       │       └──► b5-実績詳細
    │       │
    │       ├──► b6-被請求管理
    │       │       └──► b7-被請求詳細
    │       │
    │       ├──► b8-CSVアップロード
    │       │
    │       ├──► b9-アクション履歴
    │       │
    │       ├──► b10-マスタ管理
    │       │       ├──► b11-輸送パートナーマスタ検索
    │       │       │       ├──► b12-輸送パートナー詳細（会社）
    │       │       │       └──► b13-輸送パートナー詳細（ユーザー）
    │       │       │
    │       │       └──► b14-ベースアカウントマスタ検索
    │       │               └──► b15-ベースアカウントマスタ詳細
    │       │
    │       └──► b1-スタート（ログアウト）
    │
    └──► AzureAD認証
```

### 3.2 订单管理流程

```
ベース側                              輸送パートナー側
   │                                     │
   ├──► b2-発注検索                    ├──► p2-発注検索
   │       │                             │
   ├──► b3-発注詳細                    ├──► p3-発注詳細
   │       │                             │
   ├──► 月間運行指示書送付              ├──► 承諾/却下処理
   │       │
   └──► メッセージやり取り
```

### 3.3 业绩管理流程

```
ベース側                              輸送パートナー側
   │                                     │
   ├──► b4-実績検索                    ├──► p4-実績確認
   │       │                             │
   ├──► b5-実績詳細                    ├──► 確定前/確定後
   │       │                             │
   └──► 輸送パートナーに送付              └──► メッセージやり取り
```

### 3.4 计费管理流程

```
ベース側                              輸送パートナー側
   │                                     │
   ├──► b6-被請求管理                    ├──► p5-請求検索
   │       │                             │       │
   ├──► b7-被請求詳細                    └──► p6-請求書アップロード
   │       │
   └──► 代理アップロード（必要時）
```

---

## 4. 运输合作伙伴导航流程

### 4.1 主导航流程

```
p1-スタート（登录入口）
    │
    ├──► p0-共通ナビゲーション（导航菜单）
    │       │
    │       ├──► p2-発注検索
    │       │       └──► p3-発注詳細
    │       │
    │       ├──► p4-実績確認
    │       │
    │       ├──► p5-請求検索
    │       │       └──► p6-請求書アップロード
    │       │
    │       └──► p1-スタート（ログアウト）
    │
    └──► AzureAD認証
```

---

## 5. 界面跳转矩阵

### 5.1 基础用户跳转关系

| 源界面 | 目标界面 | 跳转类型 | 触发条件 | 路由参数 |
|--------|----------|----------|----------|----------|
| b1-スタート | b0-共通ナビゲーション | 自动 | 登录成功后 | - |
| b0-共通ナビゲーション | b2-発注検索 | 链接 | 点击メニュー | - |
| b2-発注検索 | b3-発注詳細 | 链接 | 选择订单 | ?orderId=xxx |
| b0-共通ナビゲーション | b4-実績検索 | 链接 | 点击メニュー | - |
| b4-実績検索 | b5-実績詳細 | 链接 | 选择业绩 | ?completedOrderId=xxx |
| b0-共通ナビゲーション | b6-被請求管理 | 链接 | 点击メニュー | - |
| b6-被請求管理 | b7-被請求詳細 | 链接 | 选择请求 | ?claimId=xxx |
| b0-共通ナビゲーション | b8-CSVアップロード | 链接 | 点击メニュー | - |
| b0-共通ナビゲーション | b9-アクション履歴 | 链接 | 点击メニュー | - |
| b0-共通ナビゲーション | b10-マスタ管理 | 链接 | 点击メニュー | - |
| b10-マスタ管理 | b11-輸送パートナーマスタ検索 | 链接 | 点击メニュー | - |
| b11-輸送パートナーマスタ検索 | b12-輸送パートナー詳細（会社） | 链接 | 选择合作伙伴 | ?partnerId=xxx |
| b11-輸送パートナーマスタ検索 | b13-輸送パートナー詳細（ユーザー） | 链接 | 选择用户 | ?userId=xxx |
| b10-マスタ管理 | b14-ベースアカウントマスタ検索 | 链接 | 点击メニュー | - |
| b14-ベースアカウントマスタ検索 | b15-ベースアカウントマスタ詳細 | 链接 | 选择账户 | ?accountId=xxx |
| b0-共通ナビゲーション | b1-スタート | 链接 | 点击ログアウト | - |

### 5.2 运输合作伙伴跳转关系

| 源界面 | 目标界面 | 跳转类型 | 触发条件 | 路由参数 |
|--------|----------|----------|----------|----------|
| p1-スタート | p0-共通ナビゲーション | 自动 | 登录成功后 | - |
| p0-共通ナビゲーション | p2-発注検索 | 链接 | 点击メニュー | - |
| p2-発注検索 | p3-発注詳細 | 链接 | 选择订单 | ?orderId=xxx |
| p0-共通ナビゲーション | p4-実績確認 | 链接 | 点击メニュー | - |
| p0-共通ナビゲーション | p5-請求検索 | 链接 | 点击メニュー | - |
| p5-請求検索 | p6-請求書アップロード | 链接 | 点击アップロード | ?claimId=xxx |
| p0-共通ナビゲーション | p1-スタート | 链接 | 点击ログアウト | - |

---

## 6. 跨角色数据流

### 6.1 订单数据流
```
ベース（发送方）                    輸送パートナー（接收方）
     │                                    │
     │  b3-発注詳細                        │
     │  月間運行指示書送付                  │
     ▼                                    ▼
[データ伝送] ───────────────────► [データ受信]
                                        │
                                        ▼
                                   p3-発注詳細
                                   承諾/却下処理
```

### 6.2 业绩数据流
```
ベース（发送方）                    輸送パートナー（接收方）
     │                                    │
     │  b5-実績詳細                        │
     │  日別傭車費一覧送付                  │
     ▼                                    ▼
[データ伝送] ───────────────────► [データ受信]
                                        │
                                        ▼
                                   p4-実績確認
                                   メッセージやり取り
```

### 6.3 计费数据流
```
ベース（发送方）                    輸送パートナー（接收方）
     │                                    │
     │  b6-被請求管理                       │
     │  請求書ダウンロード                   │
     │                                    │
     │  ◄───────────────────              │
     │        請求書確認                   │
     │                                    │
     │  b7-被請求詳細                       │
     │  代理アップロード（必要時）            │
     │                                    │
     │◄───────────────────────────────────
     │       請求書アップロード
```

---

## 7. 导航UI规范

### 7.1 导航组件要求

| 组件 | 位置 | 功能 | 前端实现 | 后端支持 |
|------|------|------|----------|----------|
| **导航菜单** | 左侧固定 | 功能入口 | SideMenu.tsx | /api/v1/menus/user |
| **面包屑** | 顶部 | 层级导航 | Breadcrumb.tsx | /api/v1/navigation/breadcrumb |
| **返回按钮** | 左上角 | 返回上级 | Button.tsx | - |
| **页面标题** | 顶部居中 | 页面标识 | PageHeader.tsx | - |
| **标签页** | 顶部 | 多页面管理 | TabNav.tsx | - |
| **登录信息** | 右上角 | 用户信息 | Header.tsx | /api/v1/user/profile |

### 7.2 响应式设计

| 断点 | 设备 | 导航模式 | 组件 |
|------|------|----------|------|
| > 1024px | PC | 左侧固定导航 | SideMenu |
| < 1024px | 平板 | 折叠导航 | Collapsible SideMenu |
| < 768px | 手机 | 汉堡菜单 | Drawer Menu |

### 7.3 过渡动画

| 场景 | 动画类型 | 时长 | 前端实现 |
|------|----------|------|----------|
| 页面跳转 | fade | 200ms | Framer Motion |
| 菜单展开 | slide | 300ms | Antd Collapse |
| 弹窗显示 | scale | 200ms | Antd Modal |
| 加载状态 | skeleton | - | Antd Skeleton |

---

## 8. 数据库设计

### 8.1 导航历史表

详细数据库设计请参考：

👉 **[\_公共技术架构规范.md](../_公共技术架构规范.md)#5-数据库设计规范**

### 8.2 导航特定表
```sql
-- 导航历史表
CREATE TABLE t_navigation_history (
    id BIGSERIAL PRIMARY KEY,
    user_id VARCHAR(50) NOT NULL,
    from_screen_id VARCHAR(20),
    to_screen_id VARCHAR(20) NOT NULL,
    trigger_type VARCHAR(50),  -- LINK_CLICK, MENU_SELECT, etc.
    accessed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT fk_user FOREIGN KEY (user_id)
        REFERENCES m_user(user_id)
);

-- 最近访问表（缓存）
CREATE TABLE t_recent_access (
    id BIGSERIAL PRIMARY KEY,
    user_id VARCHAR(50) NOT NULL,
    screen_id VARCHAR(20) NOT NULL,
    accessed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    access_count INTEGER DEFAULT 1,
    
    CONSTRAINT fk_user_recent FOREIGN KEY (user_id)
        REFERENCES m_user(user_id)
);
```

---

## 9. API接口设计

### 9.1 导航API

详细API设计请参考：

👉 **[\_公共技术架构规范.md](../_公共技术架构规范.md)#4-api接口规范**

### 9.2 导航特定接口
```yaml
# 获取面包屑
GET /api/v1/navigation/breadcrumb?screenId=b3
Authorization: Bearer {token}

# 记录导航历史
POST /api/v1/navigation/history
Authorization: Bearer {token}

# 获取最近访问
GET /api/v1/navigation/recent?limit=5
Authorization: Bearer {token}
```

---

## 10. 前端实现

### 10.1 路由配置

详细前端架构请参考：

👉 **[\_公共技术架构规范.md](../_公共技术架构规范.md)#2-前端架构规范**

### 10.2 导航特定组件
```typescript
// 面包屑组件
import { Breadcrumb as AntBreadcrumb } from 'antd';
import { useLocation, Link } from 'react-router-dom';
import { useBreadcrumbStore } from '@/stores/navigationStore';

export const Breadcrumb: React.FC = () => {
  const location = useLocation();
  const { breadcrumbs } = useBreadcrumbStore();
  
  // 根据路径生成面包屑
  const items = location.pathname
    .split('/')
    .filter(Boolean)
    .map((path, index) => ({
      title: (
        <Link to={`/${path}`}>
          {breadcrumbs.find(b => b.path === path)?.title || path}
        </Link>
      ),
    }));
  
  return <AntBreadcrumb items={items} />;
};

// 标签页组件
import { Tabs } from 'antd';
import { useTabStore } from '@/stores/navigationStore';

export const TabNav: React.FC = () => {
  const { tabs, activeTab, addTab, closeTab, setActiveTab } = useTabStore();
  
  return (
    <Tabs
      activeKey={activeTab}
      onChange={setActiveTab}
      onEdit={(key, action) => {
        if (action === 'remove') {
          closeTab(key as string);
        }
      }}
      items={tabs.map(tab => ({
        key: tab.id,
        label: tab.title,
        closable: tab.closable,
      }))}
    />
  );
};
```

---

## 11. 验收标准

### 11.1 功能验收
- [ ] 所有跳转链接可正常访问
- [ ] 导航菜单层级不超过3层
- [ ] 返回按钮功能正常
- [ ] 页面标题与实际页面一致
- [ ] 面包屑导航正确

### 11.2 前端验收
- [ ] React路由配置正确
- [ ] 权限守卫正常工作
- [ ] 面包屑导航正确
- [ ] 标签页管理正常
- [ ] 动画效果流畅
- [ ] 响应式适配正确

### 11.3 后端验收
- [ ] Spring Boot应用正常启动
- [ ] 导航API正常响应
- [ ] JWT认证正常工作
- [ ] Redis缓存生效
- [ ] API响应时间 < 200ms

### 11.4 性能验收
- [ ] 首次加载时间 < 2秒
- [ ] 页面跳转时间 < 300ms
- [ ] API响应时间 < 200ms
- [ ] 支持1000+并发用户

---

## 12. 变更日志

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|---------|------|
| 2026-02-XX| v1.0 | 初始版本 | - |

---

## 附录

### A.1 界面数量统计
| 用户类型 | 界面数量 | 支持设备 |
|----------|---------|----------|
| ベース | 16 | PCのみ |
| 輸送パートナー | 6 | PC/SP |

### A.2 导航深度统计
| 界面 | 最大导航深度 | 说明 |
|------|-------------|------|
| 导航菜单 | 1 | 一级入口 |
| 详情界面 | 2 | 搜索→详情 |
| 主数据管理 | 4 | 管理→搜索→详情 |

### A.3 相关文档
| 文档 | 路径 | 说明 |
|------|------|------|
| 公共技术架构规范 | [\_公共技术架构规范.md](../_公共技术架构规范.md) | 前后端技术架构详细规范 |
| 画面一覧设计规范 | [../画面一覧/05_设计规范.md](../画面一覧/05_设计规范.md) | 界面清单和权限配置 |
| b0设计规范 | [../b0-共通ナビゲーション/05_设计规范.md](../b0-共通ナビゲーション/05_设计规范.md) | 导航菜单设计规范 |

---

**文档编制**: -  
**编制时间**: 2026-02-XX 
**适用范围**: 別紙_画面一覧_v151.xlsx - 画面遷移図  
**交叉引用**: [\_公共技术架构规范.md](../_公共技术架构规范.md)