# p3-ç™ºæ³¨è©³ç´° - è®¾è®¡è§„èŒƒ

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **å·¥ä½œè¡¨åç§°** | p3-ç™ºæ³¨è©³ç´° |
| **ç•Œé¢ç¼–å·** | p3 |
| **å¯¹åº”Baseç•Œé¢** | b3-ç™ºæ³¨è©³ç´° |
| **æ–‡æ¡£ç‰ˆæœ¬** | v1.0 |
| **æœ€åæ›´æ–°** | 2026-02-10 |
| **æ–‡æ¡£çŠ¶æ€** | âœ… å·²å‘å¸ƒ |

### 1.2 åŠŸèƒ½æè¿°

p3-ç™ºæ³¨è©³ç´°æ˜¯ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ï¼ˆåˆä½œä¼™ä¼´ï¼‰ä¾§æŸ¥çœ‹å’Œæ“ä½œæœˆåº¦è¿è¡ŒæŒ‡ç¤ºä¹¦ï¼ˆç™ºæ³¨ï¼‰è¯¦æƒ…çš„é¡µé¢ã€‚ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼å¯ä»¥é€šè¿‡æ­¤é¡µé¢ï¼š

- æŸ¥çœ‹æ¥è‡ªãƒ™ãƒ¼ã‚¹ï¼ˆæ€»éƒ¨ï¼‰çš„æœˆåº¦è¿è¡ŒæŒ‡ç¤ºä¹¦è¯¦ç»†ä¿¡æ¯
- å¯¹æŒ‡ç¤ºä¹¦è¿›è¡Œæ‰¿è¯ºï¼ˆæ‰¿è«¾ï¼‰æˆ–æ‹’ç»æ“ä½œ
- éƒ¨åˆ†é€‰æ‹©æ‰¿è¯ºæŒ‡ç¤ºä¹¦å†…å®¹
- ä¸‹è½½æœˆåº¦è¿è¡ŒæŒ‡ç¤ºä¹¦PDF
- ä¸ãƒ™ãƒ¼ã‚¹è¿›è¡Œæ¶ˆæ¯æ²Ÿé€š
- ä¸Šä¼ /ä¸‹è½½ç›¸å…³æ–‡ä»¶
- è·Ÿè¸ªæ“ä½œå†å²è®°å½•

### 1.3 æŠ€æœ¯æ¶æ„

æœ¬æ–‡æ¡£åŸºäº **å‰åç«¯åˆ†ç¦»æ¶æ„**ï¼Œè¯¦ç»†æŠ€æœ¯è§„èŒƒè¯·å‚è€ƒï¼š

ğŸ‘‰ **[\_å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ.md](../_å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ.md)**

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| å‰ç«¯ | React 18.x + TypeScript + Ant Design |
| åç«¯ | Spring Boot 3.x + Java 17 |
| æ•°æ®åº“ | PostgreSQL 15.x |

### 1.4 æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| ä¾é ¼æƒ…å ±æ˜¾ç¤º | æ˜¾ç¤ºç™ºæ³¨å¯¾è±¡çš„å¹´æœˆã€ãƒ™ãƒ¼ã‚¹å | P0 |
| æœˆé–“é‹è¡ŒæŒ‡ç¤ºæ›¸æ˜¾ç¤º | æ˜¾ç¤ºæŒ‡ç¤ºä¹¦è¯¦ç»†å†…å®¹ | P0 |
| æŒ‡ç¤ºæ›¸versioné¸æŠ | é€‰æ‹©ä¸åŒç‰ˆæœ¬çš„æŒ‡ç¤ºä¹¦ | P0 |
| æ‰¿è«¾/å´ä¸‹æ“ä½œ | å¯¹æŒ‡ç¤ºä¹¦è¿›è¡Œæ‰¿è¯ºæˆ–æ‹’ç» | P0 |
| éƒ¨åˆ†æ‰¿è¯º | é¸æŠãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹é€‰æ‹©åéƒ¨åˆ†æ‰¿è¯º | P0 |
| ã™ã¹ã¦æ‰¿è«¾ | ä¸€é”®æ‰¿è¯ºæ‰€æœ‰æŒ‡ç¤ºä¹¦ | P0 |
| ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ | ä¸‹è½½PDFæ ¼å¼çš„æŒ‡ç¤ºä¹¦ | P0 |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | ä¸ãƒ™ãƒ¼ã‚¹è¿›è¡Œæ¶ˆæ¯æ²Ÿé€š | P1 |
| å±¥æ­´ç®¡ç† | æŸ¥çœ‹æ“ä½œå†å²è®°å½• | P1 |
| ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | ä¸Šä¼ /ä¸‹è½½ç›¸å…³æ–‡ä»¶ | P1 |

### 1.5 é€‚ç”¨èŒƒå›´

- å‰ç«¯å¼€å‘äººå‘˜ï¼ˆè¯¦æƒ…é¡µé¢ç»„ä»¶å®ç°ï¼‰
- åç«¯å¼€å‘äººå‘˜ï¼ˆæŒ‡ç¤ºä¹¦æ“ä½œAPIå¼€å‘ï¼‰
- æµ‹è¯•å·¥ç¨‹å¸ˆï¼ˆåŠŸèƒ½æµ‹è¯•ï¼‰

---

## 2. é¡µé¢å…ƒç´ 

### 2.1 PCç«¯å…ƒç´ æ¸…å•

#### 2.1.1 ä¾é ¼æƒ…å ±åŒºåŸŸ

| åºå· | å…ƒç´ åç§° | å…ƒç´ ç±»å‹ | åŠŸèƒ½è¯´æ˜ |
|------|----------|----------|----------|
| â‘´ | å¹´æœˆ | Text | ç™ºæ³¨å¯¾è±¡çš„å¹´æœˆè¡¨ç¤º |
| â‘µ | å¯¾è±¡ãƒ™ãƒ¼ã‚¹ | Text | ç™ºæ³¨å¯¾è±¡çš„ä¾é ¼ãƒ™ãƒ¼ã‚¹åè¡¨ç¤º |

#### 2.1.2 æœˆé–“é‹è¡ŒæŒ‡ç¤ºæ›¸åŒºåŸŸ

| åºå· | å…ƒç´ åç§° | å…ƒç´ ç±»å‹ | åŠŸèƒ½è¯´æ˜ | äº¤äº’è§¦å‘ |
|------|----------|----------|----------|----------|
| â‘¶ | versioné¸æŠ | Select | é¸æ“‡æŒ‡ç¤ºæ›¸ç‰ˆæœ¬ | ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³é¸æŠ |
| â‘· | æœˆé–“é‹è¡ŒæŒ‡ç¤ºæ›¸ | Text | æŒ‡ç¤ºæ›¸æ ‡é¢˜ | è¡¨ç¤º |
| â‘¸ | å¾¡ä¸­ | Text | åˆä½œæ–¹åç§° | è¡¨ç¤º |
| â‘¹ | ç½²åãƒ»æºå° | Text | ç½²åæç¤ºæ–‡å­— | è¡¨ç¤º |
| â‘º | -baseæƒ…å ± | Text | ãƒ™ãƒ¼ã‚¹åã€TELã€FAX | è¡¨ç¤º |
| â‘» | ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ | Checkbox | é€‰æ‹©æŒ‡ç¤ºä¹¦é¡¹ç›® | ãƒã‚§ãƒƒã‚¯é¸æŠ |
| â‘¼ | ç·šä¾¿ | Column | çº¿è·¯ç¼–å· | è¡¨ç¤º |
| â‘½ | AM/PM | Column | æ—¶æ®µ | è¡¨ç¤º |
| â‘¾ | ç™º | Column | å‘ç«™ | è¡¨ç¤º |
| â‘¿ | ç€ | Column | ç€ç«™ | è¡¨ç¤º |
| â’€ | ç³»çµ± | Column | ç³»ç»Ÿ | è¡¨ç¤º |
| â’ | ç·šä¾¿å | Column | çº¿è·¯å | è¡¨ç¤º |
| â’‚ | å…¥åº«å ´æ‰€ | Column | å…¥åº“åœºæ‰€ | è¡¨ç¤º |
| â’ƒ | å…¥åº«æ™‚é–“ | Column | å…¥åº“æ—¶é—´ | è¡¨ç¤º |
| â’„ | ä½¿ç”¨è»Šä¸¡(ãƒˆãƒ³) | Column | ä½¿ç”¨è½¦è¾†å¨æ•° | è¡¨ç¤º |
| â’… | ç«ã€œæ—¥ | Column | æ—¥æœŸæ’ç­ | ã‚¯ãƒªãƒƒã‚¯åˆ‡æ¢ |

#### 2.1.3 æ“ä½œæŒ‰é’®åŒºåŸŸ

| åºå· | å…ƒç´ åç§° | å…ƒç´ ç±»å‹ | åŠŸèƒ½è¯´æ˜ | äº¤äº’è§¦å‘ |
|------|----------|----------|----------|----------|
| â’† | ç¢ºèªä¾é ¼ | Button | ç¡®è®¤ä¾é ¼ | ã‚¯ãƒªãƒƒã‚¯ |
| â’‡ | å¤‰æ›´ã‚’ä¿å­˜ | Button | ä¿å­˜å˜æ›´ | ã‚¯ãƒªãƒƒã‚¯ |
| â’‡ | ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ | Button | ä¸‹è½½PDF | ã‚¯ãƒªãƒƒã‚¯ |
| â’‡ | ã™ã¹ã¦æ‰¿è«¾ | Button | æ‰¿è¯ºå…¨éƒ¨ | ã‚¯ãƒªãƒƒã‚¯ |
| â’‡ | ãƒã‚§ãƒƒã‚¯ã—ãŸæŒ‡ç¤ºã‚’æ‰¿è«¾ | Button | æ‰¿è¯ºæ‰€é€‰ | ã‚¯ãƒªãƒƒã‚¯ |

#### 2.1.4 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸åŒºåŸŸ

| åºå· | å…ƒç´ åç§° | å…ƒç´ ç±»å‹ | åŠŸèƒ½è¯´æ˜ | äº¤äº’è§¦å‘ |
|------|----------|----------|----------|----------|
| â’‡ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | Button | æ‰“å¼€æ¶ˆæ¯é¢æ¿ | ã‚¯ãƒªãƒƒã‚¯ |
| â’‡ | ãƒ™ãƒ¼ã‚¹é¸æŠ | Select | é€‰æ‹©é€šä¿¡ãƒ™ãƒ¼ã‚¹ | ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³é¸æŠ |
| â’‡ | ã‚³ãƒ¡ãƒ³ãƒˆãƒœãƒƒã‚¯ã‚¹ | Input.TextArea | è¾“å…¥æ¶ˆæ¯ | æ–‡å­—å…¥åŠ› |
| â’‡ | é€ä¿¡ | Button | å‘é€æ¶ˆæ¯ | ã‚¯ãƒªãƒƒã‚¯ |
| â’‡ | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | Link | ä¸Šä¼ æ–‡ä»¶ | ã‚¯ãƒªãƒƒã‚¯ |

#### 2.1.5 æ”¯æ‰•æƒ…å ±åŒºåŸŸ

| åºå· | å…ƒç´ åç§° | å…ƒç´ ç±»å‹ | åŠŸèƒ½è¯´æ˜ |
|------|----------|----------|----------|
| â’‡ | æ”¯æ‰•ä»£é‡‘ | Text | æ”¯æ‰•ä»£é‡‘è¯´æ˜ |
| â’‡ | æ”¯æ‰•æ–¹æ³• | Text | æ”¯æ‰•æ–¹æ³• |
| â’‡ | æ”¯æ‰•ã„æœŸé™ | Text | æ”¯æ‰•ã„æœŸé™ |
| â’‡ | æ¶ˆè²»ç¨ | Text | æ¶ˆè²»ç¨è¯´æ˜ |
| â’‡ | æŒ¯è¾¼æ‰‹æ•°æ–™ | Text | æŒ¯è¾¼æ‰‹æ•°æ–™è¯´æ˜ |

#### 2.1.6 å±¥æ­´ç®¡ç†åŒºåŸŸ

| åºå· | å…ƒç´ åç§° | å…ƒç´ ç±»å‹ | åŠŸèƒ½è¯´æ˜ |
|------|----------|----------|----------|
| â’‡ | å±¥æ­´ç®¡ç† | Section | æ“ä½œå†å²è®°å½• |
| â’‡ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ—¥æ™‚ | Column | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‘ç”Ÿæ—¶é—´ |
| â’‡ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å†…å®¹ | Column | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å†…å®¹ |

### 2.2 æŒ‡ç¤ºä¹¦è¡¨æ ¼è¯¦ç»†è¯´æ˜

| ã‚«ãƒ©ãƒ å | æ›¸å¼ | ã‚½ãƒ¼ãƒˆ | èª¬æ˜ |
|----------|------|--------|------|
| ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ | Checkbox | - | é¸æ“‡æŒ‡ç¤ºæ›¸é …ç›® |
| ç·šä¾¿ | Text | â—‹ | è·¯ç·šç•ªè™Ÿ |
| AM/PM | Text | â—‹ | æ™‚é–“å¸¯ |
| ç™º | Text | â—‹ | å‡ºç™ºç«™ |
| ç€ | Text | â—‹ | åˆ°ç€ç«™ |
| ç³»çµ± | Text | â—‹ | ç³»çµ± |
| ç·šä¾¿å | Text | â—‹ | è·¯ç·šå |
| å…¥åº«å ´æ‰€ | Text | â—‹ | å…¥åº«å ´æ‰€ |
| å…¥åº«æ™‚é–“ | Text | â—‹ | å…¥åº«æ™‚é–“ |
| ä½¿ç”¨è»Šä¸¡(ãƒˆãƒ³) | Number | â—‹ | ä½¿ç”¨è½¦è¾†çš„å¨æ•° |
| ç« | Tag | â—‹ | ç«æ›œæ—¥ã®å‹¤å‹™ï¼ˆã€‡/ç©ºæ¬„ï¼‰ |
| æ°´ | Tag | â—‹ | æ°´æ›œæ—¥ã®å‹¤å‹™ |
| æœ¨ | Tag | â—‹ | æœ¨æ›œæ—¥ã®å‹¤å‹™ |
| é‡‘ | Tag | â—‹ | é‡‘æ›œæ—¥ã®å‹¤å‹™ |
| åœŸ | Tag | â—‹ | åœŸæ›œæ—¥ã®å‹¤å‹™ |
| æ—¥ | Tag | â—‹ | æ—¥æ›œæ—¥ã®å‹¤å‹™ |
| æœˆ | Tag | â—‹ | æœˆæ›œæ—¥ã®å‹¤å‹™ |

---

## 3. äº¤äº’æµç¨‹

### 3.1 é¡µé¢åŠ è½½æµç¨‹

| ã‚¹ãƒ†ãƒƒãƒ— | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | ã‚·ã‚¹ãƒ†ãƒ å¿œç­” |
|----------|-----------|--------------|
| 1 | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒp3ãƒšãƒ¼ã‚¸ã¸é·ç§» | ãƒšãƒ¼ã‚¸åˆæœŸåŒ– |
| 2 | URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰orderIdå–å¾— | orderIdæŠ½å‡º |
| 3 | æŒ‡ç¤ºæ›¸æƒ…å ±APIå®Ÿè¡Œ | GET /api/v1/partners/orders/{orderId} |
| 4 | æŒ‡ç¤ºæ›¸å†…å®¹APIå®Ÿè¡Œ | GET /api/v1/partners/orders/{orderId}/instructions |
| 5 | APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡ | å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¡¨ç¤ºè¨­å®š |
| 6 | ãƒšãƒ¼ã‚¸è¡¨ç¤ºå®Œäº† | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¾…æ©Ÿ |

### 3.2 Versioné¸æŠæµç¨‹

| ã‚¹ãƒ†ãƒƒãƒ— | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ | ã‚·ã‚¹ãƒ†ãƒ å¿œç­” |
|----------|-------------|--------------|
| 1 | versionãƒ—ãƒ«ãƒ€ã‚¦ãƒ³é¸æŠ | versionåˆ‡æ›¿ |
| 2 | APIãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ | GET /api/v1/partners/orders/{orderId}/versions/{version} |
| 3 | æŒ‡ç¤ºæ›¸å†…å®¹æ›´æ–° | è©²å½“versionã®æŒ‡ç¤ºæ›¸è¡¨ç¤º |

### 3.3 æ‰¿è«¾æ“ä½œæµç¨‹

| ã‚¹ãƒ†ãƒƒãƒ— | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ | ã‚·ã‚¹ãƒ†ãƒ å¿œç­” |
|----------|-------------|--------------|
| 1 | ã™ã¹ã¦æ‰¿è«¾ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ | ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º |
| 2 | ç¢ºèª | APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè¡Œ |
| 3 | æ‰¿è«¾æˆåŠŸ | å…¨é …ç›®ã€Œæ‰¿è«¾æ¸ˆã€è¡¨ç¤ºæ›´æ–° |
| 4 | æ‰¿è«¾å¤±æ•— | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º |

### 3.4 éƒ¨åˆ†æ‰¿è«¾æµç¨‹

| ã‚¹ãƒ†ãƒƒãƒ— | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ | ã‚·ã‚¹ãƒ†ãƒ å¿œç­” |
|----------|-------------|--------------|
| 1 | ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹é¸æŠ | è©²å½“è¡Œé¸æŠçŠ¶æ…‹ |
| 2 | ãƒã‚§ãƒƒã‚¯ã—ãŸæŒ‡ç¤ºã‚’æ‰¿è«¾ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ | ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º |
| 3 | ç¢ºèª | APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè¡Œ |
| 4 | æ‰¿è«¾æˆåŠŸ | é¸æŠé …ç›®ã®ã¿ã€Œæ‰¿è«¾æ¸ˆã€è¡¨ç¤º |

### 3.5 å¤‰æ›´æ“ä½œæµç¨‹

| ã‚¹ãƒ†ãƒƒãƒ— | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ | ã‚·ã‚¹ãƒ†ãƒ å¿œç­” |
|----------|-------------|--------------|
| 1 | æ—¥ä»˜éƒ¨åˆ†ã‚¯ãƒªãƒƒã‚¯ | å¹ãå‡ºã—è¡¨ç¤º |
| 2 | äº‹ç”±ãƒ»å¤‰æ›´å¾Œå…¥åŠ› | å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ä¿æŒ |
| 3 | å¤‰æ›´ã‚’ä¿å­˜ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ | APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè¡Œ |
| 4 | ä¿å­˜æˆåŠŸ | è©²å½“é …ç›®ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º |

### 3.6 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ“ä½œæµç¨‹

| ã‚¹ãƒ†ãƒƒãƒ— | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ | ã‚·ã‚¹ãƒ†ãƒ å¿œç­” |
|----------|-------------|--------------|
| 1 | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ | å³å´Drawerè¡¨ç¤º |
| 2 | ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³é¸æŠ | é€šä¿¡ç›¸æ‰‹åˆ‡æ›¿ |
| 3 | ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ› | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ› |
| 4 | é€ä¿¡ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ | APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè¡Œ |
| 5 | é€ä¿¡æˆåŠŸ | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆæ›´æ–° |

---

## 4. ç•Œé¢è§„èŒƒ

### 4.1 é¡µé¢å¸ƒå±€

| å±æ€§ | PCç«¯å€¤ | SPç«¯å€¤ | èª¬æ˜ |
|------|--------|--------|------|
| **ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—** | PCã®ã¿ | - | PCä¸“ç”¨é¡µé¢ |
| **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ–¹å¼** | å·¦å³å¸ƒå±€ | å‚ç›´å¸ƒå±€ | ãƒ¡ã‚¤ãƒ³â†’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸Drawer |
| **ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–“éš”** | 24px | 16px | ã‚«ãƒ¼ãƒ‰é–“ä½™ç™½ |

### 4.2 æŒ‡ç¤ºä¹¦è¡¨æ ¼è§„æ ¼

| å±æ€§ | å€¤ | èª¬æ˜ |
|------|----|------|
| **è¡Œé«˜** | 48px | å›ºå®šè¡Œé«˜ |
| **ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º** | 12px | è¡¨æ ¼å†…æ–‡å­— |
| **ç¸æ¨¡æ§˜** | æœ‰ã‚Š | å¶æ•°è¡ŒèƒŒæ™¯#fafafa |
| **ãƒ›ãƒãƒ¼åŠ¹æœ** | æœ‰ã‚Š | è¡Œãƒ›ãƒãƒ¼èƒŒæ™¯#f5f5f5 |
| **ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«** | æ¨ªæ»šåŠ¨ | ãƒ†ãƒ¼ãƒ–ãƒ«å¹…è¶…ãˆæ—¶ |

### 4.3 çŠ¶æ€æ ‡ç­¾é¢œè‰²

| çŠ¶æ…‹ | èƒŒæ™¯è‰² | æ–‡å­—è‰² | èª¬æ˜ |
|------|--------|--------|------|
| æ‰¿è«¾æ¸ˆ | #52c41a | #ffffff | ç»¿è‰² |
| ã€‡ | #52c41a | #ffffff | å·²ç¡®è®¤ |
| ç©ºæ¬„ | #ffffff | #000000 | æœªç¡®è®¤ |
| å¤‰æ›´æ¸ˆ | #fa8c16 | #ffffff | æ©™è‰² |

### 4.4 Drawerè§„æ ¼

| å±æ€§ | å€¤ | èª¬æ˜ |
|------|----|------|
| **é…ç½®** | right | å³ä¾§æ»‘å‡º |
| **å¹…åº¦** | 400px | PCç«¯å®½åº¦ |
| **ã‚¿ã‚¤ãƒˆãƒ«** | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | å›ºå®šæ ‡é¢˜ |

---

## 5. APIæ¥å£è®¾è®¡

### 5.1 è·å–æŒ‡ç¤ºä¹¦è¯¦æƒ…

```typescript
// GET /api/v1/partners/orders/{orderId}
interface GetOrderDetailRequest {
  orderId: string;
}

interface GetOrderDetailResponse {
  success: boolean;
  data: {
    orderId: string;
    orderYearMonth: string;
    baseName: string;
    version: string;
    status: OrderStatus;
    partnerName: string;
    baseContact: {
      name: string;
      tel: string;
      fax: string;
    };
    paymentInfo: {
      paymentAmount: string;
      paymentMethod: string;
      paymentDeadline: string;
      consumptionTax: string;
      transferFee: string;
    };
    instructions: Instruction[];
    createdAt: string;
    updatedAt: string;
  };
}

type OrderStatus =
  | 'PENDING'
  | 'ACCEPTED'
  | 'PARTIALLY_ACCEPTED'
  | 'REJECTED'
  | 'EXPIRED';
```

### 5.2 è·å–æŒ‡ç¤ºä¹¦åˆ—è¡¨

```typescript
// GET /api/v1/partners/orders/{orderId}/instructions
interface GetInstructionsRequest {
  orderId: string;
  version?: string;
}

interface Instruction {
  instructionId: string;
  lineNumber: string;
  amPm: string;
  departure: string;
  arrival: string;
  system: string;
  lineName: string;
  warehouse: string;
  warehouseTime: string;
  vehicleTonnage: number;
  schedule: {
    tue?: string;
    wed?: string;
    thu?: string;
    fri?: string;
    sat?: string;
    sun?: string;
    mon?: string;
  };
  status: 'PENDING' | 'ACCEPTED';
  hasChanges: boolean;
  changeReason?: string;
  changedTo?: string;
}

interface GetInstructionsResponse {
  success: boolean;
  data: {
    instructions: Instruction[];
    totalCount: number;
    acceptedCount: number;
  };
}
```

### 5.3 æ‰¿è¯ºæ“ä½œ

```typescript
// POST /api/v1/partners/orders/{orderId}/accept
interface AcceptOrderRequest {
  orderId: string;
  version: string;
  instructionIds?: string[]; // ç©ºæ•°ç»„=å…¨éƒ¨æ‰¿è¯º
  memo?: string;
}

interface AcceptOrderResponse {
  success: boolean;
  data: {
    orderId: string;
    status: 'ACCEPTED' | 'PARTIALLY_ACCEPTED';
    acceptedCount: number;
    acceptedAt: string;
  };
  message: string;
}
```

### 5.4 æ‹’ç»æ“ä½œ

```typescript
// POST /api/v1/partners/orders/{orderId}/reject
interface RejectOrderRequest {
  orderId: string;
  reason: string;
}

interface RejectOrderResponse {
  success: boolean;
  data: {
    orderId: string;
    status: 'REJECTED';
    rejectedAt: string;
  };
  message: string;
}
```

### 5.5 å˜æ›´ä¿å­˜

```typescript
// PUT /api/v1/partners/orders/{orderId}/instructions/{instructionId}/change
interface ChangeInstructionRequest {
  instructionId: string;
  reason: string;
  changedTo: string;
}

interface ChangeInstructionResponse {
  success: boolean;
  data: {
    instructionId: string;
    hasChanges: true;
    changeReason: string;
    changedTo: string;
    changedAt: string;
  };
  message: string;
}
```

### 5.6 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ“ä½œ

```typescript
// GET /api/v1/partners/orders/{orderId}/messages
interface GetMessagesRequest {
  orderId: string;
  baseId: string;
}

interface Message {
  messageId: string;
  sender: 'PARTNER' | 'BASE';
  senderName: string;
  content: string;
  attachments: Attachment[];
  sentAt: string;
}

interface Attachment {
  fileId: string;
  fileName: string;
  fileSize: number;
  uploadedAt: string;
}

interface GetMessagesResponse {
  success: boolean;
  data: {
    messages: Message[];
  };
}

// POST /api/v1/partners/orders/{orderId}/messages
interface SendMessageRequest {
  orderId: string;
  baseId: string;
  content: string;
  attachmentIds?: string[];
}

// POST /api/v1/partners/orders/{orderId}/attachments
interface UploadAttachmentRequest {
  file: File;
}

interface UploadAttachmentResponse {
  success: boolean;
  data: {
    fileId: string;
    fileName: string;
    fileSize: number;
  };
}
```

### 5.7 ä¸‹è½½æŒ‡ç¤ºä¹¦

```typescript
// GET /api/v1/partners/orders/{orderId}/pdf
interface DownloadPdfRequest {
  orderId: string;
  version?: string;
}
```

### 5.8 APIé”™è¯¯å“åº”

```typescript
interface ApiErrorResponse {
  success: false;
  error: {
    code: ErrorCode;
    message: string;
    details?: Record<string, unknown>;
  };
}

type ErrorCode =
  | 'ORDER_NOT_FOUND'
  | 'ORDER_ALREADY_PROCESSED'
  | 'ORDER_EXPIRED'
  | 'INVALID_VERSION'
  | 'INSTRUCTION_NOT_FOUND'
  | 'PERMISSION_DENIED'
  | 'INVALID_REQUEST'
  | 'INTERNAL_ERROR';
```

---

## 6. å‰ç«¯ç»„ä»¶è®¾è®¡

### 6.1 é¡µé¢ç»„ä»¶ç»“æ„

```
p3-OrderDetail/
â”œâ”€â”€ index.tsx                    # ä¸»é¡µé¢ç»„ä»¶
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ OrderHeader.tsx         # è®¢å•å¤´éƒ¨
â”‚   â”œâ”€â”€ InstructionInfo.tsx     # ä¾é ¼æƒ…å ±åŒºåŸŸ
â”‚   â”œâ”€â”€ InstructionTable.tsx    # æŒ‡ç¤ºæ›¸è¡¨æ ¼
â”‚   â”œâ”€â”€ VersionSelector.tsx     # Versioné¸æŠ
â”‚   â”œâ”€â”€ ActionButtons.tsx      # æ“ä½œæŒ‰é’®ç»„
â”‚   â”œâ”€â”€ AcceptModal.tsx        # æ‰¿è¯ºç¡®è®¤å¼¹çª—
â”‚   â”œâ”€â”€ ChangeModal.tsx         # å˜æ›´ç¡®è®¤å¼¹çª—
â”‚   â”œâ”€â”€ MessageDrawer.tsx       # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸Drawer
â”‚   â”œâ”€â”€ MessageList.tsx        # æ¶ˆæ¯åˆ—è¡¨
â”‚   â”œâ”€â”€ MessageInput.tsx       # æ¶ˆæ¯è¾“å…¥
â”‚   â”œâ”€â”€ AttachmentList.tsx      # é™„ä»¶åˆ—è¡¨
â”‚   â”œâ”€â”€ StatusTag.tsx          # çŠ¶æ€æ ‡ç­¾
â”‚   â””â”€â”€ PaymentInfo.tsx        # æ”¯æ‰•æƒ…å ±åŒºåŸŸ
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useOrderDetail.ts       # æŒ‡ç¤ºä¹¦è¯¦æƒ…Hook
â”‚   â”œâ”€â”€ useInstructions.ts      # æŒ‡ç¤ºä¹¦åˆ—è¡¨Hook
â”‚   â”œâ”€â”€ useOrderActions.ts      # æ“ä½œHook
â”‚   â””â”€â”€ useMessages.ts          # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸Hook
â”œâ”€â”€ types/
â”‚   â””â”€â”€ order.ts               # è®¢å•ç›¸å…³ç±»å‹å®šä¹‰
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ instructionFormatter.ts # æ ¼å¼åŒ–å·¥å…·
â”‚   â””â”€â”€ validation.ts          # è¡¨å•éªŒè¯
â””â”€â”€ styles/
    â””â”€â”€ OrderDetail.module.css
```

### 6.2 ä¸»é¡µé¢ç»„ä»¶

```tsx
// index.tsx
import React, { useEffect, useState } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { Spin, message, Drawer } from 'antd';
import { OrderHeader } from './components/OrderHeader';
import { InstructionInfo } from './components/InstructionInfo';
import { InstructionTable } from './components/InstructionTable';
import { ActionButtons } from './components/ActionButtons';
import { PaymentInfo } from './components/PaymentInfo';
import { MessageDrawer } from './components/MessageDrawer';
import { useOrderDetail } from './hooks/useOrderDetail';
import styles from './styles/OrderDetail.module.css';

export const OrderDetailPage: React.FC = () => {
  const { orderId } = useParams<{ orderId: string }>();
  const navigate = useNavigate();
  const { order, loading, error, refresh } = useOrderDetail(orderId);
  const [messageApi, contextHolder] = message.useMessage();
  const [messageDrawerOpen, setMessageDrawerOpen] = useState(false);

  const handleAccept = async (instructionIds?: string[]) => {
    try {
      await acceptOrder(orderId!, instructionIds, undefined);
      messageApi.success('æŒ‡ç¤ºæ›¸ã‚’æ‰¿è«¾ã—ã¾ã—ãŸ');
      refresh();
    } catch (err) {
      messageApi.error(err.message);
    }
  };

  const handleReject = async (reason: string) => {
    try {
      await rejectOrder(orderId!, reason);
      messageApi.success('æŒ‡ç¤ºæ›¸ã‚’å´ä¸‹ã—ã¾ã—ãŸ');
      refresh();
    } catch (err) {
      messageApi.error(err.message);
    }
  };

  const handleDownload = () => {
    downloadPdf(orderId!);
  };

  const handleBack = () => {
    navigate('/p2');
  };

  if (loading) {
    return <Spin size="large" className={styles.loading} />;
  }

  if (error || !order) {
    return <div className={styles.error}>{error?.message}</div>;
  }

  return (
    <div className={styles.container}>
      {contextHolder}
      <OrderHeader
        orderId={order.orderId}
        yearMonth={order.orderYearMonth}
        version={order.version}
        onBack={handleBack}
      />
      <InstructionInfo
        yearMonth={order.orderYearMonth}
        baseName={order.baseName}
      />
      <InstructionTable
        instructions={order.instructions}
        onAccept={handleAccept}
        onReject={handleReject}
      />
      <ActionButtons
        status={order.status}
        onAccept={handleAccept}
        onReject={handleReject}
        onDownload={handleDownload}
        onOpenMessage={() => setMessageDrawerOpen(true)}
      />
      <PaymentInfo paymentInfo={order.paymentInfo} />
      <MessageDrawer
        open={messageDrawerOpen}
        onClose={() => setMessageDrawerOpen(false)}
        orderId={orderId!}
      />
    </div>
  );
};
```

---

## 7. åç«¯æœåŠ¡è®¾è®¡

### 7.1 Controller

```java
@RestController
@RequestMapping("/api/v1/partners/orders")
@RequiredArgsConstructor
public class PartnerOrderController {

    private final PartnerOrderService partnerOrderService;

    @GetMapping("/{orderId}")
    public ResponseEntity<GetOrderDetailResponse> getOrderDetail(
            @PathVariable String orderId,
            @AuthenticationPrincipal User user) {
        GetOrderDetailResponse response = partnerOrderService.getOrderDetail(
            orderId, user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @GetMapping("/{orderId}/instructions")
    public ResponseEntity<GetInstructionsResponse> getInstructions(
            @PathVariable String orderId,
            @RequestParam(required = false) String version,
            @AuthenticationPrincipal User user) {
        GetInstructionsResponse response = partnerOrderService.getInstructions(
            orderId, version, user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @PostMapping("/{orderId}/accept")
    public ResponseEntity<AcceptOrderResponse> acceptOrder(
            @PathVariable String orderId,
            @RequestBody AcceptOrderRequest request,
            @AuthenticationPrincipal User user) {
        AcceptOrderResponse response = partnerOrderService.acceptOrder(
            orderId, request, user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @PostMapping("/{orderId}/reject")
    public ResponseEntity<RejectOrderResponse> rejectOrder(
            @PathVariable String orderId,
            @RequestBody RejectOrderRequest request,
            @AuthenticationPrincipal User user) {
        RejectOrderResponse response = partnerOrderService.rejectOrder(
            orderId, request.getReason(), user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @GetMapping("/{orderId}/pdf")
    public ResponseEntity<Resource> downloadPdf(
            @PathVariable String orderId,
            @RequestParam(required = false) String version,
            @AuthenticationPrincipal User user) {
        Resource resource = partnerOrderService.generatePdf(
            orderId, version, user.getPartnerId());
        return ResponseEntity.ok(resource)
            .contentType(MediaType.APPLICATION_PDF)
            .header(HttpHeaders.CONTENT_DISPOSITION,
                "attachment; filename=\"order-" + orderId + ".pdf\"")
            .body(resource);
    }

    @GetMapping("/{orderId}/messages")
    public ResponseEntity<GetMessagesResponse> getMessages(
            @PathVariable String orderId,
            @RequestParam String baseId,
            @AuthenticationPrincipal User user) {
        GetMessagesResponse response = partnerOrderService.getMessages(
            orderId, baseId, user.getPartnerId());
        return ResponseEntity.ok(response);
    }

    @PostMapping("/{orderId}/messages")
    public ResponseEntity<SendMessageResponse> sendMessage(
            @PathVariable String orderId,
            @RequestBody SendMessageRequest request,
            @AuthenticationPrincipal User user) {
        SendMessageResponse response = partnerOrderService.sendMessage(
            orderId, request, user.getPartnerId());
        return ResponseEntity.ok(response);
    }
}
```

### 7.2 Service

```java
@Service
@RequiredArgsConstructor
public class PartnerOrderService {

    private final OrderRepository orderRepository;
    private final InstructionRepository instructionRepository;
    private final OrderActionRepository orderActionRepository;
    private final MessageRepository messageRepository;

    @Transactional(readOnly = true)
    public GetOrderDetailResponse getOrderDetail(String orderId, String partnerId) {
        Order order = orderRepository.findById(orderId)
            .orElseThrow(() -> new OrderNotFoundException(orderId));

        if (!order.getPartnerId().equals(partnerId)) {
            throw new PermissionDeniedException();
        }

        List<Instruction> instructions = instructionRepository
            .findByOrderIdAndVersion(orderId, order.getCurrentVersion());

        return GetOrderDetailResponse.builder()
            .success(true)
            .data(OrderDetailDTO.from(order, instructions))
            .build();
    }

    @Transactional
    public AcceptOrderResponse acceptOrder(
            String orderId, AcceptOrderRequest request, String partnerId) {
        Order order = orderRepository.findById(orderId)
            .orElseThrow(() -> new OrderNotFoundException(orderId));

        validateOrderForAction(order, partnerId);

        List<Instruction> instructions;
        if (request.getInstructionIds() == null || request.getInstructionIds().isEmpty()) {
            instructions = instructionRepository.findByOrderId(orderId);
        } else {
            instructions = instructionRepository.findByIdIn(request.getInstructionIds());
        }

        instructions.forEach(instruction -> {
            instruction.setStatus(InstructionStatus.ACCEPTED);
            instructionRepository.save(instruction);
        });

        updateOrderStatus(order);

        OrderAction action = OrderAction.builder()
            .orderId(orderId)
            .actionType(ActionType.ACCEPTED)
            .performedBy(partnerId)
            .memo(request.getMemo())
            .build();
        orderActionRepository.save(action);

        return AcceptOrderResponse.builder()
            .success(true)
            .message("æŒ‡ç¤ºæ›¸ã‚’æ‰¿è«¾ã—ã¾ã—ãŸ")
            .data(AcceptOrderResultDTO.builder()
                .orderId(orderId)
                .status(order.getStatus())
                .acceptedCount(instructions.size())
                .acceptedAt(LocalDateTime.now().toString())
                .build())
            .build();
    }

    private void validateOrderForAction(Order order, String partnerId) {
        if (!order.getPartnerId().equals(partnerId)) {
            throw new PermissionDeniedException();
        }

        if (order.getStatus() != OrderStatus.PENDING &&
            order.getStatus() != OrderStatus.PARTIALLY_ACCEPTED) {
            throw new OrderAlreadyProcessedException(order.getStatus().name());
        }

        if (order.getDeadline() != null &&
            order.getDeadline().isBefore(LocalDateTime.now())) {
            throw new OrderExpiredException();
        }
    }

    private void updateOrderStatus(Order order) {
        long totalInstructions = instructionRepository.countByOrderId(order.getOrderId());
        long acceptedInstructions = instructionRepository
            .countByOrderIdAndStatus(order.getOrderId(), InstructionStatus.ACCEPTED);

        if (acceptedInstructions == 0) {
            order.setStatus(OrderStatus.PENDING);
        } else if (acceptedInstructions == totalInstructions) {
            order.setStatus(OrderStatus.ACCEPTED);
        } else {
            order.setStatus(OrderStatus.PARTIALLY_ACCEPTED);
        }
        orderRepository.save(order);
    }
}
```

---

## 8. æ•°æ®åº“è¡¨è®¾è®¡

### 8.1 orders è¡¨ï¼ˆæ‰©å±•å­—æ®µï¼‰

```sql
ALTER TABLE orders ADD COLUMN current_version VARCHAR(10) NOT NULL DEFAULT 'V1';
ALTER TABLE orders ADD COLUMN deadline DATETIME;
ALTER TABLE orders ADD COLUMN base_contact_name VARCHAR(200);
ALTER TABLE ADD COLUMN base_contact_tel VARCHAR(20);
ALTER TABLE orders ADD COLUMN base_contact_fax VARCHAR(20);
```

### 8.2 instructions è¡¨

```sql
CREATE TABLE instructions (
    instruction_id VARCHAR(50) PRIMARY KEY,
    order_id VARCHAR(50) NOT NULL,
    version VARCHAR(10) NOT NULL,
    line_number VARCHAR(10),
    am_pm VARCHAR(10),
    departure VARCHAR(100),
    arrival VARCHAR(100),
    system VARCHAR(50),
    line_name VARCHAR(200),
    warehouse VARCHAR(200),
    warehouse_time VARCHAR(10),
    vehicle_tonnage DECIMAL(5,2),
    schedule_mon VARCHAR(5),
    schedule_tue VARCHAR(5),
    schedule_wed VARCHAR(5),
    schedule_thu VARCHAR(5),
    schedule_fri VARCHAR(5),
    schedule_sat VARCHAR(5),
    schedule_sun VARCHAR(5),
    status ENUM('PENDING', 'ACCEPTED') NOT NULL DEFAULT 'PENDING',
    has_changes BOOLEAN DEFAULT FALSE,
    change_reason VARCHAR(500),
    changed_to VARCHAR(500),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(order_id),
    INDEX idx_instructions_order (order_id),
    INDEX idx_instructions_version (order_id, version),
    INDEX idx_instructions_status (status)
);
```

### 8.3 messages è¡¨

```sql
CREATE TABLE messages (
    message_id VARCHAR(50) PRIMARY KEY,
    order_id VARCHAR(50) NOT NULL,
    sender_type ENUM('PARTNER', 'BASE') NOT NULL,
    sender_id VARCHAR(50) NOT NULL,
    sender_name VARCHAR(200) NOT NULL,
    base_id VARCHAR(50),
    content TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(order_id),
    INDEX idx_messages_order (order_id),
    INDEX idx_messages_base (order_id, base_id)
);
```

### 8.4 message_attachments è¡¨

```sql
CREATE TABLE message_attachments (
    attachment_id VARCHAR(50) PRIMARY KEY,
    message_id VARCHAR(50) NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    file_size BIGINT NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    uploaded_by VARCHAR(50) NOT NULL,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (message_id) REFERENCES messages(message_id),
    INDEX idx_attachments_message (message_id)
);
```

### 8.5 order_actions è¡¨

```sql
CREATE TABLE order_actions (
    action_id VARCHAR(50) PRIMARY KEY,
    order_id VARCHAR(50) NOT NULL,
    action_type ENUM('ACCEPT', 'REJECT', 'CHANGE', 'MESSAGE') NOT NULL,
    performed_by VARCHAR(50) NOT NULL,
    performed_role ENUM('PARTNER', 'BASE') NOT NULL,
    instruction_ids TEXT[],
    memo TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(order_id),
    INDEX idx_actions_order (order_id),
    INDEX idx_actions_performed_by (performed_by)
);
```

---

## 9. ç”»é¢-API-æ•°æ®åº“å…³ç³»æ˜ å°„è¡¨

### 9.1 å…³ç³»æ€»è§ˆè¡¨

| ç”»é¢å…ƒç´  | APIæ¥å£ | æ¥å£åŠŸèƒ½è¯´æ˜ | ç›¸å…³æ•°æ®åº“è¡¨ | å­—æ®µå…³ç³» |
|----------|---------|--------------|--------------|----------|
| å¹´æœˆè¡¨ç¤º | GET /api/v1/partners/orders/{orderId} | ä¾é ¼æƒ…å ±ã®å¹´æœˆ | m_orders | order_date â†’ orderYearMonth |
| å¯¾è±¡ãƒ™ãƒ¼ã‚¹è¡¨ç¤º | GET /api/v1/partners/orders/{orderId} | ä¾é ¼æƒ…å ±ã®ãƒ™ãƒ¼ã‚¹ | m_orders | base_name â†’ baseName |
| versioné¸æŠ | GET /api/v1/partners/orders/{orderId}/instructions | æŒ‡ç¤ºæ›¸version | m_instructions | version |
| æœˆé–“é‹è¡ŒæŒ‡ç¤ºæ›¸ | GET /api/v1/partners/orders/{orderId}/instructions | æŒ‡ç¤ºæ›¸ä¸€è¦§ | m_instructions | å­—æ®µç›´æ¥æ˜ å°„ |
| ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ | GET /api/v1/partners/orders/{orderId}/instructions | é¸æŠçŠ¶æ…‹ | m_instructions | instruction_id â†’ selection |
| ç·šä¾¿ã€œä½¿ç”¨è»Šä¸¡ | GET /api/v1/partners/orders/{orderId}/instructions | æŒ‡ç¤ºæ›¸é …ç›® | m_instructions | å­—æ®µç›´æ¥æ˜ å°„ |
| ç«ã€œæ—¥ schedule | GET /api/v1/partners/orders/{orderId}/instructions | ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« | m_instructions | schedule_* â†’ schedule |
| æ‰¿è«¾æ¸ˆã¿ status | GET /api/v1/partners/orders/{orderId}/instructions | æ‰¿è«¾çŠ¶æ…‹ | m_instructions | status â†’ 'ACCEPTED' |
| ã™ã¹ã¦æ‰¿è«¾ | POST /api/v1/partners/orders/{orderId}/accept | å…¨éƒ¨æ‰¿è«¾ | m_instructions | status â† 'ACCEPTED' |
| ãƒã‚§ãƒƒã‚¯ã—ãŸæŒ‡ç¤ºã‚’æ‰¿è«¾ | POST /api/v1/partners/orders/{orderId}/accept | éƒ¨åˆ†æ‰¿è«¾ | m_instructions | instruction_ids, status â† 'ACCEPTED' |
| ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ | GET /api/v1/partners/orders/{orderId}/pdf | PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ | PDFç”Ÿæˆ | ãªã— |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | GET /api/v1/partners/orders/{orderId}/messages | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾— | m_messages | å­—æ®µç›´æ¥æ˜ å°„ |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ | POST /api/v1/partners/orders/{orderId}/messages | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ | m_messages | content â†’ messages |
| ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ | POST /api/v1/partners/orders/{orderId}/attachments | ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜ | m_message_attachments | file â†’ attachments |
| æ”¯æ‰•ä»£é‡‘ | GET /api/v1/partners/orders/{orderId} | æ”¯æ‰•æƒ…å ± | m_orders | payment_amount â†’ paymentInfo |
| å±¥æ­´ç®¡ç† | GET /api/v1/partners/orders/{orderId}/history | æ“ä½œå±¥æ­´ | m_order_actions | å­—æ®µç›´æ¥æ˜ å°„ |

### 9.2 å…³ç³»è¯´æ˜

**é¡µé¢åŠ è½½æµç¨‹**ï¼š
1. ç”¨æˆ·ä»p2é¡µé¢ç‚¹å‡»æŒ‡ç¤ºä¹¦è¿›å…¥p3é¡µé¢
2. URLå‚æ•°è§£æè·å– orderId
3. è°ƒç”¨è®¢å•è¯¦æƒ…APIè·å–åŸºæœ¬ä¿¡æ¯
4. è°ƒç”¨æŒ‡ç¤ºä¹¦åˆ—è¡¨APIè·å–è¯¦ç»†æ•°æ®
5. æ¸²æŸ“é¡µé¢å„åŒºåŸŸï¼ˆä¾é ¼æƒ…å ±ã€æŒ‡ç¤ºæ›¸è¡¨æ ¼ã€æ”¯æ‰•æƒ…å ±ï¼‰
6. æ ¹æ®çŠ¶æ€æ˜¾ç¤º/éšè—æ“ä½œæŒ‰é’®

**æ‰¿è¯ºæ“ä½œæµç¨‹**ï¼š
1. ç”¨æˆ·ç‚¹å‡»ã€Œã™ã¹ã¦æ‰¿è«¾ã€æˆ–é€‰æ‹©åç‚¹å‡»ã€Œãƒã‚§ãƒƒã‚¯ã—ãŸæŒ‡ç¤ºã‚’æ‰¿è«¾ã€
2. å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
3. ç”¨æˆ·ç¡®è®¤åè°ƒç”¨ accept API
4. åç«¯æ›´æ–° m_instructions.status = 'ACCEPTED'
5. æ›´æ–° m_orders.status
6. è®°å½• m_order_actions
7. å‰ç«¯åˆ·æ–°é¡µé¢æ•°æ®

**ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ“ä½œæµç¨‹**ï¼š
1. ç”¨æˆ·ç‚¹å‡»ã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€æŒ‰é’®
2. å³ä¾§Drawerå±•å¼€æ˜¾ç¤ºæ¶ˆæ¯é¢æ¿
3. é€‰æ‹©ãƒ™ãƒ¼ã‚¹ååŠ è½½å¯¹åº”æ¶ˆæ¯
4. è¾“å…¥å†…å®¹åå¯é™„åŠ æ–‡ä»¶
5. ç‚¹å‡»å‘é€è°ƒç”¨æ¶ˆæ¯API
6. æ¶ˆæ¯åˆ—è¡¨å®æ—¶æ›´æ–°

**æ•°æ®è¡¨å…³ç³»ï¼ˆERå›¾ï¼‰**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       m_orders                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: order_id                                                â”‚
â”‚ FK: partner_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º m_partner_companies   â”‚
â”‚ FK: base_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º m_bases                 â”‚
â”‚    order_date                                               â”‚
â”‚    current_version                                           â”‚
â”‚    status                                                  â”‚
â”‚    deadline                                                â”‚
â”‚    base_contact_name                                        â”‚
â”‚    base_contact_tel                                         â”‚
â”‚    base_contact_fax                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 1:N
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     m_instructions                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: instruction_id                                          â”‚
â”‚ FK: order_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º m_orders               â”‚
â”‚    version                                                 â”‚
â”‚    line_number                                             â”‚
â”‚    am_pm, departure, arrival                                â”‚
â”‚    system, line_name                                        â”‚
â”‚    warehouse, warehouse_time                                â”‚
â”‚    vehicle_tonnage                                        â”‚
â”‚    schedule_mon~schedule_sun                               â”‚
â”‚    status                                                  â”‚
â”‚    has_changes, change_reason, changed_to                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 1:N
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      m_messages                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: message_id                                               â”‚
â”‚ FK: order_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º m_orders               â”‚
â”‚ FK: base_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º m_bases                 â”‚
â”‚    sender_type, sender_id, sender_name                       â”‚
â”‚    content                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 1:N
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                m_message_attachments                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: attachment_id                                            â”‚
â”‚ FK: message_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º m_messages               â”‚
â”‚    file_name, file_size, file_path                          â”‚
â”‚    uploaded_by, uploaded_at                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 1:N
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   m_order_actions                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: action_id                                               â”‚
â”‚ FK: order_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º m_orders               â”‚
â”‚    action_type, performed_by, performed_role                  â”‚
â”‚    instruction_ids[], memo                                  â”‚
â”‚    created_at                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 æ•°æ®æµå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ç”¨æˆ·æ“ä½œå±‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚æŒ‡ç¤ºæ›¸é–²è¦§ â”‚    â”‚ checkbox â”‚    â”‚æ‰¿è«¾ï¾ï¾ï¾€ï¾  â”‚    â”‚ï¾’ï½¯ï½¾ï½°ï½¼ï¾ï¾ï¾ï¾€ï¾ â”‚              â”‚
â”‚  â”‚  Table  â”‚    â”‚ Select   â”‚    â”‚ Button   â”‚    â”‚ Button   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚              â”‚              â”‚
        â”‚ GET          â”‚ POST         â”‚ POST         â”‚ GET/POST
        â–¼              â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           React Frontend                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      OrderDetailPage.tsx                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚Instruction   â”‚  â”‚Instruction   â”‚  â”‚  MessageDrawer              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  Info       â”‚  â”‚  Table       â”‚  â”‚  (ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é¢æ¿)            â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚              â”‚              â”‚
        â”‚ GET          â”‚ POST         â”‚ POST         â”‚ GET/POST
        â–¼              â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         REST API Layer                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  GET /api/v1/partners/orders/{orderId}                                â”‚   â”‚
â”‚  â”‚  GET /api/v1/partners/orders/{orderId}/instructions                   â”‚   â”‚
â”‚  â”‚  POST /api/v1/partners/orders/{orderId}/accept                        â”‚   â”‚
â”‚  â”‚  POST /api/v1/partners/orders/{orderId}/reject                        â”‚   â”‚
â”‚  â”‚  GET /api/v1/partners/orders/{orderId}/pdf                            â”‚   â”‚
â”‚  â”‚  GET /api/v1/partners/orders/{orderId}/messages                       â”‚   â”‚
â”‚  â”‚  POST /api/v1/partners/orders/{orderId}/messages                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚              â”‚              â”‚
        â”‚ SQL SELECT   â”‚ SQL UPDATE  â”‚ SQL INSERT   â”‚ SQL SELECT/INSERT
        â–¼              â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Database Layer (PostgreSQL)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       m_orders                           â”‚  â”‚       m_instructions      â”‚  â”‚
â”‚  â”‚       (æ³¨æ–‡ãƒ†ãƒ¼ãƒ–ãƒ«)                     â”‚  â”‚       (æŒ‡ç¤ºæ›¸ãƒ†ãƒ¼ãƒ–ãƒ«)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â–²                                      â”‚                            â”‚
â”‚         â”‚ FK                                   â”‚ FK                          â”‚
â”‚         â”‚                                      â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       m_messages                         â”‚  â”‚  m_message_attachments   â”‚  â”‚
â”‚  â”‚       (ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«)               â”‚  â”‚  (é™„ä»¶ãƒ†ãƒ¼ãƒ–ãƒ«)          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚                            â”‚
â”‚                                              â”‚ FK                          â”‚
â”‚                                              â–¼                            â”‚
â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚                                    â”‚      m_order_actions       â”‚          â”‚
â”‚                                    â”‚      (æ“ä½œå±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«)    â”‚          â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.4 æ ¸å¿ƒæ•°æ®åº“è¡¨ç»“æ„

**m_ordersï¼ˆè®¢å•è¡¨ï¼‰**

| å­—æ®µå | æ•°æ®ç±»å‹ | çº¦æŸ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|----------|------|--------|------|
| order_id | VARCHAR(50) | PK, NOT NULL | - | æ³¨æ–‡ID |
| order_date | VARCHAR(7) | NOT NULL | - | ç™ºæ³¨å¹´æœˆï¼ˆYYYY-MMï¼‰ |
| partner_id | VARCHAR(50) | FK â†’ m_partner_companies, NOT NULL | - | ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ID |
| base_id | VARCHAR(50) | FK â†’ m_bases, NOT NULL | - | ãƒ™ãƒ¼ã‚¹ID |
| current_version | VARCHAR(10) | NOT NULL | 'V1' | ç¾åœ¨ã®version |
| status | ENUM | NOT NULL | 'PENDING' | æ³¨æ–‡çŠ¶æ…‹ |
| deadline | TIMESTAMP | NULL | - | ç· åˆ‡ |
| base_contact_name | VARCHAR(200) | NULL | - | ãƒ™ãƒ¼ã‚¹é€£çµ¡å…ˆå |
| base_contact_tel | VARCHAR(20) | NULL | - | ãƒ™ãƒ¼ã‚¹é›»è©±ç•ªå· |
| base_contact_fax | VARCHAR(20) | NULL | - | ãƒ™ãƒ¼ã‚¹FAXç•ªå· |
| payment_amount | VARCHAR(500) | NULL | - | æ”¯æ‰•ä»£é‡‘ |
| payment_method | VARCHAR(500) | NULL | - | æ”¯æ‰•æ–¹æ³• |
| payment_deadline | VARCHAR(500) | NULL | - | æ”¯æ‰•ã„æœŸé™ |
| consumption_tax | VARCHAR(500) | NULL | - | æ¶ˆè²»ç¨ |
| transfer_fee | VARCHAR(500) | NULL | - | æŒ¯è¾¼æ‰‹æ•°æ–™ |

**m_instructionsï¼ˆæŒ‡ç¤ºæ›¸ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|--------------|----------|------|------------|------|
| instruction_id | VARCHAR(50) | PK, NOT NULL | - | æŒ‡ç¤ºæ›¸ID |
| order_id | VARCHAR(50) | FK â†’ m_orders, NOT NULL | - | æ³¨æ–‡ID |
| version | VARCHAR(10) | NOT NULL | - | version |
| line_number | VARCHAR(10) | NULL | - | ç·šä¾¿ |
| am_pm | VARCHAR(10) | NULL | - | AM/PM |
| departure | VARCHAR(100) | NULL | - | ç™º |
| arrival | VARCHAR(100) | NULL | - | ç€ |
| system | VARCHAR(50) | NULL | - | ç³»çµ± |
| line_name | VARCHAR(200) | NULL | - | ç·šä¾¿å |
| warehouse | VARCHAR(200) | NULL | - | å…¥åº«å ´æ‰€ |
| warehouse_time | VARCHAR(10) | NULL | - | å…¥åº«æ™‚é–“ |
| vehicle_tonnage | DECIMAL(5,2) | NULL | - | ä½¿ç”¨è»Šä¸¡(ãƒˆãƒ³) |
| schedule_mon | VARCHAR(5) | NULL | - | æœˆæ›œå‹¤å‹™ |
| schedule_tue | VARCHAR(5) | NULL | - | ç«æ›œå‹¤å‹™ |
| schedule_wed | VARCHAR(5) | NULL | - | æ°´æ›œå‹¤å‹™ |
| schedule_thu | VARCHAR(5) | NULL | - | æœ¨æ›œå‹¤å‹™ |
| schedule_fri | VARCHAR(5) | NULL | - | é‡‘æ›œå‹¤å‹™ |
| schedule_sat | VARCHAR(5) | NULL | - | åœŸæ›œå‹¤å‹™ |
| schedule_sun | VARCHAR(5) | NULL | - | æ—¥æ›œå‹¤å‹™ |
| status | ENUM('PENDING','ACCEPTED') | NOT NULL | 'PENDING' | çŠ¶æ…‹ |
| has_changes | BOOLEAN | NULL | FALSE | å¤‰æ›´æœ‰ç„¡ |
| change_reason | VARCHAR(500) | NULL | - | å¤‰æ›´äº‹ç”± |
| changed_to | VARCHAR(500) | NULL | - | å¤‰æ›´å¾Œå†…å®¹ |

**m_messagesï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰**

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|--------------|----------|------|------------|------|
| message_id | VARCHAR(50) | PK, NOT NULL | - | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ID |
| order_id | VARCHAR(50) | FK â†’ m_orders, NOT NULL | - | æ³¨æ–‡ID |
| sender_type | ENUM('PARTNER','BASE') | NOT NULL | - | é€ä¿¡è€…ã‚¿ã‚¤ãƒ— |
| sender_id | VARCHAR(50) | NOT NULL | - | é€ä¿¡è€…ID |
| sender_name | VARCHAR(200) | NOT NULL | - | é€ä¿¡è€…å |
| base_id | VARCHAR(50) | FK â†’ m_bases, NULL | - | ãƒ™ãƒ¼ã‚¹ID |
| content | TEXT | NOT NULL | - | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ |
| created_at | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP | ä½œæˆæ—¥æ™‚ |

**å…³è”å…³ç³»è¯´æ˜**ï¼š
- `m_instructions` ã¨ `m_orders` ã¯ N:1 é–¢ä¿‚ï¼ˆ1ã¤ã®æ³¨æ–‡ã«è¤‡æ•°ã®æŒ‡ç¤ºæ›¸ï¼‰
- `m_messages` ã¨ `m_orders` ã¯ N:1 é–¢ä¿‚ï¼ˆ1ã¤ã®æ³¨æ–‡ã«è¤‡æ•°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰
- `m_message_attachments` ã¨ `m_messages` ã¯ N:1 é–¢ä¿‚ï¼ˆ1ã¤ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«è¤‡æ•°ã®æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- `m_order_actions` ã¨ `m_orders` ã¯ N:1 é–¢ä¿‚ï¼ˆ1ã¤ã®æ³¨æ–‡ã«è¤‡æ•°ã®æ“ä½œå±¥æ­´ï¼‰

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–**ï¼š
- idx_instructions_order: order_idæ¤œç´¢ç”¨
- idx_instructions_version: versionãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ç”¨
- idx_instructions_status: çŠ¶æ…‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ç”¨
- idx_messages_order: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¤œç´¢ç”¨
- idx_messages_base: ãƒ™ãƒ¼ã‚¹åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—ç”¨
- idx_actions_order: æ“ä½œå±¥æ­´æ¤œç´¢ç”¨

---

## 10. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 10.1 å‰ç«¯ä¼˜åŒ–

```typescript
// ä½¿ç”¨React Queryè¿›è¡Œæ•°æ®ç¼“å­˜å’Œé¢„è·å–
const { data: order } = useQuery({
  queryKey: ['order', orderId],
  queryFn: () => getOrderDetail(orderId),
  staleTime: 5 * 60 * 1000,
});

// è·¯ç”±é¢„åŠ è½½
const router = createBrowserRouter([
  {
    path: '/p3/:orderId',
    element: <OrderDetailPage />,
    loader: async ({ params }) => {
      preLoadOrderData(params.orderId);
      return null;
    },
  },
]);
```

### 10.2 åç«¯ä¼˜åŒ–

```java
@Configuration
@EnableCaching
public class CacheConfig {
    @Bean
    public CacheManager cacheManager() {
        return new RedisCacheManager(redisCacheConfiguration());
    }
}

@Service
public class PartnerOrderService {
    @Cacheable(value = "orderDetails", key = "#orderId")
    public OrderDetailDTO getOrderDetail(String orderId, String partnerId) {
        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŸ¥è¯¢
    }
}
```

---

## 11. éªŒæ”¶æ ‡å‡†

### 11.1 åŠŸèƒ½éªŒæ”¶

| æµ‹è¯•åœºæ™¯ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ |
|----------|----------|--------|
| é¡µé¢åˆå§‹åŠ è½½ | æ­£ç¡®æ˜¾ç¤ºæŒ‡ç¤ºä¹¦æ‰€æœ‰ä¿¡æ¯ | P0 |
| versioné¸æŠ | åˆ‡æ¢ç‰ˆæœ¬åæ­£ç¡®æ˜¾ç¤º | P0 |
| æ‰¿è¯ºå…¨éƒ¨ | ç¡®è®¤åæ‰€æœ‰é¡¹ç›®å˜ä¸ºæ‰¿è«¾æ¸ˆ | P0 |
| éƒ¨åˆ†æ‰¿è¯º | é€‰æ‹©åä»…æ‰€é€‰é¡¹ç›®æ‰¿è¯º | P0 |
| æ—¥å†åˆ‡æ¢ | ç‚¹å‡»æ—¥æœŸæ­£ç¡®åˆ‡æ¢ã€‡/ç©ºæ  | P0 |
| ä¸‹è½½PDF | æ­£ç¡®ä¸‹è½½PDFæ–‡ä»¶ | P0 |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡ | æ­£ç¡®å‘é€å’Œæ˜¾ç¤ºæ¶ˆæ¯ | P1 |
| é™„ä»¶ä¸Šä¼ ä¸‹è½½ | æ­£ç¡®å¤„ç†æ–‡ä»¶ | P1 |
| æ“ä½œå±¥æ­´ | æ­£ç¡®æ˜¾ç¤ºæ“ä½œè®°å½• | P1 |

### 11.2 æ€§èƒ½éªŒæ”¶

| æŒ‡æ ‡ | è¦æ±‚ | æµ‹è¯•æ–¹æ³• |
|------|------|----------|
| é¡µé¢åŠ è½½æ—¶é—´ | < 3ç§’ | Lighthouse |
| APIå“åº”æ—¶é—´ | < 500ms | APIãƒ†ã‚¹ãƒˆ |
| è¡¨æ ¼æ¸²æŸ“ | < 500ms | DevTools |
| PDFç”Ÿæˆ | < 2ç§’ | APIç›‘æ§ |

### 11.3 å®‰å…¨éªŒæ”¶

| æ£€æŸ¥é¡¹ | è¦æ±‚ |
|--------|------|
| æ¨©é™æ£€æŸ¥ | éå½’å±ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼æ— æ³•æŸ¥çœ‹ |
| CSRFä¿æŠ¤ | æ‰€æœ‰POSTè¯·æ±‚å¸¦CSRF Token |
| å…¥åŠ›éªŒè¯ | åç«¯éªŒè¯æ‰€æœ‰å…¥åŠ› |
| æ–‡ä»¶éªŒè¯ | ä¸Šä¼ æ–‡ä»¶ç±»å‹å’Œå¤§å°æ£€æŸ¥ |

---

## 12. å˜æ›´æ—¥å¿—

| æ—¥æœŸ | ç‰ˆæœ¬ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|---------|------|
| 2026-02-10 | v1.0.1 | æ·»åŠ 5.ç”»é¢-API-æ•°æ®åº“å…³ç³»æ˜ å°„è¡¨ï¼Œæ›´æ–°ç« èŠ‚é¡ºåº | - |
| 2026-02-05 | v1.0 | åˆå§‹ç‰ˆæœ¬ | - |

---

## é™„å½•

### A.1 ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ | [\_å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ.md](../_å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ.md) | å‰åç«¯æŠ€æœ¯æ¶æ„è¯¦ç»†è§„èŒƒ |
| b3-ç™ºæ³¨è©³ç´° | [../b3-ç™ºæ³¨è©³ç´°/05_è®¾è®¡è§„èŒƒ.md](../b3-ç™ºæ³¨è©³ç´°/05_è®¾è®¡è§„èŒƒ.md) | Baseä¾§æŒ‡ç¤ºä¹¦è¯¦æƒ…è®¾è®¡è§„èŒƒ |
| p2-ç™ºæ³¨æ¤œç´¢ | [../p2-ç™ºæ³¨æ¤œç´¢/05_è®¾è®¡è§„èŒƒ.md](../p2-ç™ºæ³¨æ¤œç´¢/05_è®¾è®¡è§„èŒƒ.md) | ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ä¾§æŒ‡ç¤ºä¹¦åˆ—è¡¨è®¾è®¡è§„èŒƒ |

### A.2 ä¸b3-ç™ºæ³¨è©³ç´°å¯¹æ¯”

| ç‰¹æ€§ | b3-ç™ºæ³¨è©³ç´° | p3-ç™ºæ³¨è©³ç´° |
|------|-------------|-------------|
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼å½¹å‰²** | ãƒ™ãƒ¼ã‚¹ï¼ˆæ€»éƒ¨ï¼‰ | ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ï¼ˆåˆä½œä¼™ä¼´ï¼‰ |
| **ä¸»ãªæ“ä½œ** | æŒ‡ç¤ºæ›¸ä½œæˆã€é€ä»˜ã€ä»£ç†æ‰¿è«¾ | æ‰¿è«¾ã€å´ä¸‹ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
| **versionç®¡ç†** | è¤‡æ•°versionä½œæˆ | versioné¸æŠã®ã¿ |
| **æŒ‡ç¤ºæ›¸ç·¨é›†** | è©³ç´°ç·¨é›†æ©Ÿèƒ½ | å¤‰æ›´ä¾é ¼ã®ã¿ |
| **APIå‰ç¼€** | /api/v1/orders | /api/v1/partners/orders |
| **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ©Ÿèƒ½** | å®Œæ•´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é¢æ¿ | ç®€åŒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ©Ÿèƒ½ |
| **æ”¯ä»˜æƒ…å ±** | ãªã— | ã‚ã‚Š |

---

**æ–‡æ¡£ç¼–åˆ¶**: -  
**ç¼–åˆ¶æ—¶é—´**: 2026-02-10  
**é€‚ç”¨èŒƒå›´**: p3-ç™ºæ³¨è©³ç´° åˆä½œä¼™ä¼´æœˆåº¦è¿è¡ŒæŒ‡ç¤ºä¹¦è¯¦æƒ…é¡µé¢  
**äº¤å‰å¼•ç”¨**: [\_å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ.md](../_å…¬å…±æŠ€æœ¯æ¶æ„è§„èŒƒ.md)
