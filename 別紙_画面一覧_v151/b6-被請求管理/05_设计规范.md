# b6-被請求管理 - 设计规范

## 1. 功能概述

### 1.1 文档信息
| 项目 | 内容 |
|------|------|
| **工作表名称** | b6-被請求管理 |
| **界面编号** | b6 |
| **文档版本** | v1.0 |
| **最后更新** | 2026-02-XX|
| **文档状态** | ✅ 已发布 |

### 1.2 功能描述
b6-被請求管理 是账单管理页面，提供被请求信息列表展示、账单下载和状态管理功能。

### 1.3 技术架构
本文档基于 **前后端分离架构**，详细技术规范请参考：

👉 **[\_公共技术架构规范.md](../_公共技术架构规范.md)**

| 层级 | 技术 |
|------|------|
| 前端 | React 18.x + TypeScript + Ant Design |
| 后端 | Spring Boot 3.x + Java 17 |

### 1.4 核心功能
- 被請求情報一覧表示
- 請求書ダウンロード
- ステータス管理
- 詳細ページ跳转

### 1.5 适用范围
- 前端开发人员（账单管理组件实现）
- 后端开发人员（账单API开发）
- 测试工程师（账单功能测试）

---

## 2. 页面元素

### 2.1 元素清单

| 序号 | 元素名称 | 元素类型 | 功能说明 | 交互触发 |
|------|----------|----------|----------|----------|
| ⑴ | 被請求年月 | プルダウン | 选择対象年月 | 选择触发 |
| ⑵ | 会社コード | 入力 | 会社コード | 文本输入 |
| ⑶ | 会社名 | 入力 | 会社名 | 文本输入 |
| ⑷ | ステータス | プルダウン | ステータス | 选择触发 |
| ⑸ | チェックボックス | Checkbox | 选择账单 | 批量操作 |
| ⑹ | 会社コード | リンク | 公司代码 | 点击→b7 |
| ⑺ | 会社名 | テキスト | 公司名称 | 显示 |
| ⑻ | ステータス | タグ | 請求状態 | 显示 |
| ⑼ | 金額チェック | タグ | OK/NG/- | 显示 |
| ⑽ | 実績合計金額 | テキスト | 金額 | 显示 |
| ⑾ | 請求書合計金額 | テキスト | 金額 | 显示 |
| ⑿ | 金額差分 | テキスト | 差分 | 显示 |
| ⒀ | ファイル名 | リンク | ファイル名 | プレビュー |
| ⒁ | プレビュー | リンク | 预览 | 点击→弹窗 |
| ⒂ | 請求書ダウンロード | ボタン | 下载账单 | 点击→下载 |

---

## 3. 交互流程

### 3.1 页面加载流程
| 步骤 | 行为 | 系统响应 |
|------|------|----------|
| 1 | 页面初始化 | 检查登录状态 |
| 2 | 获取账单数据 | 查询確定した実績 |
| 3 | 数据判断 | 有数据→显示列表；无数据→显示空提示 |

### 3.2 筛选流程
| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 输入筛选条件 | 被請求年月/コード/名前/ステータス |
| 2 | 执行筛选 | 查询数据库 |
| 3 | 显示结果 | 列表展示匹配数据 |

### 3.3 下载流程
| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 选中账单 | チェックボックス |
| 2 | 点击下载按钮 | 验证选中状态 |
| 3 | 生成文件 | 下载文件/打包ZIP |

### 3.4 状态变更流程
| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 选中账单 | チェックボックス |
| 2 | 点击状态变更 | 验证状态条件 |
| 3 | 更新状态 | 更新数据库 |
| 4 | 刷新列表 | 显示更新结果 |

---

## 4. 界面规范

### 4.1 页面布局
| 属性 | PC端值 | SP端值 | 说明 |
|------|--------|--------|------|
| **页面类型** | PC | 不支持 | ≪PC≫标识 |
| **布局方式** | 上部筛选+中部列表+下部操作 | - | 三段式布局 |

### 4.2 状态颜色
| 状态 | 颜色 | 说明 |
|------|------|------|
| 未提出 | 灰色 | 未上传 |
| 要確認 | 橙色 | 需确认 |
| チェック未 | 黄色 | 未检查 |
| チェック済 | 蓝色 | 已检查 |
| 請求完了 | 绿色 | 完成 |

### 4.3 金额检查颜色
| 状态 | 颜色 | 说明 |
|------|------|------|
| OK | 绿色 | 金额一致 |
| NG | 红色 | 金额不一致 |
| - | 灰色 | 无账单 |

---

## 5. API接口设计

### 5.1 账单查询API
```yaml
# 被请求列表查询
GET /api/v1/billing/search
Authorization: Bearer {token}

# Query Parameters
- year_month: string (YYYY-MM)
- company_code: string
- company_name: string
- status: string
- page: integer
- page_size: integer
```

### 5.2 下载API
```yaml
# 单个账单预览
GET /api/v1/billing/{billingId}/preview
Authorization: Bearer {token}

# 选中账单下载
POST /api/v1/billing/download
Authorization: Bearer {token}
Body: { billingIds: [...] }

# 批量下载
POST /api/v1/billing/download/all
Authorization: Bearer {token}
Body: { status: "チェック済" }
```

### 5.3 状态变更API
```yaml
# 选中账单状态变更
POST /api/v1/billing/status
Authorization: Bearer {token}
Body: { billingIds: [...], status: "請求完了" }

# 批量状态变更
POST /api/v1/billing/status/all
Authorization: Bearer {token}
Body: { status: "請求完了" }
```

---

## 6. 前端实现

### 6.1 账单列表组件
```typescript
// b6账单列表组件
import { Table, Button, Tag, Space } from 'antd';

export const B6BillingPage: React.FC = () => {
  const [selectedRowKeys, setSelectedRowKeys] = useState([]);

  const handleDownload = () => {
    // 下载选中账单
  };

  const handleStatusChange = () => {
    // 状态变更
  };

  return (
    <div className="b6-billing-container">
      <FilterSection />
      <Table
        rowSelection={{
          selectedRowKeys,
          onChange: setSelectedRowKeys,
        }}
        columns={columns}
        dataSource={billingList}
      />
      <ActionButtons
        onDownload={handleDownload}
        onStatusChange={handleStatusChange}
      />
    </div>
  );
};
```

---

## 7. 验收标准

### 7.1 功能验收
- [ ] 筛选条件可正常输入
- [ ] 列表正确显示账单数据
- [ ] 点击公司代码跳转到详情页
- [ ] プレビュー功能正常
- [ ] 下载功能正常
- [ ] 状态变更功能正常

### 7.2 视觉验收
- [ ] 布局与设计稿一致
- [ ] 列表字段顺序正确
- [ ] 状态颜色正确

### 7.3 性能验收
- [ ] 筛选响应时间 < 1秒
- [ ] 下载响应时间 < 3秒

---

## 8. 变更日志

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|---------|------|
| 2026-02-XX| v1.0 | 初始版本 | - |

---

## 附录

### A.1 相关文档
| 文档 | 路径 | 说明 |
|------|------|------|
| 公共技术架构规范 | [\_公共技术架构规范.md](../_公共技术架构规范.md) | 前后端技术架构详细规范 |
| b0-导航菜单 | [../b0-共通ナビゲーション/05_设计规范.md](../b0-共通ナビゲーション/05_设计规范.md) | 导航菜单设计规范 |

### A.2 与p6-被請求管理对比
| 特性 | b6-被請求管理 | p6-被請求管理 |
|------|---------------|---------------|
| **用户类型** | ベース | 輸送パートナー |
| **设备支持** | PCのみ | PC/SP |

---

**文档编制**: -  
**编制时间**: 2026-02-XX 
**适用范围**: 別紙_画面一覧_v151.xlsx - b6-被請求管理  
**交叉引用**: [\_公共技术架构规范.md](../_公共技术架构规范.md)
