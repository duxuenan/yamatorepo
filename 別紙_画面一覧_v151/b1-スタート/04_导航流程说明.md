# b1-スタート - 导航流程说明

## 1. 页面导航概述

### 1.1 页面定位
b1-スタート 是系统的**入口页面**，提供用户认证功能。

### 1.2 导航类型
| 导航类型 | 说明 |
|----------|------|
| **入口页面** | 系统URL直接访问 |
| **认证页面** | 提供AzureAD认证跳转 |

## 2. 入口分析

### 2.1 直接入口
| 入口方式 | 触发条件 | 目标页面 |
|----------|----------|----------|
| URL直接访问 | 用户输入系统URL | b1-スタート |

### 2.2 间接入口
| 入口方式 | 触发条件 | 目标页面 |
|----------|----------|----------|
| 页面刷新 | 保持当前页面 | 维持状态 |
| 登出完成 | 用户点击登出 | b1-スタート |
| 会话过期 | Token无效 | b1-スタート |

## 3. 出口分析

### 3.1 认证出口
| 目标页面 | 触发条件 | 出口类型 |
|----------|----------|----------|
| AzureAD登录页面 | 点击登录按钮 | **外部跳转** |
| 系统主页面 | 认证成功 | 内部跳转 |

### 3.2 出口决策流程
```
[当前页面：b1-スタート]
        │
        ▼
[检查登录状态]
    ┌───┴───┐
    │       │
  已登录   未登录
    │       │
    ▼       ▼
[跳转到主页面] [等待用户操作]
                    │
                    ▼
            [点击登录按钮]
                    │
                    ▼
            [跳转到AzureAD]
```

## 4. 导航流程图

### 4.1 主流程
```
┌─────────────────────────────────────┐
│          用户访问系统URL             │
└─────────────────┬───────────────────┘
                  ▼
┌─────────────────────────────────────┐
│           b1-スタート                │
│     （系统入口页面）                 │
└─────────────────┬───────────────────┘
                  │ 点击「ログインする」
                  ▼
┌─────────────────────────────────────┐
│         AzureAD登录页面              │
│        （外部认证系统）              │
└─────────────────┬───────────────────┘
                  │ 完成认证
                  ▼
┌─────────────────────────────────────┐
│           认证回调处理               │
│     （后端验证并创建会话）           │
└─────────────────┬───────────────────┘
                  │ 认证成功
                  ▼
┌─────────────────────────────────────┐
│           系统主页面                 │
│       （根据角色显示功能菜单）       │
└─────────────────────────────────────┘
```

### 4.2 异常流程
```
[跳转到AzureAD]
        │
        ▼
[认证失败/取消]
        │
        ▼
[返回b1-スタート]
        │
        ▼
[显示错误提示]
        │
        ▼
[用户可重试]
```

## 5. 导航状态管理

### 5.1 页面状态
| 状态 | 条件 | 导航行为 |
|------|------|----------|
| **初始状态** | 首次访问 | 检查登录状态 |
| **已登录状态** | Token有效 | 自动跳转主页面 |
| **未登录状态** | 无Token | 显示登录入口 |
| **登出状态** | 用户登出 | 清除会话返回 |

### 5.2 状态转换
```
┌─────────────┐    会话有效     ┌─────────────┐
│  b1-スタート │ ─────────────→ │  系统主页面  │
└─────────────┘                 └─────────────┘
      ▲                              │
      │           登出/过期           │
      └──────────────────────────────┘
```

## 6. 与其他页面的关系

### 6.1 导航树
```
                    [系统入口URL]
                           │
                           ▼
                 ┌─────────────────┐
                 │  b1-スタート    │ ← 入口页面
                 └────────┬────────┘
                          │
              ┌───────────┴───────────┐
              │                       │
              ▼                       ▼
    ┌─────────────────┐     ┌─────────────────┐
    │ AzureAD登录页面  │     │   系统主页面     │
    │ （外部系统）      │     │ （内部系统）     │
    └─────────────────┘     └─────────────────┘
```

### 6.2 关联页面
| 页面 | 关系类型 | 说明 |
|------|----------|------|
| b0-共通ナビゲーション | 后续页面 | 登录后显示导航菜单 |
| p1-スタート | 对应页面 | 輸送パートナー版本 |

## 7. 导航参数

### 7.1 URL参数
| 参数 | 类型 | 说明 |
|------|------|------|
| return_url | string | （可选）认证成功后跳转的目标URL |

### 7.2 回调参数
| 参数 | 类型 | 说明 |
|------|------|------|
| code | string | AzureAD返回的授权码 |
| state | string | 验证请求完整性的状态码 |
| session_state | string | AzureAD会话状态 |

## 8. 导航性能优化

### 8.1 优化策略
| 优化项 | 优化方式 | 预期效果 |
|--------|----------|----------|
| 预加载 | 预构建授权URL | 减少点击延迟 |
| 状态检查 | 并行检查会话 | 加快页面决策 |
| 平滑过渡 | 添加加载动画 | 提升用户体验 |

### 8.2 性能指标
| 场景 | 目标时间 | 说明 |
|------|----------|------|
| 页面加载 | < 1秒 | 到可交互状态 |
| 登录跳转 | < 0.5秒 | 点击到跳转完成 |
| 认证回调 | < 2秒 | 到主页面加载 |
