# b1-スタート - 设计规范

## 1. 功能概述

### 1.1 文档信息
| 项目 | 内容 |
|------|------|
| **工作表名称** | b1-スタート |
| **界面编号** | b1 |
| **文档版本** | v1.0 |
| **最后更新** | 2026-02-XX|
| **文档状态** | ✅ 已发布 |

### 1.2 功能描述
b1-スタート 是系统的起始页面，提供基于 AzureAD 的用户认证入口。

### 1.3 技术架构
本文档基于 **前后端分离架构**，详细技术规范请参考：

👉 **[\_公共技术架构规范.md](../_公共技术架构规范.md)**

| 层级 | 技术 |
|------|------|
| 前端 | React 18.x + TypeScript + Ant Design |
| 后端 | Spring Boot 3.x + Java 17 |
| 认证 | Azure Active Directory (OAuth 2.0 / OIDC) |

### 1.4 核心功能
- 提供系统访问入口
- AzureAD 登录认证跳转
- 会话状态管理

### 1.5 适用范围
- 前端开发人员（登录入口实现）
- 后端开发人员（认证API开发）
- 测试工程师（认证流程测试）

---

## 2. 页面元素

### 2.1 元素清单

| 序号 | 元素名称 | 元素类型 | 功能说明 | 交互触发 |
|------|----------|----------|----------|----------|
| ⑴ | AzureADのID／パスワードでログインする | 文本标签 | 登录方式说明 | - |
| ⑵ | ログインする | 按钮 | 触发AzureAD认证跳转 | 点击→跳转到AzureAD登录页面 |

### 2.2 元素详细说明

#### ⑴ AzureADのID／パスワードでログインする
| 项目 | 内容 |
|------|------|
| **元素类型** | 文本标签 |
| **功能描述** | 显示登录方式说明文本 |
| **内容** | AzureADのID／パスワードでログインする |

#### ⑵ ログインする
| 项目 | 内容 |
|------|------|
| **元素类型** | 按钮 |
| **功能描述** | 跳转到AzureAD登录页面进行认证 |
| **跳转目标** | AzureAD登录页面 |
| **前置条件** | 无 |
| **特殊处理** | 认证全部在AzureAD侧完成 |

---

## 3. 交互流程

### 3.1 页面加载流程
| 步骤 | 行为 | 系统响应 |
|------|------|----------|
| 1 | 用户访问系统URL | 加载b1-スタート页面 |
| 2 | 页面初始化 | 检查当前会话状态 |
| 3 | 会话检查结果 | 已登录→跳转主页面；未登录→显示登录入口 |

### 3.2 登录认证流程
| 步骤 | 用户操作 | 系统响应 | 说明 |
|------|----------|----------|------|
| 1 | 点击「ログインする」按钮 | 跳转到AzureAD登录页面 | OAuth 2.0 授权流程 |
| 2 | 在AzureAD页面输入凭证 | AzureAD进行身份验证 | 认证由AzureAD处理 |
| 3 | 认证成功 | AzureAD重定向回调 | 返回授权码 |
| 4 | 系统接收回调 | 交换授权码获取Token | 后端处理 |
| 5 | 登录成功 | 跳转到系统主页面 | 建立会话 |

### 3.3 会话状态处理
| 状态 | 条件 | 页面行为 |
|------|------|----------|
| **已登录** | 存在有效会话Token | 自动跳转到主页面 |
| **未登录** | 无有效会话Token | 显示登录入口 |
| **会话过期** | Token无效或过期 | 显示登录入口 |

---

## 4. 界面规范

### 4.1 页面布局
| 属性 | PC端值 | SP端值 | 说明 |
|------|--------|--------|------|
| **页面类型** | PC | 不支持 | ≪PC≫标识 |
| **布局方式** | 居中显示 | - | 简洁的登录入口布局 |
| **主要内容** | 登录按钮区域 | - | 突出显示认证入口 |

### 4.2 视觉规范

#### 按钮样式（b1特定）
| 状态 | 背景色 | 文字颜色 | 边框 |
|------|--------|----------|------|
| **默认** | #1890FF | #FFFFFF | 无 |
| **悬停** | #40A9FF | #FFFFFF | 无 |
| **点击** | #096DD9 | #FFFFFF | 无 |
| **禁用** | #D9D9D9 | #FFFFFF | 无 |

### 4.3 页面内容

#### 機能概要
- 本システムにURLよりアクセスしたとき、はじめに表示される画面
- 本画面からAzureAD側のログイン画面に遷移できる

#### 重要提示
- この画面から本システムにログインすることはできず、ログイン認証はすべてAzureAD側で行う

---

## 5. 认证集成

### 5.1 AzureAD认证配置

#### OAuth 2.0 流程
| 参数 | 值 |
|------|-----|
| **授权端点** | Azure AD 配置的授权URL |
| **令牌端点** | Azure AD 配置的令牌URL |
| **客户端ID** | Azure AD 注册的应用ID |
| **重定向URI** | 系统配置的回调URL |
| **作用域** | openid profile email |

### 5.2 认证状态管理

#### 会话处理
| 状态 | 处理方式 |
|------|----------|
| **登录成功** | 存储AccessToken和RefreshToken |
| **Token刷新** | 使用RefreshToken换取新Token |
| **登出** | 清除会话，跳转回b1-スタート |
| **会话超时** | 自动跳转登录页面 |

### 5.3 安全规范

#### Token管理
| 项目 | 规范 |
|------|------|
| **AccessToken** | 存储于内存，页面刷新不保持 |
| **RefreshToken** | 存储于HttpOnly Cookie |
| **Token有效期** | 根据AzureAD配置 |
| **HTTPS** | 全流程强制使用HTTPS |

---

## 6. 设备适配

### 6.1 PC端适配
| 特性 | 实现方式 | 说明 |
|------|----------|------|
| **完整功能** | 完全支持 | 提供完整登录入口 |
| **响应式布局** | 自适应 | 居中显示 |
| **浏览器兼容** | 现代浏览器 | Chrome/Edge/Firefox/Safari |

### 6.2 SP端适配
| 特性 | 实现方式 | 说明 |
|------|----------|------|
| **不支持** | 不渲染/隐藏 | ≪PC≫标识 |
| **替代方案** | 响应式设计 | 移动端浏览器访问PC版本 |

---

## 7. 数据库设计

### 7.1 会话表结构

详细数据库设计请参考：

👉 **[\_公共技术架构规范.md](../_公共技术架构规范.md#5-数据库设计规范)**

### 7.2 b1特定字段
```sql
-- b1会话表（如需要本地会话管理）
CREATE TABLE s_session (
    id BIGSERIAL PRIMARY KEY,
    session_id VARCHAR(100) NOT NULL UNIQUE,
    user_id VARCHAR(100) NOT NULL,
    access_token VARCHAR(2000),
    refresh_token VARCHAR(1000),
    expires_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## 8. API接口设计

### 8.1 认证API

详细API设计请参考：

👉 **[\_公共技术架构规范.md](../_公共技术架构规范.md#4-api接口规范)**

### 8.2 b1特定接口
```yaml
# AzureAD回调处理
POST /api/v1/auth/callback
Content-Type: application/x-www-form-urlencoded

# 登录状态检查
GET /api/v1/auth/status
Authorization: Bearer {token}

# 登出
POST /api/v1/auth/logout
Authorization: Bearer {token}
```

---

## 9. 前端实现

### 9.1 登录组件

详细前端架构请参考：

👉 **[\_公共技术架构规范.md](../_公共技术架构规范.md#2-前端架构规范)**

### 9.2 b1特定组件
```typescript
// b1登录入口组件
import React from 'react';
import { Button } from 'antd';
import { LoginOutlined } from '@ant-design/icons';

export const B1StartPage: React.FC = () => {
  // 登录按钮点击处理
  const handleLogin = () => {
    // 跳转到AzureAD授权页面
    window.location.href = `${azureAdConfig.authorizationEndpoint}?` +
      `client_id=${azureAdConfig.clientId}&` +
      `redirect_uri=${encodeURIComponent(azureAdConfig.redirectUri)}&` +
      `response_type=code&` +
      `scope=${encodeURIComponent(azureAdConfig.scopes)}&` +
      `state=${generateState()}`;
  };

  return (
    <div className="b1-start-container">
      <div className="login-section">
        <h2>システムにログイン</h2>
        <p>AzureADのID／パスワードでログインする</p>
        <Button
          type="primary"
          size="large"
          icon={<LoginOutlined />}
          onClick={handleLogin}
        >
          ログインする
        </Button>
      </div>
      <div className="notice">
        <p>この画面から本システムにログインすることはできず、</p>
        <p>ログイン認証はすべてAzureAD側で行います</p>
      </div>
    </div>
  );
};
```

---

## 10. 验收标准

### 10.1 功能验收
- [ ] 页面正确显示登录入口
- [ ] 点击登录按钮跳转到AzureAD
- [ ] AzureAD认证完成后正确回调
- [ ] 认证成功跳转到主页面
- [ ] 已登录用户不显示登录入口

### 10.2 视觉验收
- [ ] 布局与设计稿一致
- [ ] 按钮样式正确
- [ ] 提示文字正确显示

### 10.3 性能验收
- [ ] 页面加载时间 < 1秒
- [ ] 登录跳转响应时间 < 0.5秒
- [ ] 无白屏或闪烁

### 10.4 安全验收
- [ ] 全流程HTTPS
- [ ] Token安全存储
- [ ] 防止CSRF攻击
- [ ] 防止XSS攻击

---

## 11. 变更日志

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|---------|------|
| 2026-02-XX| v1.0 | 初始版本 | - |

---

## 附录

### A.1 相关文档
| 文档 | 路径 | 说明 |
|------|------|------|
| 公共技术架构规范 | [\_公共技术架构规范.md](../_公共技术架构规范.md) | 前后端技术架构详细规范 |
| b0-导航菜单 | [../b0-共通ナビゲーション/05_设计规范.md](../b0-共通ナビゲーション/05_设计规范.md) | 导航菜单设计规范 |
| 画面遷移図设计规范 | [../画面遷移図/05_设计规范.md](../画面遷移図/05_设计规范.md) | 导航流程设计规范 |

### A.2 与p1-スタート对比
| 特性 | b1-スタート | p1-スタート |
|------|-------------|-------------|
| **用户类型** | ベース | 輸送パートナー |
| **设备支持** | PCのみ | PC/SP |
| **认证方式** | AzureAD | AzureAD |

---

**文档编制**: -  
**编制时间**: 2026-02-XX 
**适用范围**: 別紙_画面一覧_v151.xlsx - b1-スタート  
**交叉引用**: [\_公共技术架构规范.md](../_公共技术架构规范.md)
