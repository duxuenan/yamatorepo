# b11-輸送パートナーマスタ検索 - 设计规范

## 1. 功能概述

### 1.1 文档信息
| 项目 | 内容 |
|------|------|
| **工作表名称** | b11-輸送パートナーマスタ検索 |
| **界面编号** | b11 |
| **文档版本** | v1.0.1 |
| **最后更新** | 2026-02-10|
| **文档状态** | ✅ 已发布 |

### 1.2 功能描述
b11-輸送パートナーマスタ検索 是合作伙伴主数据搜索页面，提供輸送パートナー情報の検索と一覧表示功能。

### 1.3 技术架构
本文档基于 **前后端分离架构**，详细技术规范请参考：

👉 **[\_公共技术架构规范.md](../_公共技术架构规范.md)**

| 层级 | 技术 |
|------|------|
| 前端 | React 18.x + TypeScript + Ant Design |
| 后端 | Spring Boot 3.x + Java 17 |

### 1.4 核心功能
- 輸送パートナー検索
- パートナー一覧表示
- 詳細画面跳转

### 1.5 适用范围
- 前端开发人员（搜索列表组件实现）
- 后端开发人员（パートナーAPI开发）
- 测试工程师（搜索功能测试）

---

## 2. 页面元素

### 2.1 元素清单

| 序号 | 元素名称 | 元素类型 | 功能说明 | 交互触发 |
|------|----------|----------|----------|----------|
| ⑴ | 会社コード | 入力 | 会社コード入力 | 文本输入 |
| ⑵ | 会社名 | 入力 | 会社名入力 | 文本输入 |
| ⑶ | 電話番号 | 入力 | 電話番号入力 | 文本输入 |
| ⑷ | システム利用 | ラジオボタン | 利用有無選択 | 选择触发 |
| ⑸ | 検索 | ボタン | 执行搜索 | 点击→执行查询 |
| ⑹ | 会社コード | テキスト | 公司代码 | 显示 |
| ⑺ | 会社名 | リンク | 公司名称 | 点击→b12-詳細 |
| ⑻ | 電話番号 | テキスト | 电话号码 | 显示 |
| ⑼ | システム利用 | テキスト | 利用状態 | 显示 |

---

## 3. 交互流程

### 3.1 页面加载流程
| 步骤 | 行为 | 系统响应 |
|------|------|----------|
| 1 | 页面初始化 | 检查登录状态 |
| 2 | 加载搜索条件 | 显示搜索表单 |
| 3 | 等待用户输入 | - |

### 3.2 搜索流程
| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 输入搜索条件 | 多条件输入 |
| 2 | 点击検索按钮 | 执行查询 |
| 3 | 显示结果 | 列表展示匹配数据 |

---

## 4. 界面规范

### 4.1 页面布局
| 属性 | PC端值 | SP端値 | 说明 |
|------|--------|--------|------|
| **页面类型** | PC | 不支持 | ≪PC≫标识 |
| **布局方式** | 上部搜索+下部列表 | - | 经典列表布局 |

### 4.2 列表字段顺序
| 顺序 | 字段 | 宽度 | 说明 |
|------|------|------|------|
| 1 | 会社コード | 固定 | 代码 |
| 2 | 会社名 | 自动 | 名称（链接） |
| 3 | 電話番号 | 固定 | 电话 |
| 4 | システム利用 | 固定 | 状态 |

---

## 5. API接口设计

### 5.1 パートナー查询API

```yaml
# パートナー搜索查询
GET /api/v1/partners/search
Authorization: Bearer {token}

# Query Parameters
- company_code: string
- company_name: string
- phone: string
- system_use: string (あり/なし)
- page: integer
- page_size: integer
```

### 5.2 详情跳转API
```yaml
# 获取パートナー详情
GET /api/v1/partners/{partnerId}
Authorization: Bearer {token}
```

### 5.3 画面-API-数据库关系映射

#### 5.3.1 关系总览表

| 画面元素 | API接口 | 接口功能说明 | 相关数据库表 | 字段关系 |
|----------|---------|-------------|-------------|----------|
| **搜索条件区** | | | | |
| ⑴ 会社コード | GET /api/v1/partners/search | 按公司代码筛选 | m_partner | company_code (模糊匹配) |
| ⑵ 会社名 | GET /api/v1/partners/search | 按公司名筛选 | m_partner | company_name (模糊匹配) |
| ⑶ 電話番号 | GET /api/v1/partners/search | 按电话号码筛选 | m_partner | phone (模糊匹配) |
| ⑷ システム利用 | GET /api/v1/partners/search | 按系统利用状态筛选 | m_partner | system_use (あり/なし) |
| ⑸ 検索ボタン | GET /api/v1/partners/search | 执行多条件组合查询 | m_partner | 全部搜索条件 AND 组合 |
| **搜索结果列表区** | | | | |
| 列表数据获取 | GET /api/v1/partners/search | 分页查询合作伙伴列表 | m_partner | company_code, company_name, phone, system_use |
| ⑹ 会社コード | GET /api/v1/partners/search | 显示公司代码 | m_partner | company_code |
| ⑺ 会社名 | GET /api/v1/partners/search | 显示公司名称 | m_partner | company_name |
| | 点击跳转 | - | 跳转到b12-詳細 | - | 携带 partnerId |
| ⑻ 電話番号 | GET /api/v1/partners/search | 显示电话号码 | m_partner | phone |
| ⑼ システム利用 | GET /api/v1/partners/search | 显示系统利用状态 | m_partner | system_use (あり/なし) |
| **页面加载** | | | | |
| 页面初始化 | GET /api/v1/partners/search | 获取合作伙伴列表 | m_partner | company_code, company_name, phone, system_use, is_active |

#### 5.3.2 关系说明

**1. 搜索流程关系**

```
用户输入搜索条件 (⑴⑵⑶⑷)
         ↓
点击検索ボタン (⑸)
         ↓
前端调用: GET /api/v1/partners/search
         ↓
后端查询: m_partner (多条件 AND)
         ↓
返回JSON结果给前端
         ↓
前端渲染: 列表展示 (⑹⑺⑻⑼等)
```

**2. 数据表关系**

```
m_partner (合作伙伴主表，主表)
    ├─ id (主键)
    ├─ partner_id (合作伙伴ID，业务主键)
    ├─ company_code (公司代码)
    │      UNIQUE
    ├─ company_name (公司名称)
    ├─ phone (电话号码)
    ├─ email (邮箱)
    ├─ system_use (系统利用状态)
    │      true (あり) / false (なし)
    ├─ address (地址)
    ├─ contact_person (联系人)
    ├─ contact_phone (联系电话)
    ├─ partner_type (合作伙伴类型)
    │      輸送パートナー
    ├─ is_active (是否有效)
    │      DEFAULT TRUE
    ├─ created_at (创建时间)
    ├─ updated_at (更新时间)
    │
    ├─→ t_partner_sub_account.partner_id (一对多)
    │      ├─ id (主键)
    │      ├─ sub_account_id (子账户ID)
    │      ├─ sub_account_name (子账户名称)
    │      └─ branch_office (支店/営業所)
    │
    └─→ t_billing.partner_id (一对多)
           ├─ id (主键)
           ├─ billing_id (账单ID)
           └─ ... 其他账单字段
```

**3. 字段映射关系**

| 画面元素 | 数据库表 | 源字段 | 目标字段 | 转换逻辑 |
|----------|---------|--------|---------|---------|
| 会社コード | m_partner | company_code | - | 直接映射 |
| 会社名 | m_partner | company_name | - | 直接映射 |
| 電話番号 | m_partner | phone | - | 直接映射 |
| システム利用 | m_partner | system_use | - | true→あり, false→なし |
| 会社コード（列表） | m_partner | company_code | - | 直接映射 |
| 会社名（列表） | m_partner | company_name | - | 直接映射 |
| 電話番号（列表） | m_partner | phone | - | 直接映射 |
| システム利用（列表） | m_partner | system_use | - | true→あり, false→なし |

**4. 搜索条件处理逻辑**

```
会社コード条件:
  - 如果输入: WHERE company_code LIKE '%输入值%'
  - 如果未输入: 不限制

会社名条件:
  - 如果输入: WHERE company_name LIKE '%输入值%'
  - 如果未输入: 不限制

電話番号条件:
  - 如果输入: WHERE phone LIKE '%输入值%'
  - 如果未输入: 不限制

システム利用条件:
  - 如果选择"あり": WHERE system_use = true
  - 如果選択"なし": WHERE system_use = false
  - 如果未選択: 不限制

组合逻辑:
  - 全部条件使用 AND 连接
  - 如果多个条件都未输入，返回全部记录
```

**5. 列表排序规则**

```
默认排序:
  - 主要排序: company_code ASC (按公司代码正序)
  - 次要排序: id ASC (按主键正序)

分页处理:
  - 使用 LIMIT 和 OFFSET 进行分页
  - 支持 page 和 page_size 参数
  - 返回 total_count (总记录数) 用于前端分页组件
```

#### 5.3.3 数据流图

```
┌─────────────────────────────────────────────────────────────────────┐
│                   b11-輸送パートナーマスタ検索 画面                    │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌─────────────┐  ┌──────────────┐  ┌─────────────┐               │
│  │ 会社コード │  │ 会社名       │  │ 電話番号    │               │
│  │ 入力(⑴)   │  │ 入力(⑵)     │  │ 入力(⑶)     │               │
│  └─────────────┘  └──────────────┘  └─────────────┘               │
│         ↓                ↓                 ↓                       │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │ システム利用: ○ あり  ○ なし  (⑷)                      │     │
│  └────────────────────────┬───────────────────────────────┘     │
│                           ↓                                      │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │ 検索ボタン (⑸)                                         │     │
│  └────────────────────────┬───────────────────────────────┘     │
│                           ↓                                      │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │ GET /api/v1/partners/search                            │     │
│  │ Query: company_code, company_name, phone, system_use...  │     │
│  └────────────────────────┬───────────────────────────────┘     │
│                           ↓                                      │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │              Spring Boot Controller                      │     │
│  └────────────────────────┬───────────────────────────────┘     │
│                           ↓                                      │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │              PartnerService                            │     │
│  └────────────────────────┬───────────────────────────────┘     │
│                           ↓                                      │
│                    ┌────────────┐                               │
│                    │  m_partner │                               │
│                    │   (主表)   │                               │
│                    └─────┬──────┘                               │
│                          │                                       │
│                    ┌─────┴──────┐                               │
│                    │  t_partner  │                               │
│                    │ _sub_account│                               │
│                    └─────────────┘                               │
│                           ↓                                      │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │  组装查询结果                                            │     │
│  └────────────────────────┬───────────────────────────────┘     │
│                           ↓                                      │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │  返回JSON响应 (含分页信息)                              │     │
│  └────────────────────────┬───────────────────────────────┘     │
│                           ↓                                      │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │                   Frontend                               │     │
│  │                   Table Render                         │     │
│  └────────────────────────┬───────────────────────────────┘     │
│                           ↓                                      │
│  ┌─────────────────────────────────────────────────────────┐     │
│  │              搜索结果列表                                │     │
│  │  ⑹ ⑺(リンク) ⑻ ⑼                                     │     │
│  │  会社コード/会社名/電話番号/システム利用               │     │
│  └─────────────────────────────────────────────────────────┘     │
│                           │                                      │
│                           ↓                                      │
│              ┌───────────────────────────┐                       │
│              │ 点击会社名(⑺)             │                       │
│              │ → GET /api/v1/partners/ │                       │
│              │ {partnerId}              │                       │
│              └───────────┬─────────────┘                       │
│                          ↓                                      │
│              ┌───────────────────────────┐                       │
│              │ 跳转到 b12-詳細          │                       │
│              └───────────────────────────┘                       │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

#### 5.3.4 核心数据库表结构

**m_partner（合作伙伴主表）**

| 字段名 | 类型 | 说明 | 关联 |
|--------|------|------|------|
| id | BIGSERIAL | 主键 | - |
| partner_id | VARCHAR(20) | 合作伙伴ID | UNIQUE |
| company_code | VARCHAR(20) | 公司代码 | UNIQUE |
| company_name | VARCHAR(100) | 公司名称 | - |
| phone | VARCHAR(20) | 电话号码 | - |
| email | VARCHAR(100) | 邮箱 | - |
| address | TEXT | 地址 | - |
| contact_person | VARCHAR(100) | 联系人 | - |
| contact_phone | VARCHAR(20) | 联系电话 | - |
| partner_type | VARCHAR(20) | 合作伙伴类型 | 輸送パートナー |
| system_use | BOOLEAN | 系统利用状态 | true (あり) / false (なし) |
| is_active | BOOLEAN | 是否有效 | DEFAULT TRUE |
| created_at | TIMESTAMP | 创建时间 | - |
| updated_at | TIMESTAMP | 更新时间 | - |

**t_partner_sub_account（合作伙伴子账户表）**

| 字段名 | 类型 | 说明 | 关联 |
|--------|------|------|------|
| id | BIGSERIAL | 主键 | - |
| sub_account_id | VARCHAR(50) | 子账户ID | UNIQUE |
| partner_id | VARCHAR(20) | 合作伙伴ID | → m_partner.partner_id |
| sub_account_name | VARCHAR(100) | 子账户名称 | - |
| branch_office | VARCHAR(100) | 支店/営業所 | - |
| is_active | BOOLEAN | 是否有效 | DEFAULT TRUE |
| created_at | TIMESTAMP | 创建时间 | - |
| updated_at | TIMESTAMP | 更新时间 | - |

**5.3.5 システム利用状态说明**

| system_use值 | 显示 | 说明 |
|-------------|------|------|
| true | あり | 系统利用中 |
| false | なし | 系统未利用 |

---

## 6. 前端实现

### 6.1 搜索组件
```typescript
// b11搜索组件
import { Select, Input, Radio, Button, Table } from 'antd';

export const B11PartnerSearchPage: React.FC = () => {
  const [searchParams, setSearchParams] = useState({
    companyCode: '',
    companyName: '',
    phone: '',
    systemUse: undefined
  });

  const handleSearch = () => {
    // 执行搜索
  };

  return (
    <div className="b11-partner-search-container">
      <div className="search-section">
        <Input
          placeholder="会社コード"
          value={searchParams.companyCode}
          onChange={(e) => setSearchParams({...searchParams, companyCode: e.target.value})}
        />
        <Input
          placeholder="会社名"
          value={searchParams.companyName}
          onChange={(e) => setSearchParams({...searchParams, companyName: e.target.value})}
        />
        <Input
          placeholder="電話番号"
          value={searchParams.phone}
          onChange={(e) => setSearchParams({...searchParams, phone: e.target.value})}
        />
        <Radio.Group
          value={searchParams.systemUse}
          onChange={(e) => setSearchParams({...searchParams, systemUse: e.target.value})}
        >
          <Radio value={true}>あり</Radio>
          <Radio value={false}>なし</Radio>
        </Radio.Group>
        <Button onClick={handleSearch}>検索</Button>
      </div>
      <Table
        dataSource={partnerList}
        columns={columns}
        rowKey="companyCode"
      />
    </div>
  );
};
```

---

## 7. 验收标准

### 7.1 功能验收
- [ ] 搜索条件可正常输入
- [ ] 検索按钮可正常执行搜索
- [ ] 列表正确显示搜索结果
- [ ] 点击公司名称跳转到详情页

### 7.2 视觉验收
- [ ] 布局与设计稿一致
- [ ] 列表字段顺序正确

### 7.3 性能验收
- [ ] 搜索响应时间 < 1秒
- [ ] 列表渲染时间 < 1秒

---

## 8. 变更日志

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|---------|------|
| 2026-02-10 | v1.0.1 | 新增5.3节：画面-API-数据库关系映射表，包含详细的关系总览、关系说明、数据流图和核心数据库表结构 | - |
| 2026-02-XX | v1.0 | 初始版本 | - |

---

## 附录

### A.1 相关文档
| 文档 | 路径 | 说明 |
|------|------|------|
| 公共技术架构规范 | [\_公共技术架构规范.md](../_公共技术架构规范.md) | 前后端技术架构详细规范 |
| b10-マスタ管理 | [../b10-マスタ管理/05_设计规范.md](../b10-マスタ管理/05_设计规范.md) | 入口页面设计规范 |
| b2-発注検索 | [../b2-発注検索/05_设计规范.md](../b2-発注検索/05_设计规范.md) | 相似搜索页面 |

### A.2 与b2-発注検索对比
| 特性 | b11-輸送パートナーマスタ検索 | b2-発注検索 |
|------|----------------------------|-------------|
| **用户类型** | ベース | ベース |
| **设备支持** | PCのみ | PCのみ |
| **搜索条件** | 4项 | 3项 |
| **列表字段** | 4项 | 9项 |

---

**文档编制**: -  
**编制时间**: 2026-02-10 
**适用范围**: 別紙_画面一覧_v151.xlsx - b11-輸送パートナーマスタ検索  
**交叉引用**: [\_公共技术架构规范.md](../_公共技术架构规范.md)
