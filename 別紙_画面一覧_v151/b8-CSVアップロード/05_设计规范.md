# b8-CSVアップロード - 设计规范

## 1. 功能概述

### 1.1 文档信息
| 项目 | 内容 |
|------|------|
| **工作表名称** | b8-CSVアップロード |
| **界面编号** | b8 |
| **文档版本** | v1.0 |
| **最后更新** | 2026-02-XX|
| **文档状态** | ✅ 已发布 |

### 1.2 功能描述
b8-CSVアップロード 是BOSS系统CSV上传页面，提供月間運行計画表和日別傭車費一覧的CSV文件上传、校验和导入功能。

### 1.3 技术架构
本文档基于 **前后端分离架构**，详细技术规范请参考：

👉 **[\_公共技术架构规范.md](../_公共技术架构规范.md)**

| 层级 | 技术 |
|------|------|
| 前端 | React 18.x + TypeScript + Ant Design |
| 后端 | Spring Boot 3.x + Java 17 |

### 1.4 核心功能
- CSVファイルアップロード
- ファイルチェック
- データチェック
- パートナーに反映
- 一斉メール送信

### 1.5 适用范围
- 前端开发人员（上传组件实现）
- 后端开发人员（CSV处理API）
- 测试工程师（上传功能测试）

---

## 2. 页面元素

### 2.1 上传方式
b8-CSVアップロード 支持两种上传方式，由ベースごとの設定决定：

| 方式 | 说明 | 対象 |
|------|------|------|
| **全件单位** | あらかじめベースごとに定められた単位に従って、一括で全パートナーに上传 | ベースの全パートナー |
| **個別单位** | 個別パートナーごとにファイルを上传 | 個別パートナー |

### 2.2 上传方式在画面上的体现
| 场景 | 画面行为 |
|------|----------|
| 全件单位 | 選択した年月の全パートナーに対して一括上传画面を表示 |
| 個別単位 | 個別パートナーごとにアップロードするファイルを選択する画面を表示 |

**注意**: システムが自動的にベースの設定を読み取り、適切な上传方法を適用する。

### 2.3 Tabs组件

| Tab名 | 内容 | 上传文件 |
|-------|------|----------|
| 発注（前月25日～26日） | 发注阶段 | 月間運行計画表 |
| 実績確認（当月中） | 业绩确认 | 日別傭車費一覧 |
| 発注＆実績確認（〆後） | 最终确认 | 双方 |

### 2.2 通用元素

| 序号 | 元素名称 | 元素类型 | 功能说明 | 交互触发 |
|------|----------|----------|----------|----------|
| ⑴ | 年月選択 | プルダウン | 年月选择 | 选择触发 |
| ⑵ | アップロードする書類 | 表示項目 | 显示上传文件类型 | - |
| ⑶ | アップロード済ファイル名 | 表示項目 | 文件名+日時 | - |
| ⑷ | ファイルアップロード | ボタン | 上传文件 | 点击→选择 |
| ⑸ | ファイルチェック結果 | 表示項目 | 文件检查结果 | - |
| ⑹ | データチェック結果 | 表示項目 | 数据检查结果 | - |
| ⑺ | パートナーに反映 | ボタン | 确认导入 | 点击→导入 |
| ⑻ | 一斉メール送信 | ボタン | 发送邮件 | 点击→发送 |

---

## 3. 交互流程

### 3.1 上传流程
| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 选择Tab | 切换上传内容 |
| 2 | 选择年月 | 设定上传期间 |
| 3 | 点击上传按钮 | 打开文件选择 |
| 4 | 选择CSV文件 | 执行上传 |
| 5 | 文件检查 | 显示检查结果 |

### 3.2 校验流程
| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 显示检查结果 | 必須項目/項目数/文字コード |
| 2 | 数据检查 | 差分比較 |
| 3 | 确认/取消 | 继续或取消 |

### 3.3 反映流程
| 步骤 | 用户操作 | 系统响应 |
|------|----------|----------|
| 1 | 点击反映按钮 | 执行数据导入 |
| 2 | ver.up | 版本号递增 |
| 3 | 邮件发送 | 发送通知邮件 |

---

## 4. 界面规范

### 4.1 页面布局
| 属性 | PC端值 | SP端值 | 说明 |
|------|--------|--------|------|
| **页面类型** | PC | 不支持 | ≪PC≫标识 |
| **布局方式** | Tabs+表单 | - | 多Tab布局 |

### 4.2 状态颜色
| 状态 | 颜色 | 说明 |
|------|------|------|
| チェックOK | 绿色 | 检查通过 |
| チェックNG | 红色 | 检查失败 |
| アップロード済 | 蓝色 | 已上传 |
| 反映済 | 绿色 | 已反映 |

### 4.3 按钮状态
| 状态 | 活性化条件 |
|------|------------|
| アップロード | 常に活性 |
| 再アップロード | アップロード済 |
| パートナーに反映 | チェックOK |
| 一斉メール送信 | 反映済 |

---

## 5. API接口设计

### 5.1 上传API
```yaml
# CSV文件上传
POST /api/v1/csv/upload
Authorization: Bearer {token}
Content-Type: multipart/form-data

# Request
- year_month: string (YYYY-MM)
- tab_type: string (order/completed-order/both)
- file: File

# Response
{
  "status": "success",
  "file_id": "xxx",
  "file_check": {
    "required_blank": "OK",
    "column_count": "OK",
    "encoding": "OK"
  }
}
```

### 5.2 数据校验API
```yaml
# 数据校验
POST /api/v1/csv/validate
Authorization: Bearer {token}

# Response
{
  "data_check": {
    "differences": [...],
    "action_required": true
  }
}
```

### 5.3 反映API
```yaml
# 确认导入
POST /api/v1/csv/import
Authorization: Bearer {token}

# Response
{
  "status": "success",
  "version": "n+1",
  "imported_count": 100
}
```

### 5.4 邮件发送API
```yaml
# 一斉メール送信
POST /api/v1/csv/send-notifications
Authorization: Bearer {token}

# Response
{
  "status": "success",
  "sent_count": 20,
  "failed_count": 0
}
```

---

## 6. 前端实现

### 6.1 上传组件
```typescript
// b8上传组件
import { Upload, Button, Progress, Tabs } from 'antd';

export const B8UploadPage: React.FC = () => {
  const [fileList, setFileList] = useState([]);
  const [uploadStatus, setUploadStatus] = useState('idle');

  const handleUpload = async (file) => {
    // 执行上传
  };

  return (
    <div className="b8-upload-container">
      <Tabs items={tabItems} />
      <Upload
        beforeUpload={handleUpload}
        fileList={fileList}
      >
        <Button>アップロード</Button>
      </Upload>
      <CheckResults results={checkResults} />
      <DataDiff diff={dataDiff} />
      <Button disabled={!canImport}>パートナーに反映</Button>
      <Button disabled={!canSend}>一斉メール送信</Button>
    </div>
  );
};
```

---

## 7. 验收标准

### 7.1 功能验收
- [ ] Tab切换正常
- [ ] 文件上传正常
- [ ] 文件检查正常
- [ ] 数据检查正常
- [ ] 反映功能正常
- [ ] 邮件发送正常

### 7.2 视觉验收
- [ ] 布局与设计稿一致
- [ ] 状态显示正确
- [ ] 按钮状态正确

### 7.3 性能验收
- [ ] 文件上传 < 10秒
- [ ] 数据校验 < 5秒
- [ ] 批量处理正常

---

## 8. 变更日志

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|---------|------|
| 2026-02-XX| v1.0 | 初始版本 | - |

---

## 附录

### A.1 相关文档
| 文档 | 路径 | 说明 |
|------|------|------|
| 公共技术架构规范 | [\_公共技术架构规范.md](../_公共技术架构规范.md) | 前后端技术架构详细规范 |
| b0-导航菜单 | [../b0-共通ナビゲーション/05_设计规范.md](../b0-共通ナビゲーション/05_设计规范.md) | 导航菜单设计规范 |

### A.2 与p6-CSVアップロード对比
| 特性 | b8-CSVアップロード | p6-CSVアップロード |
|------|--------------------|--------------------|
| **用户类型** | ベース | 輸送パートナー |
| **设备支持** | PCのみ | PC/SP |

---

**文档编制**: -  
**编制时间**: 2026-02-XX 
**适用范围**: 別紙_画面一覧_v151.xlsx - b8-CSVアップロード  
**交叉引用**: [\_公共技术架构规范.md](../_公共技术架构规范.md)
