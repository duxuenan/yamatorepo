# b15-ベースアカウントマスタ詳細 - 详细分析

## 页面结构层次

```
配車発注管理システム
├── マスタ管理
│   ├── ユーザー情報
│   │   ├── ユーザーID (只读)
│   │   ├── メールアドレス (只读)
│   │   ├── ユーザー名 (只读)
│   │   └── 所属 (可编辑)
│   ├── 権限
│   │   ├── ● 管理者
│   │   ├── 〇 役割者
│   │   ├── 〇 配車担当者
│   │   └── 〇 計上担当者
│   └── アカウント有効・無効
│       ├── 有効
│       └── 無効
```

## 字段详细说明

### 用户信息区域

| 字段标识 | 字段名称 | 数据类型 | 验证规则 | 业务规则 |
|----------|----------|----------|----------|----------|
| user_id | ユーザーID | string | 只读 | AzureADから取得したユーザーIDを表示する |
| email | メールアドレス | string | 只读 | AzureADから取得したメールアドレスを表示する |
| user_name | ユーザー名 | string | 只读 | AzureADから取得したユーザー名を表示する |
| affiliation | 所属 | select | 必填 | プルダウンより、該当する「ベース」または、「本社」を選択する |

### 权限设置区域

| 字段标识 | 字段名称 | 数据类型 | 选项值 | 业务规则 |
|----------|----------|----------|--------|----------|
| permission | 権限 | radio | ● 管理者 / 〇 役割者 / 〇 配車担当者 / 〇 計上担当者 | 本システムを利用するユーザーの権限を選択する |

### 账户状态区域

| 字段标识 | 字段名称 | 数据类型 | 选项值 | 业务规则 |
|----------|----------|----------|--------|----------|
| account_status | アカウント有効・無効 | toggle | 有効 / 無効 | トグルスイッチでアカウントを有効または、無効にできる |

## 权限矩阵详细说明

### 権限付与 (权限授予)

| 权限 | 権限付与 | 说明 |
|------|----------|------|
| 管理者 | 〇 編集可 | 可以编辑权限 |
| 役割者 | × 閲覧不可 | 不能查看 |
| 配車担当者 | × 閲覧不可 | 不能查看 |
| 計上担当者 | × 閲覧不可 | 不能查看 |

### 承認 (审批)

| 权限 | 承認 | 说明 |
|------|------|------|
| 管理者 | 〇 編集可 | 可以编辑审批 |
| 役割者 | △ 閲覧のみ | 只能查看 |
| 配車担当者 | △ 閲覧のみ | 只能查看 |
| 計上担当者 | △ 閲覧のみ | 只能查看 |

### マスタ管理 (主数据管理)

| 权限 | マスタ管理 | 说明 |
|------|------------|------|
| 管理者 | 〇 編集可 | 可以编辑 |
| 役割者 | 〇 編集可 | 可以编辑 |
| 配車担当者 | × 閲覧不可 | 不能查看 |
| 計上担当者 | × 閲覧不可 | 不能查看 |

### 発注 (下单)

| 権限 | 発注 | 说明 |
|------|------|------|
| 管理者 | △ 閲覧のみ | 只能查看 |
| 役割者 | 〇 編集可 | 可以编辑 |
| 配車担当者 | 〇 編集可 | 可以编辑 |
| 計上担当者 | × 閲覧不可 | 不能查看 |

### 計上 (计入)

| 権限 | 計上 | 说明 |
|------|------|------|
| 管理者 | △ 閲覧のみ | 只能查看 |
| 役割者 | × 閲覧不可 | 不能查看 |
| 配車担当者 | △ 閲覧のみ | 只能查看 |
| 計上担当者 | 〇 編集可 | 可以编辑 |

## 交互流程详细说明

### 1. 页面加载流程

```
开始
  ↓
获取用户信息（从b14跳转或新增时预填）
  ↓
加载权限设置
  ↓
加载账户状态
  ↓
显示完整页面
```

### 2. 保存操作流程

```
用户修改设置（所属、権限、アカウント有効・無効）
  ↓
点击「保存」按钮
  ↓
验证必填字段（所属）
  ↓
保存设置到数据库
  ↓
显示保存成功提示
  ↓
流程结束
```

### 3. 条件只读规则

```
IF フィールド IN (ユーザーID, メールアドレス, ユーザー名) THEN
    フィールド.只读 = TRUE
    フィールド.提示 = "※編集不可。変更する場合は、AzureAD側を変更する必要がある"
ENDIF
```

## 弹窗/特殊组件说明

### 所属选择下拉框

| 属性 | 值 |
|------|-----|
| 组件类型 | Select Dropdown |
| 数据源 | ベース一覧（マスタ） |
| 选项 | ベース / 本社 |
| 验证 | 必須入力 |

### 账户状态切换开关

| 属性 | 值 |
|------|-----|
| 组件类型 | Toggle Switch |
| 选项 | 有効 / 無効 |
| 功能 | 切换用户是否可以使用系统 |
