# p0-共通ナビゲーション - 设计规范

## 1. 功能概述

### 1.1 文档信息

| 项目 | 内容 |
|------|------|
| **工作表名称** | p0-共通ナビゲーション |
| **界面编号** | p0 |
| **文档版本** | v1.0 |
| **最后更新** | 2026-02-10 |
| **文档状态** | ✅ 已发布 |

### 1.2 功能描述

p0-共通ナビゲーション是輸送パートナー（合作伙伴）端的共通导航组件，为合作伙伴用户提供全局导航功能。

- **PC端**：主要页面链接作为共通菜单常时显示
- **SP端**：画面右上角汉堡菜单按钮，点击后显示导航菜单

### 1.3 导航菜单

| 菜单项 | 功能说明 | 跳转目标 |
|--------|----------|----------|
| 配車発注管理 | 主要页面链接的共通菜单，常时显示导航 | - |
| システム | SP端显示汉堡菜单按钮，用于展开导航 | - |
| 受注管理 | 链接到订单管理 | → p2-発注検索 |
| 実績確認 | 链接到実績确认 | → p4-実績確認 |
| 請求確認 | 链接到请求确认 | → p5-請求検索 |
| ログアウト | 退出系统，返回登录页 | → p1-スタート |

### 1.4 导航流程

1. 用户登录后进入系统，显示p0共通导航
2. PC端横向显示菜单，SP端显示汉堡按钮
3. 点击菜单项跳转到对应页面
4. 点击ログアウト退出系统

### 1.5 适用范围

- 前端开发人员（导航组件实现）
- 后端开发人员（导航API开发）
- 测试工程师（功能测试）

---

## 2. 页面元素

### 2.1 PC端元素清单

| 序号 | 元素名称 | 元素类型 | 功能说明 | 交互触发 |
|------|----------|----------|----------|----------|
| ⑴ | 配車発注管理 | Menu Item | 系统标题区域 | 表示 |
| ⑵ | 受注管理 | Menu Item | 导航到订单管理页面 | クリック→p2 |
| ⑶ | 実績確認 | Menu Item | 导航到実績确认页面 | クリック→p4 |
| ⑷ | 請求確認 | Menu Item | 导航到请求确认页面 | クリック→p5 |
| ⑸ | ログアウト | Menu Item | 退出系统 | クリック→p1 |

### 2.2 SP端元素清单

| 序号 | 元素名称 | 元素类型 | 功能说明 | 交互触发 |
|------|----------|----------|----------|----------|
| ⑴ | ハンバーガーメニュー | Button | 汉堡菜单按钮 | クリック→Drawer表示 |
| ⑵ | 受注管理 | List Item | 导航到订单管理页面 | クリック→p2 |
| ⑶ | 実績確認 | List Item | 导航到実績确认页面 | クリック→p4 |
| ⑷ | 請求確認 | List Item | 导航到请求确认页面 | クリック→p5 |
| ⑸ | ログアウト | List Item | 退出系统 | クリック→p1 |

---

## 3. 交互流程

### 3.1 PC端导航流程

| ステップ | アクション | システム応答 |
|----------|-----------|--------------|
| 1 | ページロード | 导航菜单常时显示 |
| 2 | メニューアイテム選択 | 判断跳转目标页面 |
| 3 | ページ遷移 | navigate()调用 |

### 3.2 SP端导航流程

| ステップ | アクション | システム応答 |
|----------|-----------|--------------|
| 1 | ページロード | 显示汉堡菜单按钮 |
| 2 | ハンバーガーボタンクリック | Drawer展开显示菜单 |
| 3 | メニューアイテム選択 | Drawer关闭，页面跳转 |
| 4 | ページ遷移 | navigate()调用 |

### 3.3 登出流程

| ステップ | アクション | システム応答 |
|----------|-----------|--------------|
| 1 | ログアウトボタンクリック | 确认对话框显示 |
| 2 | 確認 | 调用登出API |
| 3 | セッションクリア | 清除localStorage/sessionStorage/Cookies |
| 4 | ページ遷移 | p1-スタート画面へ遷移 |

---

## 4. 界面规范

### 4.1 PC端布局

| 属性 | PC端値 | 説明 |
|------|--------|------|
| **布局方式** | 水平菜单 | 横向显示 |
| **菜单位置** | 顶部固定 | 常时显示 |
| **菜单间距** | 24px | 菜单项间隔 |

### 4.2 SP端布局

| 属性 | SP端値 | 説明 |
|------|--------|------|
| **菜单按钮位置** | 右上角 | 汉堡菜单按钮 |
| **Drawer位置** | right | 从右侧滑出 |
| **Drawer标题** | メニュー | 固定标题 |

### 4.3 菜单配置规格

| 属性 | 値 | 説明 |
|------|----|------|
| **菜单项高度** | 48px | 菜单项行高 |
| **菜单项间距** | 8px | 菜单项间余白 |
| **选中状态** | 高亮显示 | 区分当前页面 |

---

## 5. API接口设计

### 5.1 获取导航配置

```typescript
// GET /api/v1/navigation/config
interface NavigationConfigResponse {
  success: boolean;
  data: {
    menuItems: MenuItem[];
    userPermissions: string[];
  };
}

interface MenuItem {
  id: string;
  label: string;
  icon: string;
  targetPage: string;
  order: number;
}
```

### 5.2 登出接口

```typescript
// POST /api/v1/auth/logout
interface LogoutRequest {
  userId: string;
  sessionToken: string;
}

interface LogoutResponse {
  success: boolean;
  message: string;
}
```

---

## 6. 前端组件设计

### 6.1 页面组件结构

```
p0-CommonNavigation/
├── index.tsx                    # 主导航组件
├── components/
│   ├── NavigationMenu.tsx       # PC端导航菜单
│   ├── MobileMenu.tsx           # SP端汉堡菜单
│   └── MenuItem.tsx            # 菜单项组件
├── hooks/
│   ├── useNavigation.ts        # 导航hook
│   └── useDeviceType.ts        # 设备类型hook
├── types/
│   └── navigation.ts          # 类型定义
└── utils/
    └── menuConfig.ts           # 菜单配置
```

### 6.2 PC端导航组件

```tsx
// index.tsx (PC端)
import React from 'react';
import { Menu } from 'antd';
import { useNavigate } from 'react-router-dom';

const menuItems = [
  {
    key: 'orders',
    label: '受注管理',
    onClick: () => navigate('/p2'),
  },
  {
    key: 'results',
    label: '実績確認',
    onClick: () => navigate('/p4'),
  },
  {
    key: 'billing',
    label: '請求確認',
    onClick: () => navigate('/p5'),
  },
  {
    key: 'logout',
    label: 'ログアウト',
    onClick: () => handleLogout(),
  },
];

export const NavigationMenu: React.FC = () => {
  const navigate = useNavigate();

  return (
    <Menu
      mode="inline"
      items={menuItems}
      selectedKeys={[currentPage]}
    />
  );
};
```

### 6.3 SP端汉堡菜单组件

```tsx
// MobileMenu.tsx (SP端)
import React, { useState } from 'react';
import { Drawer, List, Button } from 'antd';
import { MenuOutlined } from '@ant-design/icons';

export const MobileMenu: React.FC = () => {
  const [visible, setVisible] = useState(false);

  const showDrawer = () => setVisible(true);
  const onClose = () => setVisible(false);

  return (
    <>
      <Button
        type="text"
        icon={<MenuOutlined />}
        onClick={showDrawer}
      />
      <Drawer
        title="メニュー"
        placement="right"
        onClose={onClose}
        open={visible}
      >
        <List
          dataSource={menuItems}
          renderItem={(item) => (
            <List.Item onClick={item.onClick}>
              {item.label}
            </List.Item>
          )}
        />
      </Drawer>
    </>
  );
};
```

---

## 7. 后端服务设计

### 7.1 Controller

```java
@RestController
@RequestMapping("/api/v1/navigation")
@RequiredArgsConstructor
public class NavigationController {

    private final NavigationService navigationService;

    @GetMapping("/config")
    public ResponseEntity<NavigationConfigResponse> getNavigationConfig(
            @AuthenticationPrincipal User user) {
        NavigationConfigResponse response = navigationService.getConfig(user);
        return ResponseEntity.ok(response);
    }
}

@RestController
@RequestMapping("/api/v1/auth")
@RequiredArgsConstructor
public class AuthController {

    private final AuthService authService;

    @PostMapping("/logout")
    public ResponseEntity<LogoutResponse> logout(
            @AuthenticationPrincipal User user) {
        authService.logout(user);
        return ResponseEntity.ok(LogoutResponse.builder()
                .success(true)
                .message("ログアウトしました")
                .build());
    }
}
```

---

## 8. 数据库表设计

### 8.1 navigation_menu 表

```sql
CREATE TABLE navigation_menu (
    menu_id VARCHAR(50) PRIMARY KEY,
    menu_label VARCHAR(100) NOT NULL,
    menu_icon VARCHAR(100),
    target_page VARCHAR(100) NOT NULL,
    display_order INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE INDEX idx_navigation_order ON navigation_menu(display_order);
```

---

## 9. 验收标准

### 9.1 功能验收

| 测试场景 | 预期结果 | 优先级 |
|----------|----------|--------|
| PC端页面加载 | 横向菜单常时显示 | P0 |
| SP端页面加载 | 汉堡菜单按钮显示 | P0 |
| 点击受注管理 | 跳转到p2-発注検索 | P0 |
| 点击実績確認 | 跳转到p4-実績確認 | P0 |
| 点击請求確認 | 跳转到p5-請求検索 | P0 |
| 点击ログアウト | 退出系统，跳转到p1 | P0 |
| SP端汉堡菜单 | Drawer正常展开关闭 | P0 |

### 9.2 视觉验收

| 项目 | 要求 |
|------|------|
| 布局 | 与设计稿一致 |
| 菜单样式 | 符合Ant Design规范 |
| 响应式 | PC/SP端显示正常 |

---

## 10. 变更日志

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|---------|------|
| 2026-02-10 | v1.0 | 初始版本 | - |

---

**文档编制**: -  
**编制时间**: 2026-02-10  
**适用范围**: p0-共通ナビゲーション 合作伙伴共通导航页面
